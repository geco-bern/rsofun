<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Changelog • rsofun</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous"><!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,700;1,300;1,400&amp;display=swap" rel="stylesheet"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- geco --><link href="../geco.css" rel="stylesheet"><meta property="og:title" content="Changelog"><!-- Mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js" async integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/config/TeX-AMS-MML_HTMLorMML.js" async integrity="sha256-4zys9A4hMQmtq2EUL+JRoXc0NZi8jVJMzb8onewOaSQ=" crossorigin="anonymous"></script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-news">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="external-link hidden-sm hidden-xs" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="external-link hidden-md hidden-lg" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="navbar-brand" href="../index.html">
           <i>rsofun <small>v5.1.0.9001</small></i>
        </a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/geco-bern/rsofun/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
      <h1 data-toc-skip>Changelog <small></small></h1>
      <small>Source: <a href="https://github.com/geco-bern/rsofun/blob/master/NEWS.md" class="external-link"><code>NEWS.md</code></a></small>
    </div>

    <div class="section level2">
<h2 class="page-header" data-toc-text="development version" id="rsofun-development-version">rsofun (development version)<a class="anchor" aria-label="anchor" href="#rsofun-development-version"></a></h2>
<div class="section level3">
<h3 id="new-features-development-version">New features<a class="anchor" aria-label="anchor" href="#new-features-development-version"></a></h3>
<ul><li>P-model:
<ul><li>Rewritten <code><a href="../reference/calib_sofun.html">calib_sofun()</a></code> that can handle more diverse prior distributions of the parameters to estimate (see internal function <code><a href="../reference/createMixedPrior.html">createMixedPrior()</a></code>) and that can parallelize multiple the MCMC chains. The old version is still available as <code><a href="../reference/calib_sofun_legacy.html">calib_sofun_legacy()</a></code>.</li>
<li>Rewritten <code><a href="../reference/cost_likelihood_pmodel.html">cost_likelihood_pmodel()</a></code> now handling multiple target variables that require to run either <code><a href="../reference/run_pmodel_f_bysite.html">run_pmodel_f_bysite()</a></code> or <code><a href="../reference/run_pmodel_onestep_f_bysite.html">run_pmodel_onestep_f_bysite()</a></code>. Thus also requires a new data format for the <code>drivers</code> and <code>obs</code> arguments. See below under (non-)breaking changes for the new format. The old likelihood function is still available as <code><a href="../reference/cost_likelihood_pmodel_legacy.html">cost_likelihood_pmodel_legacy()</a></code>.</li>
<li>
<code>runread_pmodel()</code> can now run onestep and daily model thanks to the new <code>drivers</code> format. If the old format is used it is implicitly assuming daily runs were requested. Output of <code>runread_pmodel()</code> can be split based on columns present in the <code>data</code> column: <code>df |&gt; rowwise() |&gt; filter("vcmax_mod_molm2s" %in% names(data)) |&gt; ungroup()</code> or <code>df |&gt; rowwise() |&gt; filter("date" %in% names(data)) |&gt; ungroup()</code>
</li>
<li>
<code>pmodel_drivers</code> and <code>pmodel_validation</code> contain now additional sites and a range of <code>daily</code> as well as <code>onestep</code> model runs. Note that the data of site <code>FR-Pue</code> were updated in FDK, so that the forcing data has slightly changed and also <code>whc</code> of <code>FR-Pue</code> was modified from 432 to 260 mm.</li>
<li>The old <code>p_model_drivers_vcmax25</code> and <code>p_model_validation_vcmax25</code> were removed. The old <code>p_model_drivers</code> and <code>p_model_validation</code> were renamed to <code>p_model_oldformat_drivers</code> and <code>p_model_oldformat_validation</code>. See below how to transform between new and old formats.</li>
<li>Output of <code><a href="../reference/run_pmodel_f_bysite.html">run_pmodel_f_bysite()</a></code> (and consequently that of <code>runread_pmodel()</code>) has been transformed into <code>tibble</code> for consistency</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="potentially-breaking-changes-development-version">(Potentially) Breaking changes<a class="anchor" aria-label="anchor" href="#potentially-breaking-changes-development-version"></a></h3>
<ul><li>
<code><a href="../reference/calib_sofun.html">calib_sofun()</a></code> has been renamed to <code><a href="../reference/calib_sofun_legacy.html">calib_sofun_legacy()</a></code>, and a new <code><a href="../reference/calib_sofun.html">calib_sofun()</a></code> has been written (see new features above). For P-model calibration it is fully backwards compatible. For BiomeE calibration this still needs to be tested.</li>
</ul></div>
<div class="section level3">
<h3 id="non-breaking-changes-development-version">Non-Breaking changes<a class="anchor" aria-label="anchor" href="#non-breaking-changes-development-version"></a></h3>
<ul><li><p>New driver data.frame format for P-model: now containing the information which model to run (<code>daily</code> or <code>onestep</code>) as additional column <code>onestep</code> = <code>TRUE</code>/<code>FALSE</code> in the <code>params_siml</code> column. Moreover, in the <code>forcing</code> column the nested data.frame has now additional columns for <code>wind</code> (resulting in columns <code>ccov</code>,<code>co2</code>,<code>date</code>,<code>fapar</code>,<code>netrad</code>,<code>patm</code>,<code>ppfd</code>, <code>rain</code>,<code>snow</code>,<code>temp</code>,<code>tmax</code>,<code>tmin</code>,<code>vpd</code>,<code>wind</code>) for <code>daily</code> model runs. For <code>onestep</code> model runs the required columns are (<code>co2</code>,<code>patm</code>,<code>ppfd</code>,<code>temp</code>,<code>vpd</code>). Each row in <code>pmodel_drivers</code> corresponds to a model run (either daily or onestep depending on <code>params_siml$onestep</code> logical) and (for calibration) should have a corresponding row in <code>pmodel_validation</code>. The example data set for <code>FR-Pue</code> now contains non-zero <code>ccov</code>, previously this was set to <code>0</code>.</p></li>
<li>
<p>New validation (i.e. observation) data.frame format for P-model: containing a new column <code>targets</code> determining which variable(s) is/are the target of the corresponding line. Each row in <code>pmodel_validation</code> corresponds to a model run and should have a corresponding row in <code>pmodel_drivers</code>.</p>
<p>For each row, the column <code>data</code> contains a single <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame()</a></code> with a column <code>id</code> (<code>onestep</code>-row) or <code>date</code> (<code>daily</code>-row) and additional columns for each target (e.g. <code>gpp</code> or <code>nee</code> or <code>le</code>). These column names must correspond with names provided as a list of strings under <code>targets</code>. They should also be consistent with the value of <code>params_siml$onestep</code> in the corresponding driver row.</p>
<p>The format of the <code>data</code>-column involves some assumptions: namely for <code>daily</code>-rows it assumes that each target variable is available on the same dates as all others and for <code>onestep</code>-rows it assumes that multiple target variables have the same number of observations in each <code><a href="https://tibble.tidyverse.org/reference/deprecated.html" class="external-link">data_frame()</a></code>. (NOTE: this can in the future be relaxed by defining NA or other fill values, or alternatively use nested data.frames - i.e. one for each target value.)</p>
</li>
<li><p>Note for future: ideally, validation data and drivers could be a single data.frame. This would be ideal for calibration, since each row in the validation data.frame() must have a corresponding row in the drivers data.frame(). Having a single data.frame() enforces this naturally. However, for just running the model only the drivers are needed.</p></li>
<li>
<p>Find below some code snippets to transform between new and old drivers data.frame format:</p>
<pre><code><span><span class="co"># A) Compare with previous example data set:</span></span>
<span><span class="fu">rsofun</span><span class="fu">::</span><span class="va"><a href="../reference/pmodel_drivers.html">pmodel_drivers</a></span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sitename</span> <span class="op">==</span> <span class="st">"FR-Pue"</span><span class="op">)</span></span>
<span><span class="fu">rsofun</span><span class="fu">::</span><span class="va"><a href="../reference/p_model_oldformat_drivers.html">p_model_oldformat_drivers</a></span></span>
<span></span>
<span><span class="co"># bring new to old format:</span></span>
<span><span class="fu">rsofun</span><span class="fu">::</span><span class="va"><a href="../reference/pmodel_drivers.html">pmodel_drivers</a></span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sitename</span> <span class="op">==</span> <span class="st">"FR-Pue"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># remove new column 'onestep' from nested 'param_siml'</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>params_siml <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">params_siml</span>, <span class="op">~</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.x</span>, <span class="op">-</span><span class="st">'onestep'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># 'site_info' remains same</span></span>
<span>  <span class="co"># 'forcing' has additional info `wind` that needs removing</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">forcing</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2007-01-01"</span> <span class="op">&amp;</span> <span class="va">date</span> <span class="op">&lt;</span> <span class="st">"2013-01-01"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">wind</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ccov <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># note that fapar and co2 are also different</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span>forcing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">temp</span>, <span class="va">vpd</span>, <span class="va">ppfd</span>, <span class="va">netrad</span>, <span class="va">patm</span>,</span>
<span>                          <span class="va">snow</span>, <span class="va">rain</span>, <span class="va">tmin</span>, <span class="va">tmax</span>, <span class="va">fapar</span>, <span class="va">co2</span>, <span class="va">ccov</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bring old to new format:</span></span>
<span><span class="fu">rsofun</span><span class="fu">::</span><span class="va"><a href="../reference/p_model_oldformat_drivers.html">p_model_oldformat_drivers</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># 'forcing' add new column `wind`</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">forcing</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wind <span class="op">=</span> <span class="fl">2.64</span>, ccov <span class="op">=</span> <span class="fl">0.485</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span>forcing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">temp</span>, <span class="va">vpd</span>, <span class="va">ppfd</span>, <span class="va">netrad</span>, <span class="va">patm</span>,</span>
<span>                          <span class="va">snow</span>, <span class="va">rain</span>, <span class="va">tmin</span>, <span class="va">tmax</span>, <span class="va">wind</span>, <span class="va">fapar</span>, <span class="va">co2</span>, <span class="va">ccov</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># add new column 'onestep' in nested 'param_siml'</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>params_siml <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">params_siml</span>, <span class="op">~</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">.x</span>, onestep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</li>
<li>
<p>Below some code snippets to transform between new and old validation (i.e. observation) data.frame format:</p>
<pre><code><span><span class="co"># B) Compare with previous example data set:</span></span>
<span><span class="fu">rsofun</span><span class="fu">::</span><span class="va"><a href="../reference/pmodel_validation.html">pmodel_validation</a></span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sitename</span> <span class="op">==</span> <span class="st">"FR-Pue"</span><span class="op">)</span></span>
<span><span class="fu">rsofun</span><span class="fu">::</span><span class="va"><a href="../reference/p_model_oldformat_validation.html">p_model_oldformat_validation</a></span></span>
<span></span>
<span><span class="co"># bring new to old format:</span></span>
<span><span class="fu">rsofun</span><span class="fu">::</span><span class="va"><a href="../reference/pmodel_validation.html">pmodel_validation</a></span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sitename</span> <span class="op">==</span> <span class="st">"FR-Pue"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># remove new column 'targets'</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">targets</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># remove new columns inside of 'data':</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">gpp_qc</span>, <span class="va">nee</span>, <span class="va">nee_qc</span>, <span class="va">le</span>, <span class="va">le_qc</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gpp_unc <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'date'</span>, <span class="st">'gpp'</span>,<span class="st">'gpp_unc'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># order columns</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sitename</span>, <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bring old to new format:</span></span>
<span><span class="fu">rsofun</span><span class="fu">::</span><span class="va"><a href="../reference/p_model_oldformat_validation.html">p_model_oldformat_validation</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># add new column 'targets'</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>targets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gpp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># add new columns inside of 'data':</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">gpp_unc</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gpp_qc <span class="op">=</span> <span class="fl">1</span>, nee <span class="op">=</span> <span class="cn">NA</span>, nee_qc <span class="op">=</span> <span class="cn">NA</span>, le <span class="op">=</span> <span class="cn">NA</span>, le_qc <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'date'</span>, <span class="st">'gpp'</span>,<span class="st">'gpp_qc'</span>,<span class="st">'nee'</span>,<span class="st">'nee_qc'</span>,<span class="st">'le'</span>,<span class="st">'le_qc'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># order columns</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sitename</span>, <span class="va">targets</span>, <span class="va">data</span><span class="op">)</span></span></code></pre>
</li>
<li><p>Note that driver and validation data format for biomee has not changed. But could in the future be adapted accordingly.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="5.1.0" id="rsofun-510">rsofun 5.1.0<small>2025-10-09</small><a class="anchor" aria-label="anchor" href="#rsofun-510"></a></h2>
<div class="section level3">
<h3 id="new-features-5-1-0">New features<a class="anchor" aria-label="anchor" href="#new-features-5-1-0"></a></h3>
<ul><li>P-model:
<ul><li>New <code><a href="../reference/run_pmodel_onestep_f_bysite.html">run_pmodel_onestep_f_bysite()</a></code> adds single-step leaf-level simulations of the P-model</li>
<li>Changed temperature dependencies of Vcmax and Jmax (see breaking changes below)</li>
<li>Added support for carbon isotope tracking
<ul><li>
<code><a href="../reference/run_pmodel_onestep_f_bysite.html">run_pmodel_onestep_f_bysite()</a></code> returns <code>bigdelta</code>, i.e. the carbon fractionation of fresh assimilate <code>cleafd13c</code> relative to <code>d13c_atm</code>, thereby avoiding any assumptions for <code>d13c_atm</code>.</li>
<li>
<code><a href="../reference/run_pmodel_f_bysite.html">run_pmodel_f_bysite()</a></code> and <code>runread_pmodel()</code> newly return <code>cleaf</code> and <code>cleafd13c</code>, assuming a constant atmospheric signature <code>d13c_atm = -8.4 permil</code>. In a future version daily values of d13c_atm could/should be included in the input forcing.</li>
</ul></li>
</ul></li>
<li>BiomeE:
<ul><li>Added support for LULUC (land use, land-use change) in BiomeE. See vignette <code>biome_luluc</code> for details.</li>
<li>New BiomeE behavior to recycle last year of forcing if requested simulation time span (<code>nyeartrend</code>) is longer than available forcing data.</li>
<li>Prepared support for carbon isotope tracking
<ul><li>
<code><a href="../reference/run_biomee_f_bysite.html">run_biomee_f_bysite()</a></code> and <code>runread_biomee()</code> do track carbon isotopes internally, currently without output. Note that when <code>method_photosynth == "gs_leuning"</code>, then <code>bigdelta = 20</code>, whereas when <code>method_photosynth == "pmodel"</code> then <code>bigdelta</code> is computed based on the <code>pmodel</code>-derived <code>chi</code>.</li>
</ul></li>
</ul></li>
<li>
<code><a href="../reference/calib_sofun.html">calib_sofun()</a></code> now passes parameters as a <em>named</em> vector to cost-functions for easier processing within cost-functions. Default cost-functions were updated, but currently ignore the names. This is fully backward compatible, but allows to use the names in user-created cost functions.</li>
</ul></div>
<div class="section level3">
<h3 id="breaking-changes-5-1-0">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-5-1-0"></a></h3>
<ul><li><p>P-model now computes temperature dependencies of jmax and vcmax with Kumarathunge et al. (2019) instead of Kattge &amp; Knorr (2007), effectively using a dampened signal for tc_growth and long-term averages for tc_home. This alters the simulation results. Formatting of inputs remains unchanged.</p></li>
<li>
<p>Breaking changes in BiomeE drivers:</p>
<ul><li>
<code>init_cohort$init_n_cohorts</code> column has been phased out and must not be present in<br>
drivers to protect against data corruption.</li>
<li>
<code>update_annualLAImax</code> flag was removed and the behavior is now slightly altered since <code>LAImax</code> and <code>underLAImax</code> are set and kept constant at the start of the simulation:
<ul><li>
<code>LAImax</code> takes value <code>max(LAI_light, 0.5)</code>
</li>
<li>
<code>underLAImax</code> takes value <code>min(LAImax, 1.2)</code>
</li>
</ul></li>
<li>
<code>do_closedN_run</code> flag now uses initial inorganic N setting rather than arbitrary value and is false by default.</li>
<li>Modified drivers to use more sensibles values
<ul><li>Species 1 is now a C4 crop</li>
<li>
<code>N_input</code> is set to 0.01 to limit N starvation.</li>
</ul></li>
</ul></li>
<li>
<p>Breaking changes in BiomeE output</p>
<ul><li>renamed the following column names in <code>output_daily_tile</code>:
<ul><li>
<code>totWs</code>=&gt;<code>SoilWater</code>
</li>
<li>
<code>Trsp</code>=&gt;<code>Transp</code>
</li>
<li>
<code>SW_C</code>=&gt;<code>sapwoodC</code> and <code>SW_N</code>=&gt;<code>sapwoodN</code>
</li>
<li>
<code>HW_C</code>=&gt;<code>heartwoodC</code> and <code>HW_N</code>=&gt;<code>heartwoodN</code>
</li>
<li>
<code>McrbC</code>=&gt;<code>mcrbC</code> and <code>McrbN</code>=&gt;<code>mcrbN</code>
</li>
<li>added <code>NPP</code>
</li>
</ul></li>
<li>renamed the following column names in <code>output_annual_tile</code> and <code>output_annual_cell</code>:
<ul><li>
<code>rain</code>=&gt;<code>Prcp</code>
</li>
<li>
<code>SeedC</code>=&gt;<code>seedC</code> (and for <code>N</code>)</li>
<li>
<code>SapwoodC</code>=&gt;<code>sapwoodC</code> (and for <code>N</code>)</li>
<li>
<code>WoodC</code>=&gt;<code>heartwoodC</code> (and for <code>N</code>)</li>
<li>
<code>SlowSOM</code>=&gt;<code>slowSOM</code>
</li>
<li>
<code>McrbC</code>=&gt;<code>mcrbC</code> and <code>McrbN</code>=&gt;<code>mcrbN</code>
</li>
<li>added <code>totC</code>
</li>
</ul></li>
<li>renamed the following column names in <code>output_annual_cohorts</code>:
<ul><li>
<code>nsc</code>=&gt;<code>NSC</code> and <code>nsn</code>=&gt;<code>NSN</code>
</li>
<li>
<code>sapwC</code>=&gt;<code>sapwoodC</code>
</li>
<li>
<code>woodC</code>=&gt;<code>heartwoodC</code>
</li>
<li>
<code>Nupt</code>=&gt;<code>N_uptk</code>
</li>
<li>
<code>Nfix</code>=&gt;<code>N_fxed</code>
</li>
<li>switched column positions of <code>NPP</code> and <code>GPP</code>
</li>
</ul></li>
</ul></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="5.0.1" id="rsofun-v501">rsofun v5.0.1<a class="anchor" aria-label="anchor" href="#rsofun-v501"></a></h2>
<ul><li>This model version behaves exactly as the version before.</li>
<li>Update was necessary to include description of scripts and data used for the model documentation paper into archive on Zenodo</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="5.0.0" id="rsofun-v500">rsofun v5.0.0<small>2024-11-28</small><a class="anchor" aria-label="anchor" href="#rsofun-v500"></a></h2>
<ul><li>new BiomeE forcing data matching that of P-model
<ul><li>
<code>prec</code> is now called <code>rain</code>
</li>
<li>
<code>rh</code> is now provided as <code>vpd</code>
</li>
<li>See <code>biomee_gs_leuning_drivers</code> for an example</li>
</ul></li>
<li>fix Fortran modules leading to segmentation faults using BiomeE model</li>
<li>improved documentation</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="4.4.1" id="rsofun-v441">rsofun v4.4.1<a class="anchor" aria-label="anchor" href="#rsofun-v441"></a></h2>
<ul><li>bugfix Fortran modules and derived types</li>
<li>compilation flags for different platforms</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="4.4" id="rsofun-v44">rsofun v4.4<small>2023-10-30</small><a class="anchor" aria-label="anchor" href="#rsofun-v44"></a></h2>
<ul><li>bugfix on input data type P-model</li>
<li>LM3-PPA to BiomeE renaming</li>
<li>cost function rewrite</li>
<li>update output format (consistency)</li>
<li>add water balance variables to P-model output</li>
<li>new p-model calibratable parameters</li>
<li>rewrite of temperature and soil moisture stress functions</li>
<li>update simulation parameters to take netrad, ppfd and ccov as input forcing</li>
<li>documentation parameter sensitivity analysis</li>
<li>documentation on the data format</li>
<li>document calibration diagnostic and model uncertainty calculation</li>
<li>more transparent licensing and copyright statements in COPYING file</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="4.3" id="rsofun-v43">rsofun v4.3<a class="anchor" aria-label="anchor" href="#rsofun-v43"></a></h2>
<ul><li>Consistent variable names p-model / biomee</li>
<li>optimization stability BayesianTools</li>
<li>documentation</li>
<li>Bugfixes</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="4.2" id="rsofun-v42">rsofun v4.2<a class="anchor" aria-label="anchor" href="#rsofun-v42"></a></h2>
<ul><li>Canopy transfer solved for BiomeE with P-model</li>
<li>Bugfixes</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="4.1" id="rsofun-v41">rsofun v4.1<a class="anchor" aria-label="anchor" href="#rsofun-v41"></a></h2>
<ul><li>Catching aborting in FORTRAN part to avoid R session crashes</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="4.0" id="rsofun-v40">rsofun v4.0<a class="anchor" aria-label="anchor" href="#rsofun-v40"></a></h2>
<ul><li>Public release after refactored code</li>
</ul></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>

</div>


      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/geco-bern" target="_blank" class="external-link">
                          <div class="icon fab fa-github"></div></a>
                        <a href="https://geco-group.org" target="_blank" class="external-link">
                          <div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/SteniBocker/" target="_blank" class="external-link">
                          <div class="icon fab fa-twitter"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">About</h5>
                            <li><a href="https://geco-group.org/" class="external-link">GECO</a></li>
                            <li><a href="https://geco-group.org/people/" class="external-link">Our Team</a></li>
                            <li><a href="https://geco-group.org/contact/" class="external-link">Contact Us</a></li>
                        </ul></div>
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">Resources</h5>
                            <li><a href="https://github.com/geco-bern" class="external-link">Packages</a></li>
                            <li><a href="https://geco-group.org/publication/" class="external-link">Publications</a></li>
                            <li><a href="https://geco-group.org/post/" class="external-link">Blog</a></li>
                        </ul></div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer></div>






  </body></html>

