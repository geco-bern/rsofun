<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BiomeE LULUC â€¢ rsofun</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,700;1,300;1,400&amp;display=swap" rel="stylesheet">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- geco --><link href="../geco.css" rel="stylesheet">
<meta property="og:title" content="BiomeE LULUC">
<!-- Mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js" async integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/config/TeX-AMS-MML_HTMLorMML.js" async integrity="sha256-4zys9A4hMQmtq2EUL+JRoXc0NZi8jVJMzb8onewOaSQ=" crossorigin="anonymous"></script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="external-link hidden-sm hidden-xs" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="external-link hidden-md hidden-lg" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="navbar-brand" href="../index.html">
           <i>rsofun <small>v5.1.0.9000</small></i>
        </a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/geco-bern/rsofun/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>BiomeE LULUC</h1>
                        <h4 data-toc-skip class="author">Mayeul
Marcadella</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/geco-bern/rsofun/blob/master/vignettes/biomee_luluc.Rmd" class="external-link"><code>vignettes/biomee_luluc.Rmd</code></a></small>
      <div class="hidden name"><code>biomee_luluc.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>BiomeE is a dynamic vegetation demography simulation engine capable
of predicting the evolution of a <em>vegetation tile</em> characterized
by static parameters (species, soil parameters, initial vegetation, etc)
when subject to environmental forcing. To learn more, please refer to
<code>vignette("BiomeE usage")</code>. Starting from v5.1, BiomeE is
capable of simulating land use and land-use change (LULUC) by evolving
multiple vegetation tiles, each with different vegetation types and/or
different land-use practices. This section presents an overview of the
concepts and methods.</p>
<div class="section level3">
<h3 id="fractional-tiles">Fractional tiles<a class="anchor" aria-label="anchor" href="#fractional-tiles"></a>
</h3>
<p>Conceptually, BiomeE simulates a grid cell of area 1 (arbitrary unit)
divided in several <em>land units</em> (LU). The <em>fraction</em> of
the cell occupied by each LU varies with time driven by <em>land-use
change</em> (LUC) forcing. Each LU is implemented as a vegetation tile
associated with the scalar <code>fraction</code> (indicating the
fraction occupied by the LU).</p>
</div>
<div class="section level3">
<h3 id="lu-transitions">LU transitions<a class="anchor" aria-label="anchor" href="#lu-transitions"></a>
</h3>
<p>A square transition matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
encodes the exogenous yearly land-use change:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">T_{i,j}</annotation></semantics></math>
is the fraction of LU
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
transitioning to LU
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
on January 1st (start of the year). Such a LUC transition is modelled as
a clear-cut of the fraction
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">T_{i,j}</annotation></semantics></math>
in LU
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and transfer of the corresponding area to LU
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
along with the soil organic pools, water, and belowground biomass
converted to litter. The aboveground biomass is sent to 3 product pools
with e-folding times of 0, 2 and 20 years respectively.</p>
<p>Each transition found in the matrix is evaluated in turn, and the
transfer of matter to each destination LU is accounted throughout the
update process, to ultimately be added to the appropriate LUs. This
gross transition heuristic provides better accuracy compared to a
strategy where net transitions are considered (thereby transitions from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
to and from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
cancels each others out).</p>
</div>
<div class="section level3">
<h3 id="clear-cut-and-wood-harvest">Clear-cut and wood harvest<a class="anchor" aria-label="anchor" href="#clear-cut-and-wood-harvest"></a>
</h3>
<p>The diagonal of the transition matrix contains self transitions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mrow><mi>i</mi><mo>,</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">T_{i,i}</annotation></semantics></math>,
where a fraction of LU
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is clear-cut, but without any transfer of area, water or soil organic
matter. The aboveground biomass is exported to the product pools, while
the belowground biomass is converted to litter and remains in place. In
effect, this models the forestry practice of clear-cutting.</p>
<p>Note: crop harvest uses a different mechanism (direct litter
oxidation). Self-transitions should therefore be used for wood harvest
exclusively.</p>
</div>
<div class="section level3">
<h3 id="other-land-management-practices">Other land management practices<a class="anchor" aria-label="anchor" href="#other-land-management-practices"></a>
</h3>
<p>LUs can furthermore be tailored to model broad categories of land
management:</p>
<ul>
<li>which species grow in the LU (or none in the case of an urban
area),</li>
<li>fixed addition of nitrogen (N fertilization)</li>
<li>extra soil turnover rate (ex: tillage)</li>
<li>direct oxidation of litter (crop and grass harvest)</li>
</ul>
</div>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<p>The output contains the cohorts and tile annual diagnostics for each
LU, as well as a virtual tile aggregating all the LUs of the grid
cell.</p>
<p>An example of output is available in the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geco-bern/rsofun" class="external-link">rsofun</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Output obtained from simulating biomee_p_model_luluc_drivers</span></span>
<span><span class="va">biomee_p_model_luluc_output</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>This section demonstrates how to simulate LULUC with BiomeE.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>The package contains an example of driver from the Swiss CH-LAE
fluxnet site, using environmental data for the year 2009, where 40% of
an initial primary forest is clear-cut and convert to a secondary (yet
unmanaged) forest.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geco-bern/rsofun" class="external-link">rsofun</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">biomee_p_model_luluc_drivers</span></span></code></pre></div>
<p>The default setting is to simulate 1 year of transient data after 250
years of spin-up. Let us increase the transient period to 300 years:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_drivers</span> <span class="op">&lt;-</span> <span class="va">biomee_p_model_luluc_drivers</span></span>
<span><span class="va">df_drivers</span><span class="op">$</span><span class="va">params_siml</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nyeartrend</span> <span class="op">&lt;-</span> <span class="fl">300</span></span></code></pre></div>
<p>Let us have a glance at the LU settings:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_drivers</span><span class="op">$</span><span class="va">init_lu</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 Ã— 2</span></span></span>
<span><span class="co">#&gt;   name      fraction</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> primary          1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> secondary        0</span></span></code></pre></div>
<p>There are two LU defined:</p>
<ul>
<li>
<code>primary</code>: with an initial fraction of 1</li>
<li>
<code>secondary</code>: with an initial fraction of 0</li>
</ul>
<p>The spin-up will use these initial fractions without applying any
land-use change. Note that the names of the LUs are arbitrary: BiomeE do
not infer anything from these names.</p>
<p>Let us now turn our attention to the transition matrix:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_drivers</span><span class="op">$</span><span class="va">luc_forcing</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; , , 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    0  0.4</span></span>
<span><span class="co">#&gt; [2,]    0  0.0</span></span></code></pre></div>
<p>It is a 3-dimensional matrix. The first two dimensions represent a
square matrix of size 2x2 (we have defined 2 LUs), and the third
dimension represents the years, starting from the first transient year.
In this case we have only one year, meaning that there is only one LU
change at the beginning of year 1, then the simulation proceeds without
further LU change for the remaining of the simulation.</p>
</div>
<div class="section level3">
<h3 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h3>
<p>Let us run the simulation:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_sim_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runread_biomee_f.html">runread_biomee_f</a></span><span class="op">(</span><span class="va">df_drivers</span><span class="op">)</span></span></code></pre></div>
<p>Next, we define some convenience functions for displaying plots:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'gridExtra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     combine</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lu_name</span>, <span class="va">variable</span>, <span class="va">out</span>, <span class="va">y_limit</span><span class="op">=</span><span class="cn">NA</span>, <span class="va">yr_start</span><span class="op">=</span><span class="fl">1</span>, <span class="va">yr_label_offset</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tile</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[[</span><span class="va">lu_name</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">lu_name</span> <span class="op">!=</span> <span class="st">'aggregated'</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">tile</span> <span class="op">&lt;-</span> <span class="va">tile</span><span class="op">$</span><span class="va">output_annual_tile</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">tile</span> <span class="op">&lt;-</span> <span class="va">tile</span><span class="op">$</span><span class="va">output_annual_cell</span></span>
<span>  <span class="op">}</span></span>
<span>          </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">variable</span> <span class="op">!=</span> <span class="st">'lu_fraction'</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">tile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span> <span class="op">+</span> <span class="va">yr_label_offset</span>,</span>
<span>                        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op">*</span> <span class="va">lu_fraction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">yr_start</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                          ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">y_limit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">variable</span>, <span class="st">"("</span>, <span class="va">lu_name</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">==</span> <span class="st">'lu_fraction'</span><span class="op">)</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">tile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span> <span class="op">+</span> <span class="va">yr_label_offset</span>,</span>
<span>                        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">yr_start</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                          ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">y_limit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">variable</span>, <span class="st">"("</span>, <span class="va">lu_name</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plot_variable</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">variable</span>, <span class="va">out</span>, <span class="va">yr_start</span><span class="op">=</span><span class="fl">1</span>, <span class="va">yr_label_offset</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">agg</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[[</span><span class="st">'aggregated'</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_cell</span></span>
<span>  <span class="va">y_limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">agg</span><span class="op">[</span><span class="va">variable</span><span class="op">]</span> <span class="op">*</span> <span class="va">agg</span><span class="op">$</span><span class="va">lu_fraction</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.01</span></span>
<span></span>
<span>  <span class="co"># We remove sitename and aggregated</span></span>
<span>  <span class="va">tile_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tile_names</span>, <span class="st">'aggregated'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">names</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/lmap.html" class="external-link">lmap</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">plot1</span><span class="op">(</span><span class="va">x</span>, <span class="va">variable</span>, <span class="va">out</span>, <span class="va">y_limit</span>, <span class="va">yr_start</span>, <span class="va">yr_label_offset</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plot_variables</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">variables</span>, <span class="va">out</span>, <span class="va">yr_start</span><span class="op">=</span><span class="fl">1</span>, <span class="va">yr_label_offset</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">plots</span> <span class="op">&lt;-</span> <span class="va">variables</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/lmap.html" class="external-link">lmap</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">plot_variable</span><span class="op">(</span><span class="va">x</span>, <span class="va">out</span>, <span class="va">yr_start</span>, <span class="va">yr_label_offset</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs<span class="op">=</span><span class="va">plots</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">variables</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We finally plot, for each LU and the aggregated tile, GPP, the litter
carbon (<code>fastSOM</code>), and the LU fraction:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_variables</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'GPP'</span>, <span class="st">'fastSOM'</span>, <span class="st">'lu_fraction'</span><span class="op">)</span>, <span class="va">out_sim_1</span><span class="op">)</span></span></code></pre></div>
<p><img src="biomee_luluc_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Looking at GPP (first row), the primary forest (left column) spins-up
to steady state until year 250 which marks the start of the transient
period. A sharp drop corresponds to the loss of 40% of the area (see
third row). The pattern corresponding to the steady-state continues but
scaled down. We observe a similar behavior for the litter (second
row).</p>
<p>The secondary forest (second column) has no data until year 250 as
the initial fraction was 0. GPP increases until reaching steady-state as
expected. Since the same species is used in both LU, the GPP stabilizes
at the same level (proportionally to the LU fraction). The litter
follows a different pattern: at year 250, it inherits a lot of biomass
from the primary forest. The amount of litter drops sharply due to
natural processes and not replenishment because of the low initial
productivity of the LU. As productivity increases (see GPP), the amount
of litter finally increases again and stabilizes at a level proportional
to its fraction.</p>
<p>The third column displays the aggregated tile, summing each LU
relative to its fraction. GPP shows a sharp drop then recovery. Litter
shows a sharp increase (due to below ground biomass being converted to
litter) followed by a drop (mineralization) then recovery. Finally, as
expected, the fraction of the aggregated tile remains constant
throughout the simulation.</p>
<p>To conclude this demonstration, let us plot the product pools:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">out_sim_1</span><span class="op">$</span><span class="va">aggregated</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_cell</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">prod_pool_1_C</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Prod. pools C (2 years)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">out_sim_1</span><span class="op">$</span><span class="va">aggregated</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_cell</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">prod_pool_2_C</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Prod. pools C (20 years)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="biomee_luluc_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>As expected, the product pools get filled with the wood harvest and
decay with their respective e-folding times.</p>
</div>
</div>
<div class="section level2">
<h2 id="wood-harvest-and-urbanism">Wood harvest and urbanism<a class="anchor" aria-label="anchor" href="#wood-harvest-and-urbanism"></a>
</h2>
<p>We will now implement a more complex scenario. In addition to the one
time transition from a primary to a secondary forest:</p>
<ul>
<li>each year, one thousands of the primary forest is converted to urban
area,</li>
<li>every 40 years, one quarter of the secondary forest is clear-cut
(wood harvest), but the area remains in the same tile.</li>
</ul>
<p>Furthermore, the species planted in the secondary forest are
different than that occurring naturally in the primary forest.</p>
<p>Let us configure these requirements:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_drivers</span> <span class="op">&lt;-</span> <span class="va">biomee_p_model_luluc_drivers</span></span>
<span></span>
<span><span class="co"># We extend the transient period to 300 years</span></span>
<span><span class="va">n_trans</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span><span class="va">df_drivers</span><span class="op">$</span><span class="va">params_siml</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nyeartrend</span> <span class="op">&lt;-</span> <span class="va">n_trans</span></span>
<span></span>
<span><span class="va">lu_defs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>        name      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'primary'</span>, <span class="st">'secondary'</span>, <span class="st">'urban'</span><span class="op">)</span>,</span>
<span>        fraction  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>,</span>
<span>        <span class="co"># We defined which LU can accept vegetation cohorts</span></span>
<span>        <span class="co"># Technically, this was not necessary since no 'lu_index' (see below) points to the third LU</span></span>
<span>        <span class="co"># (but it is a good idea to enforce this anyways)</span></span>
<span>        vegetated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="co"># Equivalently, presets could have been used instead:</span></span>
<span>        <span class="co">#preset = c('unmanaged', 'unmanaged', 'urban')</span></span>
<span><span class="op">)</span></span>
<span><span class="va">n_lu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lu_defs</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initial transition</span></span>
<span><span class="co"># 3 LUs, so each year land-use change is represented by 3x3 transitions.</span></span>
<span><span class="co"># The first 3 numbers are the transitions from each LU to the first LU,</span></span>
<span><span class="co"># the following three numbers are the transitions from each LU to the second LU, and so on.</span></span>
<span><span class="va">initial_transition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.4</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Harvest pattern: clear-cut secondary forest every 40 years by an area </span></span>
<span><span class="co"># corresponding to 10% of the tile (0.1). That corresponds to a fourth of the area </span></span>
<span><span class="co"># of secondary forest (0.4/4 = 0.1).</span></span>
<span><span class="co"># Clear-cuts are represented by self-transitions of LU 2, of area 0.1.</span></span>
<span><span class="va">harvest_pattern</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span>, <span class="fl">39</span><span class="op">)</span>, <span class="co"># null pattern</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># We repeat the harvest pattern enough times</span></span>
<span><span class="va">harvest_transitions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">harvest_pattern</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We define a transition from primary to urban repeated every year</span></span>
<span><span class="va">urban_transition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.0006</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="va">n_trans</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We add all the transition matrix</span></span>
<span><span class="va">transitions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_luc_matrix.html">build_luc_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">initial_transition</span>, <span class="va">harvest_transitions</span>, <span class="va">urban_transition</span><span class="op">)</span>, <span class="va">n_lu</span>, <span class="va">n_trans</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We set the LU definitions and transition forcing in the driver:</span></span>
<span><span class="va">df_drivers</span><span class="op">$</span><span class="va">init_lu</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lu_defs</span></span>
<span><span class="va">df_drivers</span><span class="op">$</span><span class="va">luc_forcing</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="va">transitions_matrix</span></span>
<span></span>
<span><span class="co"># Finally, we configure two cohorts with two different species (see 'init_cohort_species'): one for tile 1 and one for tile 2 (see 'lu_index').</span></span>
<span><span class="co"># LU 3 is an urban tile: it does not accept any cohort.</span></span>
<span><span class="va">df_drivers</span><span class="op">$</span><span class="va">init_cohort</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>        init_cohort_species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,      <span class="co"># species</span></span>
<span>        init_cohort_nindivs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co"># initial individual density, individual/m2 ! 1 indiv/m2 = 10.000 indiv/ha</span></span>
<span>        init_cohort_bl      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.0</span>,  <span class="fl">2</span><span class="op">)</span>, <span class="co"># initial biomass of leaves, kg C/individual</span></span>
<span>        init_cohort_br      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.0</span>,  <span class="fl">2</span><span class="op">)</span>, <span class="co"># initial biomass of fine roots, kg C/individual</span></span>
<span>        init_cohort_bsw     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co"># initial biomass of sapwood, kg C/individual</span></span>
<span>        init_cohort_bHW     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.0</span>,  <span class="fl">2</span><span class="op">)</span>, <span class="co"># initial biomass of heartwood, kg C/tree</span></span>
<span>        init_cohort_seedC   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.0</span>,  <span class="fl">2</span><span class="op">)</span>, <span class="co"># initial biomass of seeds, kg C/individual</span></span>
<span>        init_cohort_nsc     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co"># initial non-structural biomass</span></span>
<span>        lu_index            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>       <span class="co"># index land use (LU) containing this cohort. 0 (default) means any vegetated tile will contain a copy.</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can now run the simulation and display some of the outputs:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_sim_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runread_biomee_f.html">runread_biomee_f</a></span><span class="op">(</span><span class="va">df_drivers</span><span class="op">)</span></span>
<span><span class="fu">plot_variables</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'GPP'</span>, <span class="st">'fastSOM'</span>, <span class="st">'lu_fraction'</span><span class="op">)</span>, <span class="va">out_sim_2</span><span class="op">)</span></span></code></pre></div>
<p><img src="biomee_luluc_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>As expected GPP is null for the urban tile (no vegetation). Note that
the litter for this tile is not zero, but too small to be seen at this
scale.</p>
<p>As before, we can also look at the product pools:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">out_sim_2</span><span class="op">$</span><span class="va">aggregated</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_cell</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">prod_pool_1_C</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Prod. pools C (2 years)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">out_sim_2</span><span class="op">$</span><span class="va">aggregated</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_cell</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">prod_pool_2_C</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Prod. pools C (20 years)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="biomee_luluc_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="crop-rotation-and-land-management">Crop rotation and land management<a class="anchor" aria-label="anchor" href="#crop-rotation-and-land-management"></a>
</h2>
<p>We now model crop rotation and management practices. A primary forest
is initially clear-cut to cultivate crop. Then every two years one third
of the land is left unmanaged (fallow.)</p>
<p>Let us configure these requirements:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_drivers</span> <span class="op">&lt;-</span> <span class="va">biomee_p_model_luluc_drivers</span></span>
<span></span>
<span><span class="co"># We extend the transient period to 300 years</span></span>
<span><span class="va">n_trans</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span><span class="va">df_drivers</span><span class="op">$</span><span class="va">params_siml</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">nyeartrend</span> <span class="op">&lt;-</span> <span class="va">n_trans</span></span>
<span></span>
<span><span class="va">lu_defs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>        name      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'primary'</span>, <span class="st">'crop'</span>, <span class="st">'fallow'</span><span class="op">)</span>,</span>
<span>        fraction  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>,</span>
<span>        <span class="co"># Here we use presets to easily configure some parameters for the cropland</span></span>
<span>        <span class="co"># ('extra_N_input', 'extra_turnover_rate', 'oxidized_litter_fraction')</span></span>
<span>        <span class="co"># preset 'unmanaged' sets all these parameters to 0</span></span>
<span>        preset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'unmanaged'</span>, <span class="st">'cropland'</span>, <span class="st">'unmanaged'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">n_lu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lu_defs</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initial transition</span></span>
<span><span class="co"># 3 LUs, so each year land-use change is represented by 3x3 transitions.</span></span>
<span><span class="co"># The first 3 numbers are the transitions from each LU to the first LU,</span></span>
<span><span class="co"># the following three numbers are the transitions from each LU to the second LU, and so on.</span></span>
<span><span class="va">initial_transition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.66</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.34</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fallow pattern:</span></span>
<span><span class="va">fallow_pattern</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.33</span>, <span class="fl">0</span>, <span class="fl">0.33</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span> <span class="co"># null pattern</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># We repeat the harvest pattern enough times</span></span>
<span><span class="va">fallow_transitions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">harvest_pattern</span>, <span class="fl">150</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We add all the transition matrix</span></span>
<span><span class="va">transitions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_luc_matrix.html">build_luc_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">initial_transition</span>, <span class="va">fallow_transitions</span><span class="op">)</span>, <span class="va">n_lu</span>, <span class="va">n_trans</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We set the LU definitions and transition forcing in the driver:</span></span>
<span><span class="va">df_drivers</span><span class="op">$</span><span class="va">init_lu</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lu_defs</span></span>
<span><span class="va">df_drivers</span><span class="op">$</span><span class="va">luc_forcing</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="va">transitions_matrix</span></span>
<span></span>
<span><span class="co"># We configure three cohorts</span></span>
<span><span class="va">df_drivers</span><span class="op">$</span><span class="va">init_cohort</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>        init_cohort_species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,      <span class="co"># species</span></span>
<span>        init_cohort_nindivs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">3</span><span class="op">)</span>, <span class="co"># initial individual density, individual/m2 ! 1 indiv/m2 = 10.000 indiv/ha</span></span>
<span>        init_cohort_bl      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.0</span>,  <span class="fl">3</span><span class="op">)</span>, <span class="co"># initial biomass of leaves, kg C/individual</span></span>
<span>        init_cohort_br      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.0</span>,  <span class="fl">3</span><span class="op">)</span>, <span class="co"># initial biomass of fine roots, kg C/individual</span></span>
<span>        init_cohort_bsw     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">3</span><span class="op">)</span>, <span class="co"># initial biomass of sapwood, kg C/individual</span></span>
<span>        init_cohort_bHW     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.0</span>,  <span class="fl">3</span><span class="op">)</span>, <span class="co"># initial biomass of heartwood, kg C/tree</span></span>
<span>        init_cohort_seedC   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.0</span>,  <span class="fl">3</span><span class="op">)</span>, <span class="co"># initial biomass of seeds, kg C/individual</span></span>
<span>        init_cohort_nsc     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">3</span><span class="op">)</span>, <span class="co"># initial non-structural biomass</span></span>
<span>        lu_index            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>    <span class="co"># index land use (LU) containing this cohort. 0 (default) means any vegetated tile will contain a copy.</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can now run the simulation as before.</p>
<p>Notes:</p>
<ul>
<li>Crop harvesting is already included in land management (via
<code>oxidized_litter_fraction</code>), so it does not require
self-transitions as for wood harvesting.</li>
<li>This example uses a dummy C4 grass setup (species 1) and should not
be expected to yield meaningful results. For accurate simulations,
please provide values in <code>params_species</code> for the crop you
which to simulate.</li>
</ul>
</div>
<div class="section level2">
<h2 id="luh2-integration">LUH2 integration<a class="anchor" aria-label="anchor" href="#luh2-integration"></a>
</h2>
<p>BiomeE integrates seamlessly with LUH2 v2 data (<a href="https://luh.umd.edu/data.shtml" class="external-link uri">https://luh.umd.edu/data.shtml</a>). To preprocess the LUH2
data for use with BiomeE we can use the separate package
<code>luhrsofun</code> that is available at (<a href="https://github.com/geco-bern/luhrsofun" class="external-link uri">https://github.com/geco-bern/luhrsofun</a>).</p>
<p>The function <code>luhrsofun::parse_luh2()</code> can be used to
parse LUH2 manually and set the necessary data in the driver object
before running BiomeE. This workflow is illustrated in the vignettes of
the <code>luhrsofun</code> package.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/geco-bern" target="_blank" class="external-link">
                          <div class="icon fab fa-github"></div></a>
                        <a href="https://geco-group.org" target="_blank" class="external-link">
                          <div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/SteniBocker/" target="_blank" class="external-link">
                          <div class="icon fab fa-twitter"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://geco-group.org/" class="external-link">GECO</a></li>
                            <li><a href="https://geco-group.org/people/" class="external-link">Our Team</a></li>
                            <li><a href="https://geco-group.org/contact/" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://github.com/geco-bern" class="external-link">Packages</a></li>
                            <li><a href="https://geco-group.org/publication/" class="external-link">Publications</a></li>
                            <li><a href="https://geco-group.org/post/" class="external-link">Blog</a></li>
                        </ul>
</div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>






  </body>
</html>
