<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BiomeE usage • rsofun</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,700;1,300;1,400&amp;display=swap" rel="stylesheet">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- geco --><link href="../geco.css" rel="stylesheet">
<meta property="og:title" content="BiomeE usage">
<!-- Mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js" async integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/config/TeX-AMS-MML_HTMLorMML.js" async integrity="sha256-4zys9A4hMQmtq2EUL+JRoXc0NZi8jVJMzb8onewOaSQ=" crossorigin="anonymous"></script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="external-link hidden-sm hidden-xs" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="external-link hidden-md hidden-lg" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="navbar-brand" href="../index.html">
           <i>rsofun <small>v5.1.0.9000</small></i>
        </a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/geco-bern/rsofun/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>BiomeE usage</h1>
                        <h4 data-toc-skip class="author">Koen Hufkens,
Josefa Arán</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/geco-bern/rsofun/blob/master/vignettes/biomee_use.Rmd" class="external-link"><code>vignettes/biomee_use.Rmd</code></a></small>
      <div class="hidden name"><code>biomee_use.Rmd</code></div>

    </div>

    
    
<p>The <code>rsofun</code> package and framework includes two distinct
simulation models. The <code>p-model</code> and <code>biomee</code>
(which in part relies on p-model component). Below we give a short
example on how to run the <code>biomee</code> model on the included demo
datasets to familiarize yourself with both the data structure and the
outputs.</p>
<div class="section level3">
<h3 id="demo-data">Demo data<a class="anchor" aria-label="anchor" href="#demo-data"></a>
</h3>
<p>The package includes two demo datasets to run simulations at the site
CH-LAE with either the P-model or Leuning photosynthesis models. See
below under ‘Two model approaches’ for a brief description of the
differences. These demo files can be directly loaded into your workspace
by typing:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geco-bern/rsofun" class="external-link">rsofun</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">biomee_gs_leuning_drivers</span></span>
<span><span class="va">biomee_p_model_drivers</span></span>
<span><span class="va">biomee_validation</span></span></code></pre></div>
<p>These are real data from the Swiss CH-LAE fluxnet site. We can use
these data to run the model, together with observations of GPP we can
also parameterize <code>biomee</code> parameters.</p>
</div>
<div class="section level2">
<h2 id="two-model-approaches">Two model approaches<a class="anchor" aria-label="anchor" href="#two-model-approaches"></a>
</h2>
<p>BiomeE is a cohort-based vegetation model which simulates vegetation
dynamics and biogeochemical processes (Weng et al., 2015). The model is
able to link photosynthesis standard models (Farquhar et al., 1980) with
tree allometry. In our formulation we retain the original model
structure with the standard photosynthesis formulation
(i.e. “gs_leuning”) as well as an alternative “p-model” approach. Both
model structures operate at different time scales, where the original
input has an hourly time step our alternative p-model approach uses a
daily time step. Hence, we have two different datasets as driver data
(with the BiomeE p-model input being an aggregate of the high resolution
hourly data).</p>
<div class="section level3">
<h3 id="running-the-biomee-model-with-standard-photosynthesis">Running the BiomeE model with standard photosynthesis<a class="anchor" aria-label="anchor" href="#running-the-biomee-model-with-standard-photosynthesis"></a>
</h3>
<p>With all data prepared we can run the model using
<code><a href="../reference/runread_biomee_f.html">runread_biomee_f()</a></code>. This function takes the nested data
structure and runs the model site by site, returning nested model output
results matching the input drivers. In our case only one site will be
evaluated.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print parameter settings</span></span>
<span><span class="va">biomee_gs_leuning_drivers</span><span class="op">$</span><span class="va">params_siml</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 10</span></span></span>
<span><span class="co">#&gt;   spinupyears recycle firstyeartrend nyeartrend steps_per_day</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         250       1           <span style="text-decoration: underline;">2</span>009          1            24</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: do_U_shaped_mortality &lt;lgl&gt;, do_closedN_run &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   method_photosynth &lt;chr&gt;, method_mortality &lt;chr&gt;, do_daily_diagnostics &lt;lgl&gt;</span></span></span>
<span></span>
<span><span class="co"># print forcing</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">biomee_gs_leuning_drivers</span><span class="op">$</span><span class="va">forcing</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8,760 × 9</span></span></span>
<span><span class="co">#&gt;    date         hod   temp      rain   vpd        ppfd   patm  wind   co2</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2009-01-01     0 0.728  0.000<span style="text-decoration: underline;">018</span>4  54.4 0.000<span style="text-decoration: underline;">000</span>319 <span style="text-decoration: underline;">93</span>216.  3.56  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2009-01-01     1 0.780  0.000<span style="text-decoration: underline;">011</span>6  54.9 0.000<span style="text-decoration: underline;">000</span>322 <span style="text-decoration: underline;">93</span>189.  3.37  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2009-01-01     2 0.519  0.000<span style="text-decoration: underline;">011</span>6  42.9 0.000<span style="text-decoration: underline;">000</span>330 <span style="text-decoration: underline;">93</span>184.  3.01  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2009-01-01     3 0.476  0.000<span style="text-decoration: underline;">011</span>6  47.3 0.000<span style="text-decoration: underline;">000</span>311 <span style="text-decoration: underline;">93</span>166.  3.31  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2009-01-01     4 0.336  0.000<span style="text-decoration: underline;">014</span>0  44.3 0.000<span style="text-decoration: underline;">000</span>322 <span style="text-decoration: underline;">93</span>143.  3.23  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2009-01-01     5 0.278  0.000<span style="text-decoration: underline;">014</span>0  38.4 0.000<span style="text-decoration: underline;">000</span>329 <span style="text-decoration: underline;">93</span>124.  2.94  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2009-01-01     6 0.096<span style="text-decoration: underline;">6</span> 0.000<span style="text-decoration: underline;">014</span>0  28.5 0.000<span style="text-decoration: underline;">000</span>329 <span style="text-decoration: underline;">93</span>114.  2.98  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2009-01-01     7 0.172  0.000<span style="text-decoration: underline;">021</span>1  28.4 0.000<span style="text-decoration: underline;">000</span>335 <span style="text-decoration: underline;">93</span>111.  3.46  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2009-01-01     8 0.236  0.000<span style="text-decoration: underline;">021</span>1  30.1 0.000<span style="text-decoration: underline;">017</span>9   <span style="text-decoration: underline;">93</span>118.  3.31  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2009-01-01     9 0.152  0.000<span style="text-decoration: underline;">021</span>1  24.1 0.000<span style="text-decoration: underline;">078</span>9   <span style="text-decoration: underline;">93</span>132.  3.27  388.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8,750 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run the model</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runread_biomee_f.html">runread_biomee_f</a></span><span class="op">(</span></span>
<span>     <span class="va">biomee_gs_leuning_drivers</span>,</span>
<span>     makecheck <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>     <span class="op">)</span></span>
<span></span>
<span><span class="co"># split out the annual data</span></span>
<span><span class="va">biomee_gs_leuning_output_annual_tile</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_tile</span></span>
<span><span class="va">biomee_gs_leuning_output_annual_cohorts</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_cohorts</span></span></code></pre></div>
<div class="section level4">
<h4 id="plotting-output">Plotting output<a class="anchor" aria-label="anchor" href="#plotting-output"></a>
</h4>
<p>We can now visualize the model output.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we only have one site so we'll unnest</span></span>
<span><span class="co"># the main model output</span></span>
<span><span class="va">biomee_gs_leuning_output_annual_tile</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">GPP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"GPP"</span><span class="op">)</span></span></code></pre></div>
<p><img src="biomee_use_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">biomee_gs_leuning_output_annual_tile</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">plantC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"plantC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="biomee_use_files/figure-html/unnamed-chunk-4-2.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="running-the-biomeep-model">Running the BiomeEP model<a class="anchor" aria-label="anchor" href="#running-the-biomeep-model"></a>
</h3>
<p>Running BiomeE with P-model photosynthesis.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print parameter settings</span></span>
<span><span class="va">biomee_p_model_drivers</span><span class="op">$</span><span class="va">params_siml</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 10</span></span></span>
<span><span class="co">#&gt;   spinupyears recycle firstyeartrend nyeartrend steps_per_day</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         250       1           <span style="text-decoration: underline;">2</span>009          1             1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: do_U_shaped_mortality &lt;lgl&gt;, do_closedN_run &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   method_photosynth &lt;chr&gt;, method_mortality &lt;chr&gt;, do_daily_diagnostics &lt;lgl&gt;</span></span></span>
<span></span>
<span><span class="co"># print forcing for P-model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">biomee_p_model_drivers</span><span class="op">$</span><span class="va">forcing</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 365 × 9</span></span></span>
<span><span class="co">#&gt;    date         hod    temp       rain   vpd      ppfd   patm  wind   co2</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2009-01-01  11.5  0.384  0.000<span style="text-decoration: underline;">016</span>6   39.5 0.000<span style="text-decoration: underline;">057</span>1 <span style="text-decoration: underline;">93</span>092.  3.00  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2009-01-02  11.5 -<span style="color: #BB0000;">1.64</span>   0.000<span style="text-decoration: underline;">023</span>2   40.5 0.000<span style="text-decoration: underline;">049</span>9 <span style="text-decoration: underline;">93</span>248.  2.97  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2009-01-03  11.5 -<span style="color: #BB0000;">2.51</span>   0.000<span style="text-decoration: underline;">003</span>71  75.9 0.000<span style="text-decoration: underline;">094</span>9 <span style="text-decoration: underline;">93</span>684.  2.84  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2009-01-04  11.5 -<span style="color: #BB0000;">1.82</span>   0.000<span style="text-decoration: underline;">013</span>0   88.0 0.000<span style="text-decoration: underline;">070</span>6 <span style="text-decoration: underline;">93</span>435.  2.67  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2009-01-05  11.5 -<span style="color: #BB0000;">1.34</span>   0.000<span style="text-decoration: underline;">022</span>3   67.8 0.000<span style="text-decoration: underline;">073</span>9 <span style="text-decoration: underline;">93</span>175.  3.21  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2009-01-06  11.5 -<span style="color: #BB0000;">0.450</span>  0.000<span style="text-decoration: underline;">021</span>9   54.0 0.000<span style="text-decoration: underline;">052</span>8 <span style="text-decoration: underline;">93</span>282.  3.03  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2009-01-07  11.5  0.266  0.000<span style="text-decoration: underline;">013</span>6   64.1 0.000<span style="text-decoration: underline;">071</span>1 <span style="text-decoration: underline;">93</span>511.  2.64  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2009-01-08  11.5  0.504  0.000<span style="text-decoration: underline;">011</span>3   88.2 0.000<span style="text-decoration: underline;">090</span>5 <span style="text-decoration: underline;">93</span>443.  2.68  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2009-01-09  11.5  0.086<span style="text-decoration: underline;">9</span> 0.000<span style="text-decoration: underline;">018</span>6   59.9 0.000<span style="text-decoration: underline;">051</span>6 <span style="text-decoration: underline;">93</span>447.  2.74  388.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2009-01-10  11.5 -<span style="color: #BB0000;">0.404</span>  0.000<span style="text-decoration: underline;">012</span>5   58.6 0.000<span style="text-decoration: underline;">082</span>7 <span style="text-decoration: underline;">93</span>633.  2.17  388.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 355 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run the model</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runread_biomee_f.html">runread_biomee_f</a></span><span class="op">(</span></span>
<span>     <span class="va">biomee_p_model_drivers</span>,</span>
<span>     makecheck <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>     <span class="op">)</span></span>
<span></span>
<span><span class="co"># split out the annual data for visuals</span></span>
<span><span class="va">biomee_p_model_output_annual_tile</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_tile</span></span>
<span><span class="va">biomee_p_model_output_annual_cohorts</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_cohorts</span></span></code></pre></div>
<div class="section level4">
<h4 id="plotting-output-1">Plotting output<a class="anchor" aria-label="anchor" href="#plotting-output-1"></a>
</h4>
<p>We can now visualize the model output.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we only have one site so we'll unnest</span></span>
<span><span class="co"># the main model output</span></span>
<span><span class="va">biomee_p_model_output_annual_tile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">GPP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"GPP"</span><span class="op">)</span></span></code></pre></div>
<p><img src="biomee_use_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">biomee_p_model_output_annual_tile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">plantC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"plantC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="biomee_use_files/figure-html/unnamed-chunk-7-2.png" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">biomee_p_model_output_annual_cohorts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">cID</span>,<span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>dbh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">DBH</span><span class="op">)</span>, </span>
<span>            npp_per_m2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">NPP</span><span class="op">*</span><span class="va">density</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"keep"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dbh</span>,y<span class="op">=</span><span class="va">npp_per_m2</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Cohort DBH (cm)"</span>, y <span class="op">=</span> <span class="st">"NPP (kg C m-2)"</span>, fill<span class="op">=</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey50"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>,<span class="fl">1.0</span><span class="op">)</span>, legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>,<span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2</span></span>
<span><span class="co">#&gt; 3.5.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use the `legend.position.inside` argument of `theme()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="biomee_use_files/figure-html/unnamed-chunk-7-3.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="calibrating-model-parameters">Calibrating model parameters<a class="anchor" aria-label="anchor" href="#calibrating-model-parameters"></a>
</h3>
<p>To optimize new parameters based upon driver data and a validation
dataset we must first specify an optimization strategy and settings, as
well as parameter ranges. In this example, we use as cost the root mean
squared error (RMSE) between simulated and observed targets (GPP, LAI,
Density and Biomass) and we minimize it using the <code>GenSA</code>
optimizer.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Mortality as DBH</span></span>
<span><span class="va">settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="st">"GenSA"</span>,</span>
<span>  metric <span class="op">=</span> <span class="va">cost_rmse_biomee</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    maxit <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      phiRL     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lower<span class="op">=</span><span class="fl">0.5</span>, upper<span class="op">=</span><span class="fl">5</span>,   init<span class="op">=</span><span class="fl">3.5</span><span class="op">)</span>,</span>
<span>      LAI_light <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lower<span class="op">=</span><span class="fl">2</span>,   upper<span class="op">=</span><span class="fl">8</span>,   init<span class="op">=</span><span class="fl">3.5</span><span class="op">)</span>,</span>
<span>      tf_base   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lower<span class="op">=</span><span class="fl">0.5</span>, upper<span class="op">=</span><span class="fl">1.5</span>, init<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      par_mort  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lower<span class="op">=</span><span class="fl">0.005</span>, upper<span class="op">=</span><span class="fl">4</span>,   init<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using BiomeEP (with P-model for photosynthesis)</span></span>
<span><span class="va">pars_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_sofun.html">calib_sofun</a></span><span class="op">(</span></span>
<span>  drivers <span class="op">=</span> <span class="va">biomee_p_model_drivers</span>,</span>
<span>  obs <span class="op">=</span> <span class="va">biomee_validation</span>,</span>
<span>  settings <span class="op">=</span> <span class="va">settings</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="va">pars_all</span><span class="op">[</span><span class="st">"par"</span><span class="op">]</span></span></code></pre></div>
<p>Using the calibrated parameter values, we can run again the BiomeE
simulations.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># replace parameter values by calibration output</span></span>
<span><span class="va">drivers</span> <span class="op">&lt;-</span> <span class="va">biomee_p_model_drivers</span></span>
<span><span class="va">drivers</span><span class="op">$</span><span class="va">params_species</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">phiRL</span><span class="op">[</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">drivers</span><span class="op">$</span><span class="va">params_species</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LAI_light</span><span class="op">[</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">drivers</span><span class="op">$</span><span class="va">params_tile</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tf_base</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">drivers</span><span class="op">$</span><span class="va">params_tile</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">par_mort</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="va">drivers</span><span class="op">$</span><span class="va">params_siml</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">spinupyears</span> <span class="op">&lt;-</span> <span class="fl">600</span></span>
<span></span>
<span><span class="co"># run the model with new parameter values</span></span>
<span><span class="va">calibrated_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runread_biomee_f.html">runread_biomee_f</a></span><span class="op">(</span></span>
<span>     <span class="va">drivers</span>,</span>
<span>     makecheck <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>     <span class="op">)</span></span>
<span></span>
<span><span class="co"># split out the annual data</span></span>
<span><span class="va">biomee_p_model_calibratedOutput_annual_tile</span> <span class="op">&lt;-</span> <span class="va">calibrated_out</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_tile</span></span></code></pre></div>
<p>Finally, we can visually compare the two model runs. We plot the
original model run in black and the run using the calibrated parameters
in grey. The dashed line represents the validation data, i.e. the
observed GPP and Biomass.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># unnest model output for our single site</span></span>
<span><span class="va">GPP_target</span> <span class="op">&lt;-</span> <span class="va">biomee_validation</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variables</span><span class="op">==</span><span class="st">"GPP"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"targets_obs"</span><span class="op">)</span></span>
<span><span class="va">plantC_target</span> <span class="op">&lt;-</span> <span class="va">biomee_validation</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variables</span><span class="op">==</span><span class="st">"Biomass"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract2</a></span><span class="op">(</span><span class="st">"targets_obs"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">biomee_p_model_output_annual_tile</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">GPP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">biomee_p_model_calibratedOutput_annual_tile</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">GPP</span><span class="op">)</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">GPP_target</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"GPP"</span><span class="op">)</span></span></code></pre></div>
<p><img src="biomee_use_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">biomee_p_model_output_annual_tile</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">plantC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">biomee_p_model_calibratedOutput_annual_tile</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">plantC</span><span class="op">)</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">plantC_target</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"plantC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="biomee_use_files/figure-html/unnamed-chunk-11-2.png" width="672">
## Validating model output</p>
<p>To ensure behavior of the calibrated model is as expected its output
should be validated with different consistency checks. One possible
check is to ensure that it reached the expected steady state conditions
and that no trend is present in total carbon. Note how the vegetation C
pool reaches a steady state relatively fast, while the soil C pool takes
more time:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">pl1</span> <span class="op">&lt;-</span> <span class="va">biomee_p_model_calibratedOutput_annual_tile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">plantC</span><span class="op">+</span><span class="va">soilC</span>, color <span class="op">=</span> <span class="st">"total C"</span>, linetype <span class="op">=</span> <span class="st">"total C"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">soilC</span>,        color <span class="op">=</span> <span class="st">"soil C"</span>,  linetype <span class="op">=</span> <span class="st">"soil C"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">plantC</span>,       color <span class="op">=</span> <span class="st">"plant C"</span>, linetype <span class="op">=</span> <span class="st">"plant C"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># geom_hline(yintercept = plantC_target, linetype = "solid", color = "grey50") +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total C"</span><span class="op">=</span><span class="st">"black"</span>,</span>
<span>                                <span class="st">"soil C"</span> <span class="op">=</span><span class="st">"darkred"</span>,</span>
<span>                                <span class="st">"plant C"</span><span class="op">=</span><span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total C"</span><span class="op">=</span><span class="fl">3</span>,</span>
<span>                                   <span class="st">"soil C"</span> <span class="op">=</span><span class="fl">2</span>,</span>
<span>                                   <span class="st">"plant C"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"kg C m-2"</span>, linetype <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span>, legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pl2</span> <span class="op">&lt;-</span> <span class="va">biomee_p_model_calibratedOutput_annual_tile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># geom_line(aes(y = NPP,          color = "plant: NPP", linetype = "plant: NPP")) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">GPP</span>,          color <span class="op">=</span> <span class="st">"plant: GPP"</span>,           linetype <span class="op">=</span> <span class="st">"plant: GPP"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">GPP</span><span class="op">-</span><span class="va">Rauto</span>,    color <span class="op">=</span> <span class="st">"plant: NPP=GPP-Rauto"</span>, linetype <span class="op">=</span> <span class="st">"plant: NPP=GPP-Rauto"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Rh</span>,           color <span class="op">=</span> <span class="st">"soil: Rh"</span>,             linetype <span class="op">=</span> <span class="st">"soil: Rh"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">NPP</span><span class="op">-</span><span class="va">Rh</span>,       color <span class="op">=</span> <span class="st">"total: NEE=NPP-Rh"</span>,    linetype <span class="op">=</span> <span class="st">"total: NEE=NPP-Rh"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># geom_hline(yintercept = GPP_target, linetype = "solid", color = "grey50") +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total: NEE=NPP-Rh"</span>   <span class="op">=</span><span class="st">"black"</span>,</span>
<span>                                <span class="st">"soil: Rh"</span>           <span class="op">=</span><span class="st">"darkred"</span>,</span>
<span>                                <span class="st">"plant: GPP"</span>          <span class="op">=</span><span class="st">"darkgreen"</span>,</span>
<span>                                <span class="st">"plant: NPP"</span>          <span class="op">=</span><span class="st">"darkgreen"</span>,</span>
<span>                                <span class="st">"plant: NPP=GPP-Rauto"</span><span class="op">=</span><span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total: NEE=NPP-Rh"</span>   <span class="op">=</span><span class="fl">3</span>,</span>
<span>                                     <span class="st">"soil: Rh"</span>           <span class="op">=</span><span class="fl">2</span>,</span>
<span>                                     <span class="st">"plant: GPP"</span>          <span class="op">=</span><span class="fl">1</span>,</span>
<span>                                     <span class="st">"plant: NPP"</span>          <span class="op">=</span><span class="fl">2</span>,</span>
<span>                                     <span class="st">"plant: NPP=GPP-Rauto"</span><span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"kg C m-2 yr-1"</span>, linetype <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span>, legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pl1</span> <span class="op">/</span> <span class="va">pl2</span> <span class="co"># patchwork</span></span></code></pre></div>
<p><img src="biomee_use_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>Note that for the carbon cycle the steady state assumption appears to
be good. However, for the nitrogen cycle we see that. If your analysis
relies on nitrogen being in steady-state the spinupyears might need to
be increased.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl3</span> <span class="op">&lt;-</span> <span class="va">biomee_p_model_calibratedOutput_annual_tile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">plantN</span><span class="op">+</span><span class="va">soilN</span>, color <span class="op">=</span> <span class="st">"total N"</span>, linetype <span class="op">=</span> <span class="st">"total N"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">soilN</span>,        color <span class="op">=</span> <span class="st">"soil N"</span>,  linetype <span class="op">=</span> <span class="st">"soil N"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">plantN</span>,       color <span class="op">=</span> <span class="st">"plant N"</span>, linetype <span class="op">=</span> <span class="st">"plant N"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total N"</span><span class="op">=</span><span class="st">"black"</span>,</span>
<span>                                <span class="st">"soil N"</span> <span class="op">=</span><span class="st">"darkred"</span>,</span>
<span>                                <span class="st">"plant N"</span><span class="op">=</span><span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total N"</span><span class="op">=</span><span class="fl">3</span>,</span>
<span>                                   <span class="st">"soil N"</span> <span class="op">=</span><span class="fl">2</span>,</span>
<span>                                   <span class="st">"plant N"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"kg N m-2"</span>, linetype <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span>, legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pl3</span></span></code></pre></div>
<p><img src="biomee_use_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/geco-bern" target="_blank" class="external-link">
                          <div class="icon fab fa-github"></div></a>
                        <a href="https://geco-group.org" target="_blank" class="external-link">
                          <div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/SteniBocker/" target="_blank" class="external-link">
                          <div class="icon fab fa-twitter"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://geco-group.org/" class="external-link">GECO</a></li>
                            <li><a href="https://geco-group.org/people/" class="external-link">Our Team</a></li>
                            <li><a href="https://geco-group.org/contact/" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://github.com/geco-bern" class="external-link">Packages</a></li>
                            <li><a href="https://geco-group.org/publication/" class="external-link">Publications</a></li>
                            <li><a href="https://geco-group.org/post/" class="external-link">Blog</a></li>
                        </ul>
</div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>






  </body>
</html>
