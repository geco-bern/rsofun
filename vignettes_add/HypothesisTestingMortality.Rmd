---
title: "Hypothesis testing"
output:
  html_document: 
    fig_width: 10
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
library(dplyr)
library(rsofun)
library(ggplot2)
```

## Example

### Simulation settings

Manually select some sites from which we're going to use the data for evaluation and calibration.
```{r}
mysites <- c("ORNL")
```

Create a site meta info table that contains all the site-specific information that is used to force site-simulations (e.g. starting year, number of simulations years, elevation, etc.). For FLUXNET2015 data, required meta info is provided by the `rsofun` package (data frame `rsofun::metainfo_Tier1_sites_kgclimate_fluxnet2015`).
```{r}
siteinfo <- data.frame(sitename="ORNL", lon = 0.0, lat = 0.0, elv = 0.0)
```

Now specify the simulation parameters that are identical for all site-scale simulations.
```{r}
params_siml <- list(
      spinup                = TRUE,
      spinupyears           = 1800, #1793,
      recycle               = 1, # 9 or 11 changed to 1 when aggregating forcing into 1 year
      firstyeartrend        = 1998,
      nyeartrend            = 1, #9 or 11 (longer transient years)
      outputhourly          = TRUE,
      outputdaily           = TRUE,
      do_U_shaped_mortality = FALSE,
      update_annualLAImax   = FALSE,
      do_closedN_run        = TRUE,
      method_photosynth     = "gs_leuning", # gs_leuning or pmodel
      method_mortality      = "dbh" # dbh or cstarvation or growthrate or const_selfthin
      )
```

### Define model parameters

#### Tile-level parameters

```{r}
params_tile <- list(
  soiltype     = 3,     # Sand = 1, LoamySand = 2, SandyLoam = 3, SiltLoam = 4, FrittedClay = 5, Loam = 6, Clay = 7
  FLDCAP       = 0.4,   # soil property: field capacity 
  WILTPT       = 0.05,  # soil property: wilting point
  K1           = 2.0,   # turnover rate of fast SOM per year
  K2           = 0.05,  # turnover rate of slow SOM per year
  K_nitrogen   = 8.0,   # mineral Nitrogen turnover rate
  MLmixRatio   = 0.8,   # the ratio of C and N returned to litters from microbes
  etaN         = 0.025, # loss rate with runoff
  LMAmin       = 0.02,  # minimum LMA, boundary condition
  fsc_fine     = 1.0,   # fraction of fast turnover carbon in fine biomass
  fsc_wood     = 0.0,   # fraction of fast turnover carbon in wood biomass
  GR_factor    = 0.33,  # growth respiration factor
  l_fract      = 0.0,   # fraction of the carbon retained after leaf drop
  retransN     = 0.0,   # retranslocation coefficient of Nitrogen
  f_initialBSW = 0.2,
  f_N_add      = 0.02   # re-fill of N for sapwood
  )

```

#### Species-level parameters

```{r}
params_species <- tibble(
  lifeform      = rep(1,16),                 # 0 for grasses; 1 for trees
  phenotype     = rep(0,16),                 # 0 for Deciduous; 1 for Evergreen
  pt            = rep(0,16),                 # 0 for C3; 1 for C4
  seedlingsize  = rep(0.05,16),              # initial size of seedlings
  LMA           = rep(0.035,16),             # Leaf mass per unit area: 0.035, 0.085, 0.135
  phiRL         = rep(3.5,16),               # Root:Shoot ratio:  4.0, 6.0, 8.0
  LNbase        = rep(0.8E-3,16),            # kgN m-2 leaf, Vmax = 0.03125*LNbase
  laimax        = rep(3.5,16),               # maximum crown LAI
  LAI_light     = rep(4.0,16),               # Light-limited crown LAI
  Nfixrate0     = rep(0,16),                 # 0.03 kgN kgRootC-1 yr-1
  NfixCost0     = rep(12,16),                # 12, 24 gC/gN
  phiCSA        = rep(0.25E-4,16),           # ratio of sapwood area to leaf area
  mortrate_d_c  = rep(0.01,16),              # canopy tree mortality rate, year-1
  mortrate_d_u  = rep(0.075,16),             # understory tree mortality rate, year-1
  maturalage    = rep(5,16),                 # the age that can reproduce
  fNSNmax       = rep(5,16)                  # multiplier for NSNmax as sum of potential bl and br
  ) 
```

#### Soil parameters

By layers.
```{r}
# adopted from datatypes.mod.f90 l.538
params_soil <- tibble(
  type              = c("Coarse","Medium","Fine","CM","CF","MF","CMF","Peat","MCM"),
  GMD               = c(0.7, 0.4, 0.3, 0.1, 0.1, 0.07, 0.007, 0.3, 0.3),
  GSD               = c(5.0, 5.3, 7.4, 6.1, 6.1, 14.0, 15.0, 7.4, 7.4),
  vwc_sat           = c(0.380, 0.445, 0.448, 0.412, 0.414, 0.446, 0.424, 0.445, 0.445),
  chb               = c(3.5,6.4,11.0,4.8,6.3,8.4,6.3,6.4,6.4),
  psi_sat_ref       = c(-600, -790, -910, -1580, -1680, -1880, -5980, -790, -790), # Pa
  k_sat_ref         = c(130.8, 75.1, 53.2, 12.1, 11.1, 12.7, 1.69, 53.2, 53.2), # mol/(s MPa m)
  alphaSoil         = rep(1, 9),
  heat_capacity_dry = c(1.2e6, 1.1e6, 1.1e6, 1.1e6, 1.1e6, 1.1e6, 1.1e6, 1.4e6, 1.0)
  )
```

#### Initial cohort specification

```{r}
init_cohort <- tibble(
 init_cohort_species = rep(2, 10),
 init_cohort_nindivs = rep(1,10),    # initial individual density, individual/m2
 init_cohort_bsw     = rep(0.05,10), # initial biomass of sapwood, kg C/individual
 init_cohort_bHW     = rep(0.0, 10), # initial biomass of heartwood, kg C/tree
 init_cohort_nsc     = rep(0.05,10)  # initial non-structural biomass
)
```

#### Initial soil pools

high N input --> Deciduous, low  N input --> Evergreen
```{r}
init_soil <- list(
 init_fast_soil_C    = 0.0,    # initial fast soil C, kg C/m2
 init_slow_soil_C    = 0.0,    # initial slow soil C, kg C/m2
 init_Nmineral       = 0.015,  # Mineral nitrogen pool, (kg N/m2)
 N_input             = 0.0008  # annual N input to soil N pool, kgN m-2 yr-1
)
```

### Define soil parameters

For now, this is implemented as an illustration. Should be made site-specific.
```{r}
df_soiltexture <- bind_rows(
  top    = tibble(layer = "top", fsand = 0.4, fclay = 0.3, forg = 0.1, fgravel = 0.1),
  bottom = tibble(layer = "bottom", fsand = 0.4, fclay = 0.3, forg = 0.1, fgravel = 0.1)
)
```

### Get input

```{r}
forcing <- read_delim( paste0(path.package("rsofun"), "/extdata/ORNL_forcing.txt"), col_names = TRUE, delim = "\t") %>% 
  mutate(date = lubridate::ymd_hm( paste0( as.character(YEAR), "-01-01 00:00" ) ) + days(DOY-1) + hours(HOUR) ) %>% 
  mutate(sitename = "ORNL") %>% 
  dplyr::filter(!(mday(date)==29 & month(date)==2))

## convert rain to units per seconds
dt_secs <- lubridate::interval(forcing$date[1], forcing$date[2]) %>% 
  time_length("seconds")
forcing <- forcing %>% 
  mutate(RAIN = RAIN / dt_secs)

if (params_siml$method_photosynth == "gs_leuning"){
  forcing <- forcing %>% 
    dplyr::group_by(lubridate::month(date),lubridate::day(date),lubridate::hour(date)) %>% 
    summarise_at(vars(1:13), list(~mean(., na.rm = TRUE)))
  forcing <- forcing[,-c(1:3)]
}

```

For P-model runs, aggregate to daily forcing.
```{r}
if (params_siml$method_photosynth == "pmodel" && dt_secs != (60*60*24)){
#  forcing <- forcing %>% 
#    dplyr::group_by(lubridate::date(date)) %>% 
#    summarise_at(vars(1:13), list(~mean(., na.rm = TRUE))) %>% 
#    dplyr::select(-1)
  forcing <- forcing %>% 
    dplyr::group_by(lubridate::month(date),lubridate::day(date)) %>% 
    summarise_at(vars(1:13), list(~mean(., na.rm = TRUE)))
  forcing <- forcing[,-c(1:2)]
}

# Changing values of PAR for running simulations
#forcing <- forcing %>% mutate(PAR = PAR*1.30) # levels = *1, *1.15 and *1.30

# Replicating forcing data to run longer transient years
#forcing <- bind_rows(replicate(10, forcing, simplify = FALSE))

```

### Run the model for different cases

Run the model for all environmental conditions, species and mortality formulations.
```{r}
out <- run_lm3ppa_f_bysite( "ORNL", 
                            params_siml, 
                            siteinfo, 
                            forcing, # ddf_input
                            params_tile, 
                            params_species, 
                            params_soil, 
                            init_cohort, 
                            init_soil, 
                            makecheck = TRUE)

out$output_annual_tile %>% 
  ggplot() +
  geom_line(aes(x = year, y = GPP)) +
  theme_classic()+labs(x = "Year", y = "GPP")

out$output_annual_tile %>% 
  ggplot() +
  geom_line(aes(x = year, y = plantC)) +
  theme_classic()+labs(x = "Year", y = "plantC")

out$output_annual_tile %>% 
  ggplot() + geom_line(aes(x = year, y = CAI)) +
  theme_classic()+labs(x = "Year", y = "CAI")

out$output_annual_tile %>% summarise(GPPtotal=sum(GPP))
forcing %>% summarise(PARtotal=sum(PAR))
out$output_annual_tile %>% summarise(GPPtotal=mean(GPP))
forcing %>% summarise(PARtotal=mean(PAR))
```

### Write model outputs
```{r}
# gs-leuning Mortality a) DBH
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea1sa1magl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea1sa1magl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea1sa1magl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea1sa1magl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea1sa1magl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea2sa1magl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea2sa1magl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea2sa1magl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea2sa1magl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea2sa1magl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea3sa1magl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea3sa1magl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea3sa1magl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea3sa1magl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea3sa1magl_out_annual_cohorts.csv")

# p-model Mortality a) DBH
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea1sa1mapm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea1sa1mapm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea1sa1mapm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea1sa1mapm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea1sa1mapm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea2sa1mapm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea2sa1mapm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea2sa1mapm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea2sa1mapm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea2sa1mapm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea3sa1mapm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea3sa1mapm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea3sa1mapm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea3sa1mapm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea3sa1mapm_out_annual_cohorts.csv")

# gs-leuning Mortality b) C starvation
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea1sa1mbgl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea1sa1mbgl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea1sa1mbgl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea1sa1mbgl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea1sa1mbgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea2sa1mbgl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea2sa1mbgl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea2sa1mbgl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea2sa1mbgl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea2sa1mbgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea3sa1mbgl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea3sa1mbgl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea3sa1mbgl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea3sa1mbgl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea3sa1mbgl_out_annual_cohorts.csv")

# p-model Mortality b) C starvation
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea1sa1mbpm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea1sa1mbpm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea1sa1mbpm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea1sa1mbpm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea1sa1mbpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea2sa1mbpm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea2sa1mbpm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea2sa1mbpm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea2sa1mbpm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea2sa1mbpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea3sa1mbpm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea3sa1mbpm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea3sa1mbpm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea3sa1mbpm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea3sa1mbpm_out_annual_cohorts.csv")

# gs-leuning Mortality c) Growth rate
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea1sa1mcgl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea1sa1mcgl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea1sa1mcgl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea1sa1mcgl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea1sa1mcgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea2sa1mcgl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea2sa1mcgl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea2sa1mcgl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea2sa1mcgl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea2sa1mcgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea3sa1mcgl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea3sa1mcgl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea3sa1mcgl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea3sa1mcgl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea3sa1mcgl_out_annual_cohorts.csv")

# p-model Mortality c) Growth rate
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea1sa1mcpm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea1sa1mcpm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea1sa1mcpm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea1sa1mcpm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea1sa1mcpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea2sa1mcpm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea2sa1mcpm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea2sa1mcpm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea2sa1mcpm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea2sa1mcpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea3sa1mcpm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea3sa1mcpm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea3sa1mcpm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea3sa1mcpm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea3sa1mcpm_out_annual_cohorts.csv")

# gs-leuning Mortality d) Constant Self-thinning
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea1sa1mdgl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea1sa1mdgl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea1sa1mdgl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea1sa1mdgl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea1sa1mdgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea2sa1mdgl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea2sa1mdgl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea2sa1mdgl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea2sa1mdgl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea2sa1mdgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea3sa1mdgl_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea3sa1mdgl_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea3sa1mdgl_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea3sa1mdgl_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea3sa1mdgl_out_annual_cohorts.csv")

# p-model Mortality d) Constant Self-thinning
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea1sa1mdpm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea1sa1mdpm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea1sa1mdpm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea1sa1mdpm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea1sa1mdpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea2sa1mdpm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea2sa1mdpm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea2sa1mdpm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea2sa1mdpm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea2sa1mdpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(out$output_hourly_tile,   "ea3sa1mdpm_out_hourly_tile.csv")
write.csv(out$output_daily_tile,    "ea3sa1mdpm_out_daily_tile.csv")
write.csv(out$output_daily_cohorts, "ea3sa1mdpm_out_daily_cohorts.csv")
write.csv(out$output_annual_tile,   "ea3sa1mdpm_out_annual_tile.csv")
write.csv(out$output_annual_cohorts,"ea3sa1mdpm_out_annual_cohorts.csv")

```

### Read model outputs

```{r}
# gs-leuning Mortality a) DBH
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea1sa1magl_out_hourly_tile <- read.csv("ea1sa1magl_out_hourly_tile.csv")
ea1sa1magl_out_daily_tile  <- read.csv("ea1sa1magl_out_daily_tile.csv")
ea1sa1magl_out_daily_cohorts  <- read.csv("ea1sa1magl_out_daily_cohorts.csv")
ea1sa1magl_out_annual_tile  <- read.csv("ea1sa1magl_out_annual_tile.csv")
ea1sa1magl_out_annual_cohorts  <- read.csv("ea1sa1magl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea2sa1magl_out_hourly_tile <- read.csv("ea2sa1magl_out_hourly_tile.csv")
ea2sa1magl_out_daily_tile  <- read.csv("ea2sa1magl_out_daily_tile.csv")
ea2sa1magl_out_daily_cohorts  <- read.csv("ea2sa1magl_out_daily_cohorts.csv")
ea2sa1magl_out_annual_tile  <- read.csv("ea2sa1magl_out_annual_tile.csv")
ea2sa1magl_out_annual_cohorts  <- read.csv("ea2sa1magl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea3sa1magl_out_hourly_tile <- read.csv("ea3sa1magl_out_hourly_tile.csv")
ea3sa1magl_out_daily_tile  <- read.csv("ea3sa1magl_out_daily_tile.csv")
ea3sa1magl_out_daily_cohorts  <- read.csv("ea3sa1magl_out_daily_cohorts.csv")
ea3sa1magl_out_annual_tile  <- read.csv("ea3sa1magl_out_annual_tile.csv")
ea3sa1magl_out_annual_cohorts  <- read.csv("ea3sa1magl_out_annual_cohorts.csv")

# p-model Mortality a) DBH
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea1sa1mapm_out_hourly_tile <- read.csv("ea1sa1mapm_out_hourly_tile.csv")
ea1sa1mapm_out_daily_tile  <- read.csv("ea1sa1mapm_out_daily_tile.csv")
ea1sa1mapm_out_daily_cohorts  <- read.csv("ea1sa1mapm_out_daily_cohorts.csv")
ea1sa1mapm_out_annual_tile  <- read.csv("ea1sa1mapm_out_annual_tile.csv")
ea1sa1mapm_out_annual_cohorts  <- read.csv("ea1sa1mapm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea2sa1mapm_out_hourly_tile <- read.csv("ea2sa1mapm_out_hourly_tile.csv")
ea2sa1mapm_out_daily_tile  <- read.csv("ea2sa1mapm_out_daily_tile.csv")
ea2sa1mapm_out_daily_cohorts  <- read.csv("ea2sa1mapm_out_daily_cohorts.csv")
ea2sa1mapm_out_annual_tile  <- read.csv("ea2sa1mapm_out_annual_tile.csv")
ea2sa1mapm_out_annual_cohorts  <- read.csv("ea2sa1mapm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea3sa1mapm_out_hourly_tile <- read.csv("ea3sa1mapm_out_hourly_tile.csv")
ea3sa1mapm_out_daily_tile  <- read.csv("ea3sa1mapm_out_daily_tile.csv")
ea3sa1mapm_out_daily_cohorts  <- read.csv("ea3sa1mapm_out_daily_cohorts.csv")
ea3sa1mapm_out_annual_tile  <- read.csv("ea3sa1mapm_out_annual_tile.csv")
ea3sa1mapm_out_annual_cohorts  <- read.csv("ea3sa1mapm_out_annual_cohorts.csv")

# gs-leuning Mortality b) C starvation
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea1sa1mbgl_out_hourly_tile <- read.csv("ea1sa1mbgl_out_hourly_tile.csv")
ea1sa1mbgl_out_daily_tile  <- read.csv("ea1sa1mbgl_out_daily_tile.csv")
ea1sa1mbgl_out_daily_cohorts  <- read.csv("ea1sa1mbgl_out_daily_cohorts.csv")
ea1sa1mbgl_out_annual_tile  <- read.csv("ea1sa1mbgl_out_annual_tile.csv")
ea1sa1mbgl_out_annual_cohorts  <- read.csv("ea1sa1mbgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea2sa1mbgl_out_hourly_tile <- read.csv("ea2sa1mbgl_out_hourly_tile.csv")
ea2sa1mbgl_out_daily_tile  <- read.csv("ea2sa1mbgl_out_daily_tile.csv")
ea2sa1mbgl_out_daily_cohorts  <- read.csv("ea2sa1mbgl_out_daily_cohorts.csv")
ea2sa1mbgl_out_annual_tile  <- read.csv("ea2sa1mbgl_out_annual_tile.csv")
ea2sa1mbgl_out_annual_cohorts  <- read.csv("ea2sa1mbgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea3sa1mbgl_out_hourly_tile <- read.csv("ea3sa1mbgl_out_hourly_tile.csv")
ea3sa1mbgl_out_daily_tile  <- read.csv("ea3sa1mbgl_out_daily_tile.csv")
ea3sa1mbgl_out_daily_cohorts  <- read.csv("ea3sa1mbgl_out_daily_cohorts.csv")
ea3sa1mbgl_out_annual_tile  <- read.csv("ea3sa1mbgl_out_annual_tile.csv")
ea3sa1mbgl_out_annual_cohorts  <- read.csv("ea3sa1mbgl_out_annual_cohorts.csv")

# p-model Mortality b) C starvation
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea1sa1mbpm_out_hourly_tile <- read.csv("ea1sa1mbpm_out_hourly_tile.csv")
ea1sa1mbpm_out_daily_tile  <- read.csv("ea1sa1mbpm_out_daily_tile.csv")
ea1sa1mbpm_out_daily_cohorts  <- read.csv("ea1sa1mbpm_out_daily_cohorts.csv")
ea1sa1mbpm_out_annual_tile  <- read.csv("ea1sa1mbpm_out_annual_tile.csv")
ea1sa1mbpm_out_annual_cohorts  <- read.csv("ea1sa1mbpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea2sa1mbpm_out_hourly_tile <- read.csv("ea2sa1mbpm_out_hourly_tile.csv")
ea2sa1mbpm_out_daily_tile  <- read.csv("ea2sa1mbpm_out_daily_tile.csv")
ea2sa1mbpm_out_daily_cohorts  <- read.csv("ea2sa1mbpm_out_daily_cohorts.csv")
ea2sa1mbpm_out_annual_tile  <- read.csv("ea2sa1mbpm_out_annual_tile.csv")
ea2sa1mbpm_out_annual_cohorts  <- read.csv("ea2sa1mbpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea3sa1mbpm_out_hourly_tile <- read.csv("ea3sa1mbpm_out_hourly_tile.csv")
ea3sa1mbpm_out_daily_tile  <- read.csv("ea3sa1mbpm_out_daily_tile.csv")
ea3sa1mbpm_out_daily_cohorts  <- read.csv("ea3sa1mbpm_out_daily_cohorts.csv")
ea3sa1mbpm_out_annual_tile  <- read.csv("ea3sa1mbpm_out_annual_tile.csv")
ea3sa1mbpm_out_annual_cohorts  <- read.csv("ea3sa1mbpm_out_annual_cohorts.csv")

# gs-leuning Mortality c) Growth rate
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea1sa1mcgl_out_hourly_tile <- read.csv("ea1sa1mcgl_out_hourly_tile.csv")
ea1sa1mcgl_out_daily_tile  <- read.csv("ea1sa1mcgl_out_daily_tile.csv")
ea1sa1mcgl_out_daily_cohorts  <- read.csv("ea1sa1mcgl_out_daily_cohorts.csv")
ea1sa1mcgl_out_annual_tile  <- read.csv("ea1sa1mcgl_out_annual_tile.csv")
ea1sa1mcgl_out_annual_cohorts  <- read.csv("ea1sa1mcgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea2sa1mcgl_out_hourly_tile <- read.csv("ea2sa1mcgl_out_hourly_tile.csv")
ea2sa1mcgl_out_daily_tile  <- read.csv("ea2sa1mcgl_out_daily_tile.csv")
ea2sa1mcgl_out_daily_cohorts  <- read.csv("ea2sa1mcgl_out_daily_cohorts.csv")
ea2sa1mcgl_out_annual_tile  <- read.csv("ea2sa1mcgl_out_annual_tile.csv")
ea2sa1mcgl_out_annual_cohorts  <- read.csv("ea2sa1mcgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea3sa1mcgl_out_hourly_tile <- read.csv("ea3sa1mcgl_out_hourly_tile.csv")
ea3sa1mcgl_out_daily_tile  <- read.csv("ea3sa1mcgl_out_daily_tile.csv")
ea3sa1mcgl_out_daily_cohorts  <- read.csv("ea3sa1mcgl_out_daily_cohorts.csv")
ea3sa1mcgl_out_annual_tile  <- read.csv("ea3sa1mcgl_out_annual_tile.csv")
ea3sa1mcgl_out_annual_cohorts  <- read.csv("ea3sa1mcgl_out_annual_cohorts.csv")

# p-model Mortality c) Growth rate
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea1sa1mcpm_out_hourly_tile <- read.csv("ea1sa1mcpm_out_hourly_tile.csv")
ea1sa1mcpm_out_daily_tile  <- read.csv("ea1sa1mcpm_out_daily_tile.csv")
ea1sa1mcpm_out_daily_cohorts  <- read.csv("ea1sa1mcpm_out_daily_cohorts.csv")
ea1sa1mcpm_out_annual_tile  <- read.csv("ea1sa1mcpm_out_annual_tile.csv")
ea1sa1mcpm_out_annual_cohorts  <- read.csv("ea1sa1mcpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea2sa1mcpm_out_hourly_tile <- read.csv("ea2sa1mcpm_out_hourly_tile.csv")
ea2sa1mcpm_out_daily_tile  <- read.csv("ea2sa1mcpm_out_daily_tile.csv")
ea2sa1mcpm_out_daily_cohorts  <- read.csv("ea2sa1mcpm_out_daily_cohorts.csv")
ea2sa1mcpm_out_annual_tile  <- read.csv("ea2sa1mcpm_out_annual_tile.csv")
ea2sa1mcpm_out_annual_cohorts  <- read.csv("ea2sa1mcpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea3sa1mcpm_out_hourly_tile <- read.csv("ea3sa1mcpm_out_hourly_tile.csv")
ea3sa1mcpm_out_daily_tile  <- read.csv("ea3sa1mcpm_out_daily_tile.csv")
ea3sa1mcpm_out_daily_cohorts  <- read.csv("ea3sa1mcpm_out_daily_cohorts.csv")
ea3sa1mcpm_out_annual_tile  <- read.csv("ea3sa1mcpm_out_annual_tile.csv")
ea3sa1mcpm_out_annual_cohorts  <- read.csv("ea3sa1mcpm_out_annual_cohorts.csv")

# gs-leuning Mortality d) Self-thinning
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea1sa1mdgl_out_hourly_tile <- read.csv("ea1sa1mdgl_out_hourly_tile.csv")
ea1sa1mdgl_out_daily_tile  <- read.csv("ea1sa1mdgl_out_daily_tile.csv")
ea1sa1mdgl_out_daily_cohorts  <- read.csv("ea1sa1mdgl_out_daily_cohorts.csv")
ea1sa1mdgl_out_annual_tile  <- read.csv("ea1sa1mdgl_out_annual_tile.csv")
ea1sa1mdgl_out_annual_cohorts  <- read.csv("ea1sa1mdgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea2sa1mdgl_out_hourly_tile <- read.csv("ea2sa1mdgl_out_hourly_tile.csv")
ea2sa1mdgl_out_daily_tile  <- read.csv("ea2sa1mdgl_out_daily_tile.csv")
ea2sa1mdgl_out_daily_cohorts  <- read.csv("ea2sa1mdgl_out_daily_cohorts.csv")
ea2sa1mdgl_out_annual_tile  <- read.csv("ea2sa1mdgl_out_annual_tile.csv")
ea2sa1mdgl_out_annual_cohorts  <- read.csv("ea2sa1mdgl_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea3sa1mdgl_out_hourly_tile <- read.csv("ea3sa1mdgl_out_hourly_tile.csv")
ea3sa1mdgl_out_daily_tile  <- read.csv("ea3sa1mdgl_out_daily_tile.csv")
ea3sa1mdgl_out_daily_cohorts  <- read.csv("ea3sa1mdgl_out_daily_cohorts.csv")
ea3sa1mdgl_out_annual_tile  <- read.csv("ea3sa1mdgl_out_annual_tile.csv")
ea3sa1mdgl_out_annual_cohorts  <- read.csv("ea3sa1mdgl_out_annual_cohorts.csv")

# p-model Mortality d) Self-thinning
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea1sa1mdpm_out_hourly_tile <- read.csv("ea1sa1mdpm_out_hourly_tile.csv")
ea1sa1mdpm_out_daily_tile  <- read.csv("ea1sa1mdpm_out_daily_tile.csv")
ea1sa1mdpm_out_daily_cohorts  <- read.csv("ea1sa1mdpm_out_daily_cohorts.csv")
ea1sa1mdpm_out_annual_tile  <- read.csv("ea1sa1mdpm_out_annual_tile.csv")
ea1sa1mdpm_out_annual_cohorts  <- read.csv("ea1sa1mdpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea2sa1mdpm_out_hourly_tile <- read.csv("ea2sa1mdpm_out_hourly_tile.csv")
ea2sa1mdpm_out_daily_tile  <- read.csv("ea2sa1mdpm_out_daily_tile.csv")
ea2sa1mdpm_out_daily_cohorts  <- read.csv("ea2sa1mdpm_out_daily_cohorts.csv")
ea2sa1mdpm_out_annual_tile  <- read.csv("ea2sa1mdpm_out_annual_tile.csv")
ea2sa1mdpm_out_annual_cohorts  <- read.csv("ea2sa1mdpm_out_annual_cohorts.csv")

setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea3sa1mdpm_out_hourly_tile <- read.csv("ea3sa1mdpm_out_hourly_tile.csv")
ea3sa1mdpm_out_daily_tile  <- read.csv("ea3sa1mdpm_out_daily_tile.csv")
ea3sa1mdpm_out_daily_cohorts  <- read.csv("ea3sa1mdpm_out_daily_cohorts.csv")
ea3sa1mdpm_out_annual_tile  <- read.csv("ea3sa1mdpm_out_annual_tile.csv")
ea3sa1mdpm_out_annual_cohorts  <- read.csv("ea3sa1mdpm_out_annual_cohorts.csv")

```

## Exploring relationships and plotting

#### Stand develop: Stand biomass vs. time

From annual_tile_output: PlanC (Biomass)
Level of LUE (mol/s/m2)
```{r}
# Mortality as a function of DBH
ggplot() + 
  geom_line(data=ea1sa1magl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1magl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1magl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of DBH gs-Leuning") + scale_y_continuous(limits = c(0,60))

ggplot() + 
  geom_line(data=ea1sa1mapm_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1mapm_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1mapm_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of DBH p-model") + scale_y_continuous(limits = c(0,60))

# Mortality as a function of C starvation
ggplot() + 
  geom_line(data=ea1sa1mbgl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1mbgl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1mbgl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of C starvation gs-Leuning") 

ggplot() + 
  geom_line(data=ea1sa1mbpm_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1mbpm_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1mbpm_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of C starvation p-model") 

# Mortality as a function of Growth rate
ggplot() + 
  geom_line(data=ea1sa1mcgl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1mcgl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1mcgl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Growth rate gs-Leuning") + scale_y_continuous(limits = c(0,25))

ggplot() + 
  geom_line(data=ea1sa1mcpm_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1mcpm_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1mcpm_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Growth rate p-model") + scale_y_continuous(limits = c(0,25))

# Mortality as a function of Self-thinning
ggplot() + 
  geom_line(data=ea1sa1mdgl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1mdgl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1mdgl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Constant Self-thinning gs-Leuning") 

ggplot() + 
  geom_line(data=ea1sa1mdpm_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1mdpm_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1mdpm_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Constant Self-thinning p-model") 

```

#### GPP vs. time

From annual_tile_output: GPP 
LUE (mol/s/m2)
```{r}
# Mortality as a function of DBH
ggplot() + 
  geom_line(data=ea1sa1magl_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1magl_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1magl_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of DBH gs-Leuning") + scale_y_continuous(limits = c(0,3.5))

ggplot() + 
  geom_line(data=ea1sa1mapm_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1mapm_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1mapm_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of DBH p-model") + scale_y_continuous(limits = c(0,3.5))

# Mortality as a function of C starvation
ggplot() + 
  geom_line(data=ea1sa1mbgl_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1mbgl_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1mbgl_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of C starvation gs-Leuning") 

ggplot() + 
  geom_line(data=ea1sa1mbpm_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1mbpm_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1mbpm_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of C starvation p-model") 

# Mortality as a function of Growth rate
ggplot() + 
  geom_line(data=ea1sa1mcgl_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1mcgl_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1mcgl_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Growth rate gs-Leuning") 

ggplot() + 
  geom_line(data=ea1sa1mcpm_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1mcpm_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1mcpm_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Growth rate p-model") 

# Mortality as a function of Constant Self-thinning
ggplot() + 
  geom_line(data=ea1sa1mdgl_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1mdgl_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1mdgl_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Constant Self-thinning gs-Leuning") 

ggplot() + 
  geom_line(data=ea1sa1mdpm_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1mdpm_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1mdpm_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Constant Self-thinning p-model") 

```

#### Self-thinning relationship

From annual_tile_output: QMD and Density12
LUE (mol/s/m2)
```{r}

# Mortality as a function of DBH

ggplot() + 
  geom_point(data=subset(ea1sa1magl_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=subset(ea2sa1magl_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=subset(ea3sa1magl_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of DBH gs-Leuning") 

ggplot() + 
  geom_point(data=subset(ea1sa1mapm_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=subset(ea2sa1mapm_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=subset(ea3sa1mapm_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of DBH p-model") 

# Mortality as a function of C starvation
ggplot() + 
  geom_point(data=subset(ea1sa1mbgl_out_annual_tile,year>=500), aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=subset(ea2sa1mbgl_out_annual_tile,year>=500), aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=subset(ea3sa1mbgl_out_annual_tile,year>=500), aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of C starvation gs-Leuning") 

ggplot() + 
  geom_point(data=subset(ea1sa1mbpm_out_annual_tile,year>=200), aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=subset(ea2sa1mbpm_out_annual_tile,year>=200), aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=subset(ea3sa1mbpm_out_annual_tile,year>=200), aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of C starvation p-model") 

# Mortality as a function of Growth rate
ggplot() + 
  geom_point(data=subset(ea1sa1mcgl_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=subset(ea2sa1mcgl_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=subset(ea3sa1mcgl_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Growth rate gs-Leuning") 

ggplot() + 
  geom_point(data=subset(ea1sa1mcpm_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=subset(ea2sa1mcpm_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=subset(ea3sa1mcpm_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Growth rate p-model") 

# Mortality as a function of Self-thinning
ggplot() + 
  geom_point(data=subset(ea1sa1mdgl_out_annual_tile,year>=1), aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=subset(ea2sa1mdgl_out_annual_tile,year>=1), aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=subset(ea3sa1mdgl_out_annual_tile,year>=1), aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Constant Self-thinning gs-Leuning") + scale_x_continuous(limits = c(-2,1))

ggplot() + 
  geom_point(data=subset(ea1sa1mdpm_out_annual_tile,year>=21), aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=subset(ea2sa1mdpm_out_annual_tile,year>=20), aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=subset(ea3sa1mdpm_out_annual_tile,year>=20), aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Constant Self-thinning p-model") 

```

## gganimate

```{r}
library(gganimate)

# Mortality as a function of DBH
data1 <- rbind(ea1sa1magl_out_annual_tile, ea2sa1magl_out_annual_tile, ea3sa1magl_out_annual_tile)
data1 <- rbind(ea1sa1mapm_out_annual_tile, ea2sa1mapm_out_annual_tile, ea3sa1mapm_out_annual_tile)

p <- ggplot() + 
  geom_point(data=subset(data1,year>=100), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("Mortality as a function of size") 

# With spinup years
p <- ggplot() + 
  geom_point(data=data1, aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("Mortality as a function of size") + scale_x_continuous(limits = c(-3.5,0))

p + transition_time(Density12) + shadow_mark(alpha = 0.3, size = 0.5)
p + transition_time(QMD) + shadow_mark(alpha = 0.3, size = 0.5) 
p + transition_states(LevelLUE,transition_length = 2,state_length = 2) +
  enter_fly(y_loc = 0)

q <- ggplot() + 
  geom_line(data=subset(data1), aes(x=year, y=plantC, color=as.factor(LevelLUE))) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE",x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("Mortality as a function of size") 

q + transition_reveal(year)

```

Same models for conditions by default
```{r}
# Mortality DBH
eb1sa1ma_out_hourly_tile <- ea1sa1ma_out_hourly_tile
eb1sa1ma_out_daily_tile <- ea1sa1ma_out_daily_tile
eb1sa1ma_out_daily_cohorts <- ea1sa1ma_out_daily_cohorts
eb1sa1ma_out_annual_tile <- ea1sa1ma_out_annual_tile
eb1sa1ma_out_annual_cohorts <- ea1sa1ma_out_annual_cohorts

ea1sb1ma_out_hourly_tile <- ea1sa1ma_out_hourly_tile
ea1sb1ma_out_daily_tile <- ea1sa1ma_out_daily_tile
ea1sb1ma_out_daily_cohorts <- ea1sa1ma_out_daily_cohorts
ea1sb1ma_out_annual_tile <- ea1sa1ma_out_annual_tile
ea1sb1ma_out_annual_cohorts <- ea1sa1ma_out_annual_cohorts

# Mortality Ratio NSC and Leaf Mass
eb1sa1mb_out_hourly_tile <- ea1sa1mb_out_hourly_tile
eb1sa1mb_out_daily_tile <- ea1sa1mb_out_daily_tile
eb1sa1mb_out_daily_cohorts <- ea1sa1mb_out_daily_cohorts
eb1sa1mb_out_annual_tile <- ea1sa1mb_out_annual_tile
eb1sa1mb_out_annual_cohorts <- ea1sa1mb_out_annual_cohorts

ea1sb1mb_out_hourly_tile <- ea1sa1mb_out_hourly_tile
ea1sb1mb_out_daily_tile <- ea1sa1mb_out_daily_tile
ea1sb1mb_out_daily_cohorts <- ea1sa1mb_out_daily_cohorts
ea1sb1mb_out_annual_tile <- ea1sa1mb_out_annual_tile
ea1sb1mb_out_annual_cohorts <- ea1sa1mb_out_annual_cohorts

# Mortality Growthrate
eb1sa1mc_out_hourly_tile <- ea1sa1mc_out_hourly_tile
eb1sa1mc_out_daily_tile <- ea1sa1mc_out_daily_tile
eb1sa1mc_out_daily_cohorts <- ea1sa1mc_out_daily_cohorts
eb1sa1mc_out_annual_tile <- ea1sa1mc_out_annual_tile
eb1sa1mc_out_annual_cohorts <- ea1sa1mc_out_annual_cohorts

ea1sb1mc_out_hourly_tile <- ea1sa1mc_out_hourly_tile
ea1sb1mc_out_daily_tile <- ea1sa1mc_out_daily_tile
ea1sb1mc_out_daily_cohorts <- ea1sa1mc_out_daily_cohorts
ea1sb1mc_out_annual_tile <- ea1sa1mc_out_annual_tile
ea1sb1mc_out_annual_cohorts <- ea1sa1mc_out_annual_cohorts

# Mortality Constant Self-thinning
eb1sa1md_out_hourly_tile <- ea1sa1md_out_hourly_tile
eb1sa1md_out_daily_tile <- ea1sa1md_out_daily_tile
eb1sa1md_out_daily_cohorts <- ea1sa1md_out_daily_cohorts
eb1sa1md_out_annual_tile <- ea1sa1md_out_annual_tile
eb1sa1md_out_annual_cohorts <- ea1sa1md_out_annual_cohorts

ea1sb1md_out_hourly_tile <- ea1sa1md_out_hourly_tile
ea1sb1md_out_daily_tile <- ea1sa1md_out_daily_tile
ea1sb1md_out_daily_cohorts <- ea1sa1md_out_daily_cohorts
ea1sb1md_out_annual_tile <- ea1sa1md_out_annual_tile
ea1sb1md_out_annual_cohorts <- ea1sa1md_out_annual_cohorts

```

### Aggregating cohorts across years and cohorts
```{r}
ea1sa1magl_out_annual_tile <- ea1sa1magl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea1sa1magl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea1sa1magl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1magl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea2sa1magl_out_annual_tile <- ea2sa1magl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea2sa1magl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(ea2sa1magl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1magl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea3sa1magl_out_annual_tile <- ea3sa1magl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea3sa1magl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(ea3sa1magl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1magl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea1sa1mapm_out_annual_tile <- ea1sa1mapm_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea1sa1mapm_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea1sa1mapm_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1mapm_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea2sa1mapm_out_annual_tile <- ea2sa1mapm_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea2sa1mapm_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(ea2sa1mapm_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1mapm_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea3sa1mapm_out_annual_tile <- ea3sa1mapm_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea3sa1mapm_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(ea3sa1mapm_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1mapm_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

eb1sa1ma_out_annual_tile <- eb1sa1ma_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(eb1sa1ma_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
eb2sa1ma_out_annual_tile <- eb2sa1ma_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(eb2sa1ma_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
eb3sa1ma_out_annual_tile <- eb3sa1ma_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(eb3sa1ma_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sa2ma_out_annual_tile <- ea1sa2ma_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea1sa2ma_out_annual_tile)[1]))  %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sa3ma_out_annual_tile <- ea1sa3ma_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea1sa3ma_out_annual_tile)[1]))  %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sb1ma_out_annual_tile <- ea1sb1ma_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea1sb1ma_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sb2ma_out_annual_tile <- ea1sb2ma_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea1sb2ma_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sb3ma_out_annual_tile <- ea1sb3ma_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea1sb3ma_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea1sa1mb_out_annual_tile <- ea1sa1mb_out_annual_tile %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sa1mb_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea1sa1mb_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1mb_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea2sa1mb_out_annual_tile <- ea2sa1mb_out_annual_tile %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea2sa1mb_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(ea2sa1mb_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1mb_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea3sa1mb_out_annual_tile <- ea3sa1mb_out_annual_tile %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea3sa1mb_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(ea3sa1mb_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1mb_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
eb1sa1mb_out_annual_tile <- eb1sa1mb_out_annual_tile %>% mutate(Mortality = rep("NSC/Leaf mass", dim(eb1sa1mb_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
eb2sa1mb_out_annual_tile <- eb2sa1mb_out_annual_tile %>% mutate(Mortality = rep("NSC/Leaf mass", dim(eb2sa1mb_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
eb3sa1mb_out_annual_tile <- eb3sa1mb_out_annual_tile %>% mutate(Mortality = rep("NSC/Leaf mass", dim(eb3sa1mb_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sa2mb_out_annual_tile <- ea1sa2mb_out_annual_tile %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sa2mb_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sa3mb_out_annual_tile <- ea1sa3mb_out_annual_tile %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sa3mb_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sb1mb_out_annual_tile <- ea1sb1mb_out_annual_tile %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sb1mb_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sb2mb_out_annual_tile <- ea1sb2mb_out_annual_tile %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sb2mb_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sb3mb_out_annual_tile <- ea1sb3mb_out_annual_tile %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sb3mb_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea1sa1mc_out_annual_tile <- ea1sa1mc_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(ea1sa1mc_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea1sa1mc_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1mc_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea2sa1mc_out_annual_tile <- ea2sa1mc_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(ea2sa1mc_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(ea2sa1mc_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1mc_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea3sa1mc_out_annual_tile <- ea3sa1mc_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(ea3sa1mc_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(ea3sa1mc_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1mc_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea1sa1mcD_out_annual_tile <- ea1sa1mcD_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(ea1sa1mcD_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea1sa1mcD_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1mcD_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea2sa1mcD_out_annual_tile <- ea2sa1mcD_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(ea2sa1mcD_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(ea2sa1mcD_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1mcD_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea3sa1mcD_out_annual_tile <- ea3sa1mcD_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(ea3sa1mcD_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(ea3sa1mcD_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1mcD_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

eb1sa1mc_out_annual_tile <- eb1sa1mc_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(eb1sa1mc_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
eb2sa1mc_out_annual_tile <- eb2sa1mc_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(eb2sa1mc_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
eb3sa1mc_out_annual_tile <- eb3sa1mc_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(eb3sa1mc_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sa2mc_out_annual_tile <- ea1sa2mc_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(ea1sa2mc_out_annual_tile)[1]))  %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sa3mc_out_annual_tile <- ea1sa3mc_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(ea1sa3mc_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sb1mc_out_annual_tile <- ea1sb1mc_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(ea1sb1mc_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sb2mc_out_annual_tile <- ea1sb2mc_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(ea1sb2mc_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sb3mc_out_annual_tile <- ea1sb3mc_out_annual_tile %>% mutate(Mortality = rep("Growth rate", dim(ea1sb3mc_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea1sa1md_out_annual_tile <- ea1sa1md_out_annual_tile %>% mutate(Mortality = rep("Constant Self-thinning", dim(ea1sa1md_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea1sa1md_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1md_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea2sa1md_out_annual_tile <- ea2sa1md_out_annual_tile %>% mutate(Mortality = rep("Constant Self-thinning", dim(ea2sa1md_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea3sa1md_out_annual_tile <- ea3sa1md_out_annual_tile %>% mutate(Mortality = rep("Constant Self-thinning", dim(ea3sa1md_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
eb1sa1md_out_annual_tile <- eb1sa1md_out_annual_tile %>% mutate(Mortality = rep("Constant Self-thinning", dim(eb1sa1md_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(1, dim(eb1sa1md_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb1sa1md_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
eb2sa1md_out_annual_tile <- eb2sa1md_out_annual_tile %>% mutate(Mortality = rep("Constant Self-thinning", dim(eb2sa1md_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(2, dim(eb2sa1md_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb2sa1md_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
eb3sa1md_out_annual_tile <- eb3sa1md_out_annual_tile %>% mutate(Mortality = rep("Constant Self-thinning", dim(eb3sa1md_out_annual_tile)[1])) %>% mutate(LevelPAR = rep(3, dim(eb3sa1md_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb3sa1md_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sa2md_out_annual_tile <- ea1sa2md_out_annual_tile %>% mutate(Mortality = rep("Constant Self-thinning", dim(ea1sa2md_out_annual_tile)[1]))  %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
ea1sa3md_out_annual_tile <- ea1sa3md_out_annual_tile %>% mutate(Mortality = rep("Constant Self-thinning", dim(ea1sa3md_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelWD = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
# ea1sb1md_out_annual_tile <- ea1sb1md_out_annual_tile %>% mutate(Mortality = rep("Constant Self-thinning", dim(ea1sb1md_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
# ea1sb2md_out_annual_tile <- ea1sb2md_out_annual_tile %>% mutate(Mortality = rep("Constant Self-thinning", dim(ea1sb2md_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(2, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
# ea1sb3md_out_annual_tile <- ea1sb3md_out_annual_tile %>% mutate(Mortality = rep("Constant Self-thinning", dim(ea1sb3md_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(LevelRS = rep(3, dim(ea2sa1ma_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

# Mortality DBH
ea1sa1ma_out_annual_cohorts <- ea1sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1ma_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("DBH", dim(ea1sa1ma_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea2sa1ma_out_annual_cohorts <- ea2sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(2, dim(ea2sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("DBH", dim(ea2sa1ma_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea3sa1ma_out_annual_cohorts <- ea3sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(3, dim(ea3sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1ma_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("DBH", dim(ea3sa1ma_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb1sa1ma_out_annual_cohorts <- eb1sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(1, dim(eb1sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb1sa1ma_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("DBH", dim(eb1sa1ma_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb2sa1ma_out_annual_cohorts <- eb2sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(2, dim(eb2sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb2sa1ma_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("DBH", dim(eb2sa1ma_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb3sa1ma_out_annual_cohorts <- eb3sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(3, dim(eb3sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb3sa1ma_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("DBH", dim(eb3sa1ma_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sa2ma_out_annual_cohorts <- ea1sa2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa2ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(2, dim(ea1sa2ma_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("DBH", dim(ea1sa2ma_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sa3ma_out_annual_cohorts <- ea1sa3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa3ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(3, dim(ea1sa3ma_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("DBH", dim(ea1sa3ma_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sb1ma_out_annual_cohorts <- ea1sb1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb1ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(1, dim(ea1sb1ma_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("DBH", dim(ea1sb1ma_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sb2ma_out_annual_cohorts <- ea1sb2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb2ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(2, dim(ea1sb2ma_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("DBH", dim(ea1sb2ma_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sb3ma_out_annual_cohorts <- ea1sb3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb3ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(3, dim(ea1sb3ma_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("DBH", dim(ea1sb3ma_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))

# Mortality NSC/Leaf mass
ea1sa1mb_out_annual_cohorts <- ea1sa1mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa1mb_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1mb_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sa1mb_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea2sa1mb_out_annual_cohorts <- ea2sa1mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(2, dim(ea2sa1mb_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1mb_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea2sa1mb_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea3sa1mb_out_annual_cohorts <- ea3sa1mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(3, dim(ea3sa1mb_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1mb_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea3sa1mb_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb1sa1mb_out_annual_cohorts <- eb1sa1mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(1, dim(eb1sa1mb_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb1sa1mb_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("NSC/Leaf mass", dim(eb1sa1mb_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb2sa1mb_out_annual_cohorts <- eb2sa1mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(2, dim(eb2sa1mb_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb2sa1mb_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("NSC/Leaf mass", dim(eb2sa1mb_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb3sa1mb_out_annual_cohorts <- eb3sa1mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(3, dim(eb3sa1mb_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb3sa1mb_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("NSC/Leaf mass", dim(eb3sa1mb_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sa2mb_out_annual_cohorts <- ea1sa2mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa2mb_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(2, dim(ea1sa2mb_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sa2mb_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sa3mb_out_annual_cohorts <- ea1sa3mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa3mb_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(3, dim(ea1sa3mb_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sa3mb_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sb1mb_out_annual_cohorts <- ea1sb1mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb1mb_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(1, dim(ea1sb1mb_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sb1mb_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sb2mb_out_annual_cohorts <- ea1sb2mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb2mb_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(2, dim(ea1sb2mb_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sb2mb_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sb3mb_out_annual_cohorts <- ea1sb3mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb3mb_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(3, dim(ea1sb3mb_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("NSC/Leaf mass", dim(ea1sb3mb_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))

# Mortality Growth rate
ea1sa1mc_out_annual_cohorts <- ea1sa1mc_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa1mc_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1mc_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(ea1sa1mc_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea2sa1mc_out_annual_cohorts <- ea2sa1mc_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(2, dim(ea2sa1mc_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1mc_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(ea2sa1mc_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea3sa1mc_out_annual_cohorts <- ea3sa1mc_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(3, dim(ea3sa1mc_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1mc_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(ea3sa1mc_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb1sa1mc_out_annual_cohorts <- eb1sa1mc_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(1, dim(eb1sa1mc_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb1sa1mc_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(eb1sa1mc_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb2sa1mc_out_annual_cohorts <- eb2sa1mc_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(2, dim(eb2sa1mc_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb2sa1mc_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(eb2sa1mc_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb3sa1mc_out_annual_cohorts <- eb3sa1mc_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(3, dim(eb3sa1mc_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb3sa1mc_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(eb3sa1mc_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sa2mc_out_annual_cohorts <- ea1sa2mc_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa2mc_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(2, dim(ea1sa2mc_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(ea1sa2mc_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sa3mc_out_annual_cohorts <- ea1sa3mc_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa3mc_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(3, dim(ea1sa3mc_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(ea1sa3mc_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sb1mc_out_annual_cohorts <- ea1sb1mc_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb1mc_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(1, dim(ea1sb1mc_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(ea1sb1mc_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sb2mc_out_annual_cohorts <- ea1sb2mc_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb2mc_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(2, dim(ea1sb2mc_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(ea1sb2mc_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
ea1sb3mc_out_annual_cohorts <- ea1sb3mc_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb3mc_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(3, dim(ea1sb3mc_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(ea1sb3mc_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))

# Mortality Self-thinning
ea1sa1md_out_annual_cohorts <- ea1sa1md_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa1md_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1md_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(ea1sa1md_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb1sa1md_out_annual_cohorts <- eb1sa1md_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(eb1sa1md_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb1sa1md_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(eb1sa1md_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb2sa1md_out_annual_cohorts <- eb2sa1md_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(eb2sa1md_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb2sa1md_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(eb2sa1md_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))
eb3sa1md_out_annual_cohorts <- eb3sa1md_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = c(0,0.12,0.2,0.4,0.6,0.8,1,1.2,1.4,1.6,1.8,2,5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = c(seq(0,150,10),500),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh^2/4)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = c(seq(0,10,2),30),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(eb3sa1md_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb3sa1md_out_annual_cohorts)[1])) %>% mutate(Mortality = rep("Growth rate", dim(eb3sa1md_out_annual_cohorts)[1])) %>% mutate(dbhclass = recode(dbhclass, "(2,5]" = ">2")) %>% mutate(ageclass = recode(ageclass, "(150,500]" = ">150")) %>% mutate(highBAclass = recode(highBAclass, "(10,30]" = ">10"))

# Mortality DBH
ea1sa1ma_out_annual_cohortsDBHClass <- ea1sa1ma_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa1ma_out_annual_cohortsDBHClass <- ea2sa1ma_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa1ma_out_annual_cohortsDBHClass <- ea3sa1ma_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sa1ma_out_annual_cohortsDBHClass <- eb1sa1ma_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa1ma_out_annual_cohortsDBHClass <- eb2sa1ma_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa1ma_out_annual_cohortsDBHClass <- eb3sa1ma_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

# Mortality NSC/Leaf mass
ea1sa1mb_out_annual_cohortsDBHClass <- ea1sa1mb_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa1mb_out_annual_cohortsDBHClass <- ea2sa1mb_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa1mb_out_annual_cohortsDBHClass <- ea3sa1mb_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sa1mb_out_annual_cohortsDBHClass <- eb1sa1mb_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa1mb_out_annual_cohortsDBHClass <- eb2sa1mb_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa1mb_out_annual_cohortsDBHClass <- eb3sa1mb_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

# Mortality Growth rate
ea1sa1mc_out_annual_cohortsDBHClass <- ea1sa1mc_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa1mc_out_annual_cohortsDBHClass <- ea2sa1mc_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa1mc_out_annual_cohortsDBHClass <- ea3sa1mc_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sa1mc_out_annual_cohortsDBHClass <- eb1sa1mc_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa1mc_out_annual_cohortsDBHClass <- eb2sa1mc_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa1mc_out_annual_cohortsDBHClass <- eb3sa1mc_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

# Mortality Self-thinning
ea1sa1md_out_annual_cohortsDBHClass <- ea1sa1md_out_annual_cohorts %>% group_by(dbhclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

# Mortality DBH
dataBinLUE_cohortsDBHClassJoin_2_1_ma <- ea1sa1ma_out_annual_cohortsDBHClass %>% inner_join(ea2sa1ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsDBHClassJoin_3_1_ma <- ea1sa1ma_out_annual_cohortsDBHClass %>% inner_join(ea3sa1ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsDBHClassJoin_2_1_ma <- eb1sa1ma_out_annual_cohortsDBHClass %>% inner_join(eb2sa1ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsDBHClassJoin_3_1_ma <- eb1sa1ma_out_annual_cohortsDBHClass %>% inner_join(eb3sa1ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

# Mortality NSC/Leaf mass
dataBinLUE_cohortsDBHClassJoin_2_1_mb <- ea1sa1mb_out_annual_cohortsDBHClass %>% inner_join(ea2sa1mb_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsDBHClassJoin_3_1_mb <- ea1sa1mb_out_annual_cohortsDBHClass %>% inner_join(ea3sa1mb_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsDBHClassJoin_2_1_mb <- eb1sa1mb_out_annual_cohortsDBHClass %>% inner_join(eb2sa1mb_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsDBHClassJoin_3_1_mb <- eb1sa1mb_out_annual_cohortsDBHClass %>% inner_join(eb3sa1mb_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

# Mortality Growth rate
dataBinLUE_cohortsDBHClassJoin_2_1_mc <- ea1sa1mc_out_annual_cohortsDBHClass %>% inner_join(ea2sa1mc_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsDBHClassJoin_3_1_mc <- ea1sa1mc_out_annual_cohortsDBHClass %>% inner_join(ea3sa1mc_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsDBHClassJoin_2_1_mc <- eb1sa1mc_out_annual_cohortsDBHClass %>% inner_join(eb2sa1mc_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsDBHClassJoin_3_1_mc <- eb1sa1mc_out_annual_cohortsDBHClass %>% inner_join(eb3sa1mc_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

# Mortality DBH
ea1sa1ma_out_annual_cohortsHighBAClass <- ea1sa1ma_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa1ma_out_annual_cohortsHighBAClass <- ea2sa1ma_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa1ma_out_annual_cohortsHighBAClass <- ea3sa1ma_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sa1ma_out_annual_cohortsHighBAClass <- eb1sa1ma_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa1ma_out_annual_cohortsHighBAClass <- eb2sa1ma_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa1ma_out_annual_cohortsHighBAClass <- eb3sa1ma_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

# Mortality NSC/Leaf mass
ea1sa1mb_out_annual_cohortsHighBAClass <- ea1sa1mb_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa1mb_out_annual_cohortsHighBAClass <- ea2sa1mb_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa1mb_out_annual_cohortsHighBAClass <- ea3sa1mb_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sa1mb_out_annual_cohortsHighBAClass <- eb1sa1mb_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa1mb_out_annual_cohortsHighBAClass <- eb2sa1mb_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa1mb_out_annual_cohortsHighBAClass <- eb3sa1mb_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

# Mortality Growth rate
ea1sa1mc_out_annual_cohortsHighBAClass <- ea1sa1mc_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa1mc_out_annual_cohortsHighBAClass <- ea2sa1mc_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa1mc_out_annual_cohortsHighBAClass <- ea3sa1mc_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sa1mc_out_annual_cohortsHighBAClass <- eb1sa1mc_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa1mc_out_annual_cohortsHighBAClass <- eb2sa1mc_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa1mc_out_annual_cohortsHighBAClass <- eb3sa1mc_out_annual_cohorts %>% group_by(highBAclass,year,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

# Mortality DBH
dataBinLUE_cohortsHighBAClassJoin_2_1_ma <- ea1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(ea2sa1ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsHighBAClassJoin_3_1_ma <- ea1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(ea3sa1ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsHighBAClassJoin_2_1_ma <- eb1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(eb2sa1ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsHighBAClassJoin_3_1_ma <- eb1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(eb3sa1ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

# Mortality NSC/Leaf mass
dataBinLUE_cohortsHighBAClassJoin_2_1_mb <- ea1sa1mb_out_annual_cohortsHighBAClass %>% inner_join(ea2sa1mb_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsHighBAClassJoin_3_1_mb <- ea1sa1mb_out_annual_cohortsHighBAClass %>% inner_join(ea3sa1mb_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsHighBAClassJoin_2_1_mb <- eb1sa1mb_out_annual_cohortsHighBAClass %>% inner_join(eb2sa1mb_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsHighBAClassJoin_3_1_mb <- eb1sa1mb_out_annual_cohortsHighBAClass %>% inner_join(eb3sa1mb_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

# Mortality Growth rate
dataBinLUE_cohortsHighBAClassJoin_2_1_mc <- ea1sa1mc_out_annual_cohortsHighBAClass %>% inner_join(ea2sa1mc_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsHighBAClassJoin_3_1_mc <- ea1sa1mc_out_annual_cohortsHighBAClass %>% inner_join(ea3sa1mc_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsHighBAClassJoin_2_1_mc <- eb1sa1mc_out_annual_cohortsHighBAClass %>% inner_join(eb2sa1mc_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsHighBAClassJoin_3_1_mc <- eb1sa1mc_out_annual_cohortsHighBAClass %>% inner_join(eb3sa1mc_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

## For plots only with one point for DBH or HighBA class: aggregating across years:

# dbhclass
# Mortality DBH
ea1sa1ma_out_annual_cohortsDBHClass <- ea1sa1ma_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea2sa1ma_out_annual_cohortsDBHClass <- ea2sa1ma_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea3sa1ma_out_annual_cohortsDBHClass <- ea3sa1ma_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinLUE_cohortsDBHClassJoin_2_1_ma <- ea1sa1ma_out_annual_cohortsDBHClass %>% inner_join(ea2sa1ma_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsDBHClassJoin_3_1_ma <- ea1sa1ma_out_annual_cohortsDBHClass %>% inner_join(ea3sa1ma_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

eb1sa1ma_out_annual_cohortsDBHClass <- eb1sa1ma_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb2sa1ma_out_annual_cohortsDBHClass <- eb2sa1ma_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb3sa1ma_out_annual_cohortsDBHClass <- eb3sa1ma_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinPAR_cohortsDBHClassJoin_2_1_ma <- eb1sa1ma_out_annual_cohortsDBHClass %>% inner_join(eb2sa1ma_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsDBHClassJoin_3_1_ma <- eb1sa1ma_out_annual_cohortsDBHClass %>% inner_join(eb3sa1ma_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

# Mortality NSC/Leaf mass
ea1sa1mb_out_annual_cohortsDBHClass <- ea1sa1mb_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea2sa1mb_out_annual_cohortsDBHClass <- ea2sa1mb_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea3sa1mb_out_annual_cohortsDBHClass <- ea3sa1mb_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinLUE_cohortsDBHClassJoin_2_1_mb <- ea1sa1mb_out_annual_cohortsDBHClass %>% inner_join(ea2sa1mb_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsDBHClassJoin_3_1_mb <- ea1sa1mb_out_annual_cohortsDBHClass %>% inner_join(ea3sa1mb_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

eb1sa1mb_out_annual_cohortsDBHClass <- eb1sa1mb_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb2sa1mb_out_annual_cohortsDBHClass <- eb2sa1mb_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb3sa1mb_out_annual_cohortsDBHClass <- eb3sa1mb_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinPAR_cohortsDBHClassJoin_2_1_mb <- eb1sa1mb_out_annual_cohortsDBHClass %>% inner_join(eb2sa1mb_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsDBHClassJoin_3_1_mb <- eb1sa1mb_out_annual_cohortsDBHClass %>% inner_join(eb3sa1mb_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

# Mortality Growth rate
ea1sa1mc_out_annual_cohortsDBHClass <- ea1sa1mc_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea2sa1mc_out_annual_cohortsDBHClass <- ea2sa1mc_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea3sa1mc_out_annual_cohortsDBHClass <- ea3sa1mc_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinLUE_cohortsDBHClassJoin_2_1_mc <- ea1sa1mc_out_annual_cohortsDBHClass %>% inner_join(ea2sa1mc_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsDBHClassJoin_3_1_mc <- ea1sa1mc_out_annual_cohortsDBHClass %>% inner_join(ea3sa1mc_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

eb1sa1mc_out_annual_cohortsDBHClass <- eb1sa1mc_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb2sa1mc_out_annual_cohortsDBHClass <- eb2sa1mc_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb3sa1mc_out_annual_cohortsDBHClass <- eb3sa1mc_out_annual_cohorts %>% group_by(dbhclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinPAR_cohortsDBHClassJoin_2_1_mc <- eb1sa1mc_out_annual_cohortsDBHClass %>% inner_join(eb2sa1mc_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsDBHClassJoin_3_1_mc <- eb1sa1mc_out_annual_cohortsDBHClass %>% inner_join(eb3sa1mc_out_annual_cohortsDBHClass, by = c("dbhclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

# highBAclass
# Mortality DBH
ea1sa1ma_out_annual_cohortsHighBAClass <- ea1sa1ma_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea2sa1ma_out_annual_cohortsHighBAClass <- ea2sa1ma_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea3sa1ma_out_annual_cohortsHighBAClass <- ea3sa1ma_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinLUE_cohortsHighBAClassJoin_2_1_ma <- ea1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(ea2sa1ma_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsHighBAClassJoin_3_1_ma <- ea1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(ea3sa1ma_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

eb1sa1ma_out_annual_cohortsHighBAClass <- eb1sa1ma_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb2sa1ma_out_annual_cohortsHighBAClass <- eb2sa1ma_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb3sa1ma_out_annual_cohortsHighBAClass <- eb3sa1ma_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinPAR_cohortsHighBAClassJoin_2_1_ma <- eb1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(eb2sa1ma_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsHighBAClassJoin_3_1_ma <- eb1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(eb3sa1ma_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

# Mortality NSC/Leaf mass
ea1sa1mb_out_annual_cohortsHighBAClass <- ea1sa1mb_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea2sa1mb_out_annual_cohortsHighBAClass <- ea2sa1mb_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea3sa1mb_out_annual_cohortsHighBAClass <- ea3sa1mb_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinLUE_cohortsHighBAClassJoin_2_1_mb <- ea1sa1mb_out_annual_cohortsHighBAClass %>% inner_join(ea2sa1mb_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsHighBAClassJoin_3_1_mb <- ea1sa1mb_out_annual_cohortsHighBAClass %>% inner_join(ea3sa1mb_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

eb1sa1mb_out_annual_cohortsHighBAClass <- eb1sa1mb_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb2sa1mb_out_annual_cohortsHighBAClass <- eb2sa1mb_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb3sa1mb_out_annual_cohortsHighBAClass <- eb3sa1mb_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinPAR_cohortsHighBAClassJoin_2_1_mb <- eb1sa1mb_out_annual_cohortsHighBAClass %>% inner_join(eb2sa1mb_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsHighBAClassJoin_3_1_mb <- eb1sa1mb_out_annual_cohortsHighBAClass %>% inner_join(eb3sa1mb_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

# Mortality Growth rate
ea1sa1mc_out_annual_cohortsHighBAClass <- ea1sa1mc_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea2sa1mc_out_annual_cohortsHighBAClass <- ea2sa1mc_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
ea3sa1mc_out_annual_cohortsHighBAClass <- ea3sa1mc_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinLUE_cohortsHighBAClassJoin_2_1_mc <- ea1sa1mc_out_annual_cohortsHighBAClass %>% inner_join(ea2sa1mc_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinLUE_cohortsHighBAClassJoin_3_1_mc <- ea1sa1mc_out_annual_cohortsHighBAClass %>% inner_join(ea3sa1mc_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

eb1sa1mc_out_annual_cohortsHighBAClass <- eb1sa1mc_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb2sa1mc_out_annual_cohortsHighBAClass <- eb2sa1mc_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
eb3sa1mc_out_annual_cohortsHighBAClass <- eb3sa1mc_out_annual_cohorts %>% group_by(highBAclass,Mortality) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
dataBinPAR_cohortsHighBAClassJoin_2_1_mc <- eb1sa1mc_out_annual_cohortsHighBAClass %>% inner_join(eb2sa1mc_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)
dataBinPAR_cohortsHighBAClassJoin_3_1_mc <- eb1sa1mc_out_annual_cohortsHighBAClass %>% inner_join(eb3sa1mc_out_annual_cohortsHighBAClass, by = c("highBAclass","Mortality"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

max(ea1sa1ma_out_annual_cohorts$highBA)
```

##### GPP and Total resp at cohort level vs. size (dbh or height)
```{r}

ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_cohorts, aes(x=dbh, y=GPP_yr, color="GPP")) + 
  geom_line(data=ea1sa1ma_out_annual_cohorts, aes(x=dbh, y=Rauto, color="Rauto")) +
  scale_color_manual("Processes", breaks = c("GPP", "Rauto"), values = c("#F8766D" ,"#619CFF"))+
  labs(x = "DBH", y = "Processes") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

for (i in 1:14) {
  plot <- ea1sa1ma_out_annual_cohorts %>%
    filter(cohort == cohort[i]) %>%
    ggplot() + geom_line(aes(x = dbh, y = GPP_yr, color="GPP")) + geom_line(aes(x = dbh, y = Rauto, color="Rauto")) +
    scale_color_manual("Processes", breaks = c("GPP", "Rauto"), values = c("#F8766D" ,"#619CFF")) + labs(x = "DBH", y = "Processes") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + ggtitle(paste("Cohort", i))
    print(plot)
}

```

## Calibration
### PROFOUND data
```{r}
library(ProfoundData)

dbfile <- downloadDatabase(location = tempdir())
setDB(dbfile)
getDB()

downloadDatabase(location = NULL) # Download the dataset as a zip that needs to be unzip manually

sites <- getData(dataset = "SITES")
data <- getData(dataset ="SOIL", site = "soro", collapse = FALSE)
PR_Stand_data <- getData(dataset ="STAND", site ="solling_spruce", species = "Picea abies")
PR_Tree_data <- getData(dataset ="TREE", site ="solling_spruce", species = "Picea abies")

```

## Exploring relationships and plotting

#### Stand develop: Stand biomass vs. time

From annual_tile_output: PlanC (Biomass)

##### LUE (mol/s/m2)
```{r}

# Biomass changes in LUE with WD level 1
# Mortality DBH
ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1ma_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1ma_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality as a function of size") + scale_y_continuous(limits = c(0,42))

# Biomass changes in LUE with WD level 1
# Mortality Ratio NSC and Leaf Mass
ggplot() + 
  geom_line(data=ea1sa1mb_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1mb_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1mb_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Biomass changes in LUE with WD level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=ea1sa1mc_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1mc_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1mc_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality as a function of growth rate") + scale_y_continuous(limits = c(0,42))

# Biomass changes in LUE with WD level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=ea1sa1mcD_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1mcD_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1mcD_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate (in terms of dDBH)")

# Biomass changes in LUE with WD level 1
# Mortality Constant Self-thinning
ggplot() + 
  geom_line(data=ea1sa1md_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1md_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1md_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Constant Self-thinning")

```

##### LUE all
```{r, fig.width = 10, fig.height = 4}

## All mortality form with facet_wrap
data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea2sa1md_out_annual_tile, ea3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate", "Constant Self-thinning"))

ggplot(data=data1) +
  geom_line(aes(x=year, y=plantC,color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Levels of LUE",x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")


```

##### PAR 
```{r}

# Biomass changes in PAR with WD level 1
# Mortality DBH
ggplot() + 
  geom_line(data=eb1sa1ma_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=eb2sa1ma_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=eb3sa1ma_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of PAR", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Biomass changes in PAR with WD level 1
# Mortality Ratio NSC and Leaf Mass
ggplot() + 
  geom_line(data=eb1sa1mb_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=eb2sa1mb_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=eb3sa1mb_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of PAR", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Biomass changes in PAR with WD level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=eb1sa1mc_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=eb2sa1mc_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=eb3sa1mc_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of PAR", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

# Biomass changes in PAR with WD level 1
# Mortality Constant Self-thinning
ggplot() + 
  geom_line(data=eb1sa1md_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=eb2sa1md_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=eb3sa1md_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of PAR", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

```

##### WD 
```{r}

# Biomass changes in WD with LUE level 1
# Mortality DBH
ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2ma_out_annual_tile, aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=ea1sa3ma_out_annual_tile, aes(x=year, y=plantC, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Biomass changes in WD with LUE level 1
# Mortality Ratio NSC and Leaf Mass
ggplot() + 
  geom_line(data=ea1sa1mb_out_annual_tile, aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2mb_out_annual_tile, aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=ea1sa3mb_out_annual_tile, aes(x=year, y=plantC, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Biomass changes in WD with LUE level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=ea1sa1mc_out_annual_tile, aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2mc_out_annual_tile, aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=ea1sa3mc_out_annual_tile, aes(x=year, y=plantC, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

# Biomass changes in WD with LUE level 1
# Mortality Self-thinning
ggplot() + 
  geom_line(data=ea1sa1md_out_annual_tile, aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2md_out_annual_tile, aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=ea1sa3md_out_annual_tile, aes(x=year, y=plantC, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Constant Self-thinning")


```

##### WD all
```{r, fig.width = 10, fig.height = 4}

## All mortality form with facet_wrap
data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea1sa2md_out_annual_tile, ea1sa3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate", "Constant Self-thinning"))

ggplot(data=data1) +
  geom_line(aes(x=year, y=plantC,color=as.factor(LevelWD))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Levels of WD",x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

##### R:S 
```{r}

# Biomass changes in RS with LUE level 1
# Mortality DBH
ggplot() + 
  geom_line(data=ea1sb1ma_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=ea1sb2ma_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 5')) +
  geom_line(data=ea1sb3ma_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 6')) +
  scale_color_manual("Levels of R:S", breaks = c("phiRL = 4", "phiRL = 5", "phiRL = 6"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Biomass changes in RS with LUE level 1
# Mortality Ratio NSC and Leaf Mass
ggplot() + 
  geom_line(data=ea1sb1mb_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=ea1sb2mb_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 5')) +
  geom_line(data=ea1sb3mb_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 6')) +
  scale_color_manual("Levels of R:S", breaks = c("phiRL = 4", "phiRL = 5", "phiRL = 6"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Biomass changes in RS with LUE level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=ea1sb1mc_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 4')) +  
  geom_line(data=ea1sb2mc_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 5')) +
  geom_line(data=ea1sb3mc_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 6')) +
  scale_color_manual("Levels of R:S", breaks = c("phiRL = 4", "phiRL = 5", "phiRL = 6"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

```

#### Additional plot:  B* vs. initial slope of (B vs. t) 

From annual_tile_output: PlanC (Biomass)

##### LUE (mol/s/m2)
```{r, fig.width = 10, fig.height = 4}

# Mortality DBH
ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile[1:150,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1ma_out_annual_tile[1:150,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1ma_out_annual_tile[1:150,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile[1300:1804,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1ma_out_annual_tile[1300:1804,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1ma_out_annual_tile[1300:1804,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

slope1 <- summary(lm(plantC ~ year, ea1sa1ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1ma_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea2sa1ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea2sa1ma_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea3sa1ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea3sa1ma_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1ma_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea2sa1ma_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea3sa1ma_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
mortality <- as.factor(c("DBH","DBH","DBH"))
dataSlopeA <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlopeA) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation DBH")

# Mortality Ratio NSC and Leaf Mass
slope1 <- summary(lm(plantC ~ year, ea1sa1mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1mb_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea2sa1mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea2sa1mb_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea3sa1mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea3sa1mb_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1mb_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea2sa1mb_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea3sa1mb_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
mortality <- as.factor(c("NSC/Leaf mass","NSC/Leaf mass","NSC/Leaf mass"))
dataSlopeB <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlopeB) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Mortality Growth rate
slope1 <- summary(lm(plantC ~ year, ea1sa1mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1mc_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea2sa1mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea2sa1mc_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea3sa1mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea3sa1mc_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1mc_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea2sa1mc_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea3sa1mc_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
mortality <- as.factor(c("Growth ratio","Growth ratio","Growth ratio"))
dataSlopeC <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlopeC) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation Growth rate")

# Mortality Constrant self-thinning
slope1 <- summary(lm(plantC ~ year, ea1sa1md_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1md_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea2sa1md_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea2sa1md_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea3sa1md_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea3sa1md_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1md_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea2sa1md_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea3sa1md_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
mortality <- as.factor(c("Constant self-thinning","Constant self-thinning","Constant self-thinning"))
dataSlopeD <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlopeD) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation Growth rate")

## facet_wrap
dataSlope <- rbind(dataSlopeA, dataSlopeB, dataSlopeC,dataSlopeD)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) + facet_wrap(~ mortality, ncol=4)+
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual(labels = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Levels of LUE",x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

##### LUE all 
```{r, fig.width = 10, fig.height = 4}

## facet_wrap
dataSlope <- rbind(dataSlopeA, dataSlopeB, dataSlopeC,dataSlopeD)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) + facet_wrap(~ mortality, ncol=4)+
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual(labels = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Levels of LUE",x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

##### PAR (mol/s/m2)
```{r}

# Mortality DBH
slope1 <- summary(lm(plantC ~ year, eb1sa1ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, eb1sa1ma_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, eb2sa1ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, eb2sa1ma_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, eb3sa1ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, eb3sa1ma_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- eb1sa1ma_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- eb2sa1ma_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- eb3sa1ma_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
mortality <- as.factor(c("DBH","DBH","DBH"))
dataSlopeA <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of PAR", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation DBH")

# Mortality Ratio NSC and Leaf Mass
slope1 <- summary(lm(plantC ~ year, eb1sa1mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, eb1sa1mb_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, eb2sa1mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, eb2sa1mb_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, eb3sa1mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, eb3sa1mb_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- eb1sa1mb_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- eb2sa1mb_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- eb3sa1mb_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
mortality <- as.factor(c("NSC/Leaf mass","NSC/Leaf mass","NSC/Leaf mass"))
dataSlopeB <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of PAR", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation Ratio NSC and Leaf Mass")

# Mortality Growth rate
slope1 <- summary(lm(plantC ~ year, eb1sa1mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, eb1sa1mc_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, eb2sa1mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, eb2sa1mc_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, eb3sa1mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, eb3sa1mc_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- eb1sa1mc_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- eb2sa1mc_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- eb3sa1mc_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
mortality <- as.factor(c("Growth ratio","Growth ratio","Growth ratio"))
dataSlopeC <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of PAR", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation Growth rate")

dataSlope <- rbind(dataSlopeA, dataSlopeB, dataSlopeC)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) + facet_wrap(~ mortality, ncol=3)+
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual(labels = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Levels of PAR",x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

##### Wood density
```{r}
# Mortality DBH
slope1 <- summary(lm(plantC ~ year, ea1sa1ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1ma_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea1sa2ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea1sa2ma_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea1sa3ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea1sa3ma_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1ma_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea1sa2ma_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea1sa2ma_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("300 kgC m-3","600 kgC m-3","800 kgC m-3"))
mortality <- as.factor(c("DBH","DBH","DBH"))
dataSlopeA <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation DBH")

# Mortality Ratio NSC and Leaf Mass
slope1 <- summary(lm(plantC ~ year, ea1sa1mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1mb_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea1sa2mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea1sa2mb_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea1sa3mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea1sa3mb_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1mb_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea1sa2mb_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea1sa2mb_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("300 kgC m-3","600 kgC m-3","800 kgC m-3"))
mortality <- as.factor(c("NSC/Leaf mass","NSC/Leaf mass","NSC/Leaf mass"))
dataSlopeB <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation Ratio NSC and Leaf Mass")

# Mortality Growth rate
slope1 <- summary(lm(plantC ~ year, ea1sa1mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1mc_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea1sa2mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea1sa2mc_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea1sa3mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea1sa3mc_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1mc_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea1sa2mc_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea1sa2mc_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("300 kgC m-3","600 kgC m-3","800 kgC m-3"))
mortality <- as.factor(c("Growth rate","Growth rate","Growth rate"))
dataSlopeC <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation Growth rate")


# Mortality Constant Sefl thinning
slope1 <- summary(lm(plantC ~ year, ea1sa1md_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1md_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea1sa2md_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea1sa2md_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea1sa3md_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea1sa3md_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1md_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea1sa2md_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea1sa2md_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("300 kgC m-3","600 kgC m-3","800 kgC m-3"))
mortality <- as.factor(c("Constant self-thinning","Constant self-thinning","Constant self-thinning"))
dataSlopeD <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation Constant self-thinning")

```

##### WD all 
```{r, fig.width = 10, fig.height = 4}

## facet_wrap
dataSlope <- rbind(dataSlopeA, dataSlopeB, dataSlopeC,dataSlopeD)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) + facet_wrap(~ mortality, ncol=4)+
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual(labels = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Levels of WD",x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```
##### Root:Shoot ratio
```{r}

# Mortality DBH
slope1 <- summary(lm(plantC ~ year, ea1sb1ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sb1ma_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea1sb2ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea1sb2ma_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea1sb3ma_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea1sb3ma_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sb1ma_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea1sb2ma_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea1sb3ma_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("phiRL = 4","phiRL = 6","phiRL = 8"))
mortality <- as.factor(c("DBH","DBH","DBH"))
dataSlopeA <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of R:S", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    ggtitle("Mortality formulation DBH")

# Mortality Ratio NSC and Leaf Mass
slope1 <- summary(lm(plantC ~ year, ea1sb1mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sb1mb_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea1sb2mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea1sb2mb_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea1sb3mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea1sb3mb_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sb1mb_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea1sb2mb_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea1sb3mb_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("phiRL = 4","phiRL = 6","phiRL = 8"))
mortality <- as.factor(c("NSC/Leaf mass","NSC/Leaf mass","NSC/Leaf mass"))
dataSlopeB <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of R:S", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    ggtitle("Mortality formulation Ratio NSC and Leaf Mass")

# Mortality Ratio NSC and Leaf Mass
slope1 <- summary(lm(plantC ~ year, ea1sb1mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sb1mc_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea1sb2mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea1sb2mc_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea1sb3mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea1sb3mc_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sb1mc_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea1sb2mc_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea1sb3mc_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("phiRL = 4","phiRL = 6","phiRL = 8"))
mortality <- as.factor(c("Growth rate","Growth rate","Growth rate"))
dataSlopeC <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of R:S", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    ggtitle("Mortality formulation Growth rate")

dataSlope <- rbind(dataSlopeA, dataSlopeB, dataSlopeC)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) + facet_wrap(~ mortality, ncol=3)+
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual(labels = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Levels of RS",x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

#### Aboveground NPP vs. (A)NPP

From annual_tile_output: PlanC (Biomass)

##### LUE (mol/s/m2)
```{r}

# Biomass changes in LUE with WD level 1
# Mortality DBH

ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=plantC, y=NPP, color='Control')) + 
  geom_line(data=ea2sa1ma_out_annual_tile, aes(x=plantC, y=NPP, color='+15%')) +
  geom_line(data=ea3sa1ma_out_annual_tile, aes(x=plantC, y=NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Biomass", y="NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

ggplot() + 
  geom_line(data=subset(ea1sa1ma_out_annual_tile,year>=50), aes(x=plantC, y=NPP, color='Control')) + 
  geom_line(data=subset(ea2sa1ma_out_annual_tile,year>=50), aes(x=plantC, y=NPP, color='+15%')) +
  geom_line(data=subset(ea3sa1ma_out_annual_tile,year>=50), aes(x=plantC, y=NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Biomass", y="NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1ma_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1ma_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Biomass changes in LUE with WD level 1
# Mortality Ratio NSC and Leaf Mass
ggplot() + 
  geom_line(data=ea1sa1mb_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1mb_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1mb_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Biomass changes in LUE with WD level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=ea1sa1mc_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1mc_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1mc_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

# Biomass changes in LUE with WD level 1
# Mortality Constant Self-thinning
ggplot() + 
  geom_line(data=ea1sa1md_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1md_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1md_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Constant Self-thinning")

```

##### LUE all
```{r, fig.width = 10, fig.height = 4}

## All mortality form with facet_wrap
data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea2sa1md_out_annual_tile, ea3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate", "Constant Self-thinning"))

ggplot(data=data1) +
  geom_line(aes(x=A_Biomass, y=A_NPP,color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Levels of LUE",x="(A)Biomass", y="(A)NPP") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")


```

##### WD 
```{r}

# Biomass changes in WD with LUE level 1
# Mortality DBH

ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=plantC, y=NPP, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2ma_out_annual_tile, aes(x=plantC, y=NPP, color='600 kgC m-3')) +
  geom_line(data=ea1sa3ma_out_annual_tile, aes(x=plantC, y=NPP, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x="Biomass", y="NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2ma_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='600 kgC m-3')) +
  geom_line(data=ea1sa3ma_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Biomass changes in WD with LUE level 1
# Mortality Ratio NSC and Leaf Mass
ggplot() + 
  geom_line(data=ea1sa1mb_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2mb_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='600 kgC m-3')) +
  geom_line(data=ea1sa3mb_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Biomass changes in WD with LUE level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=ea1sa1mc_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2mc_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='600 kgC m-3')) +
  geom_line(data=ea1sa3mc_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

# Biomass changes in WD with LUE level 1
# Mortality Self-thinning
ggplot() + 
  geom_line(data=ea1sa1md_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2md_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='600 kgC m-3')) +
  geom_line(data=ea1sa3md_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Constant Self-thinning")

```

##### WD all
```{r, fig.width = 10, fig.height = 4}

## All mortality form with facet_wrap
data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea1sa2md_out_annual_tile, ea1sa3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate", "Constant Self-thinning"))

ggplot(data=data1) +
  geom_line(aes(x=A_Biomass, y=A_NPP, color=as.factor(LevelWD))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Levels of WD",x="(A)Biomass", y="(A)NPP") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

#### (A)NPP vs. mortality

From annual_tile_output: PlanC (Biomass)

##### LUE (mol/s/m2)
```{r}

# Biomass changes in LUE with WD level 1
# Mortality DBH

ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=c_deadtrees, y=NPP, color='Control')) + 
  geom_line(data=ea2sa1ma_out_annual_tile, aes(x=c_deadtrees, y=NPP, color='+15%')) +
  geom_line(data=ea3sa1ma_out_annual_tile, aes(x=c_deadtrees, y=NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Turnover", y="NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1ma_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1ma_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Biomass changes in LUE with WD level 1
# Mortality Ratio NSC and Leaf Mass
ggplot() + 
  geom_line(data=ea1sa1mb_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1mb_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1mb_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Biomass changes in LUE with WD level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=ea1sa1mc_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1mc_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1mc_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

# Biomass changes in LUE with WD level 1
# Mortality Constant Self-thinning
ggplot() + 
  geom_line(data=ea1sa1md_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1md_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1md_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Constant Self-thinning")

```

##### LUE all
```{r, fig.width = 10, fig.height = 4}

## All mortality form with facet_wrap

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate", "Constant Self-thinning"))

data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot(data=data1) +
  geom_line(aes(x=c_deadtrees, y=A_NPP,color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Levels of LUE",x="Turnover", y="(A)NPP") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

##### WD 
```{r}

# Biomass changes in WD with LUE level 1
# Mortality DBH

ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=c_deadtrees, y=NPP, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2ma_out_annual_tile, aes(x=c_deadtrees, y=NPP, color='600 kgC m-3')) +
  geom_line(data=ea1sa3ma_out_annual_tile, aes(x=c_deadtrees, y=NPP, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x="Turnover", y="NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2ma_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='600 kgC m-3')) +
  geom_line(data=ea1sa3ma_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Biomass changes in WD with LUE level 1
# Mortality Ratio NSC and Leaf Mass
ggplot() + 
  geom_line(data=ea1sa1mb_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2mb_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='600 kgC m-3')) +
  geom_line(data=ea1sa3mb_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Biomass changes in WD with LUE level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=ea1sa1mc_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2mc_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='600 kgC m-3')) +
  geom_line(data=ea1sa3mc_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

# Biomass changes in WD with LUE level 1
# Mortality Self-thinning
ggplot() + 
  geom_line(data=ea1sa1md_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2md_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='600 kgC m-3')) +
  geom_line(data=ea1sa3md_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Constant Self-thinning")


```

##### WD all
```{r, fig.width = 10, fig.height = 4}

## All mortality form with facet_wrap
data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea1sa2md_out_annual_tile, ea1sa3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate", "Constant Self-thinning"))

ggplot(data=data1) +
  geom_line(aes(x=c_deadtrees, y=A_NPP, color=as.factor(LevelWD))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Levels of WD",x="Turnover", y="(A)NPP") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot(data=data1) +
  geom_line(aes(x=c_deadtrees, y=A_NPP, color=as.factor(LevelWD))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Levels of WD",x="Turnover", y="(A)NPP") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

##### Crown Area Index over time

```{r, fig.width = 10, fig.height = 4}

data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea2sa1md_out_annual_tile, ea3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=CAI, color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend")+
  labs(x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea1sa2md_out_annual_tile, ea1sa3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=CAI, color=as.factor(LevelWD))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Level of WD", x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 


data1 <- rbind(eb1sa1ma_out_annual_tile, eb2sa1ma_out_annual_tile, eb3sa1ma_out_annual_tile,
               eb1sa1mb_out_annual_tile, eb2sa1mb_out_annual_tile, eb3sa1mb_out_annual_tile,
               eb1sa1mc_out_annual_tile, eb2sa1mc_out_annual_tile, eb3sa1mc_out_annual_tile,
               eb1sa1md_out_annual_tile, eb2sa1md_out_annual_tile, eb3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning", "BAL"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=CAI, color=as.factor(LevelPAR))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of PAR", guide = "legend")+
  labs(x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

data1 <- rbind(ea1sb1ma_out_annual_tile, ea1sb2ma_out_annual_tile, ea1sb3ma_out_annual_tile,
               ea1sb1mb_out_annual_tile, ea1sb2mb_out_annual_tile, ea1sb3mb_out_annual_tile,
               ea1sb1mc_out_annual_tile, ea1sb2mc_out_annual_tile, ea1sb3mc_out_annual_tile,
               ea1sb1md_out_annual_tile, ea1sb2md_out_annual_tile, ea1sb3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=CAI, color=as.factor(LevelRS))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("phiRL = 4","phiRL = 6", "phiRL = 8"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Level of RS", x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

```

```{r, fig.width = 10, fig.height = 4}

data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea2sa1md_out_annual_tile, ea3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=CAI, color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend")+
  labs(x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea1sa2md_out_annual_tile, ea1sa3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=CAI, color=as.factor(LevelWD))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Level of WD", x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

```

##### NPP
```{r}

data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea2sa1md_out_annual_tile, ea3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=NPP, color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend")+
  labs(x = "Year", y = "NPP") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

data1 <- rbind(eb1sa1ma_out_annual_tile, eb2sa1ma_out_annual_tile, eb3sa1ma_out_annual_tile,
               eb1sa1mb_out_annual_tile, eb2sa1mb_out_annual_tile, eb3sa1mb_out_annual_tile,
               eb1sa1mc_out_annual_tile, eb2sa1mc_out_annual_tile, eb3sa1mc_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=NPP, color=as.factor(LevelPAR))) + facet_wrap(~ Mortality, ncol=3)+
  scale_color_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of PAR", guide = "legend")+
  labs(x = "Year", y = "NPP") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea1sa2md_out_annual_tile, ea1sa3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=NPP, color=as.factor(LevelWD))) + facet_wrap(~ Mortality, ncol=3)+
  scale_color_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Level of WD", x = "Year", y = "NPP") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

data1 <- rbind(ea1sb1ma_out_annual_tile, ea1sb2ma_out_annual_tile, ea1sb3ma_out_annual_tile,
               ea1sb1mb_out_annual_tile, ea1sb2mb_out_annual_tile, ea1sb3mb_out_annual_tile,
               ea1sb1mc_out_annual_tile, ea1sb2mc_out_annual_tile, ea1sb3mc_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=NPP, color=as.factor(LevelRS))) + facet_wrap(~ Mortality, ncol=3)+
  scale_color_manual(labels = c("phiRL = 4","phiRL = 4", "phiRL = 4"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Level of RS", x = "Year", y = "NPP") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

```

##### NPP
```{r, fig.width = 10, fig.height = 4}

data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea2sa1md_out_annual_tile, ea3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=NPP, color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend")+
  labs(x = "Year", y = "NPP") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea1sa2md_out_annual_tile, ea1sa3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=NPP, color=as.factor(LevelWD))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Level of WD", x = "Year", y = "NPP") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

```

#### Self-thinning relathionships

From new annual_tile_output

```{r}

ggplot() + 
  geom_point(data=subset(ea1sa1ma_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=subset(ea2sa1ma_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=subset(ea3sa1ma_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

# Only one site with geom_smooth
data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile)
ggplot() + 
  geom_point(data=subset(data1, year>=100), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  geom_smooth(data=subset(data1, year>=100), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("Mortality as a function of size") + scale_x_continuous(limits = c(-1.5,-0.1))

# Only one site with geom_smooth
data1 <- rbind(ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile)
ggplot() + 
  geom_point(data=subset(data1, year>=100), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  geom_smooth(data=subset(data1, year>=100), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("Mortality as a function of growth rate") + scale_x_continuous(limits = c(-2.2,-0.6))

# Plots together

data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea2sa1md_out_annual_tile, ea3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_point(data=subset(data1, year>=100), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  geom_smooth(data=subset(data1, year>=100), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",lwd=0.1) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=4)
  
data1 <- rbind(eb1sa1ma_out_annual_tile, eb2sa1ma_out_annual_tile, eb3sa1ma_out_annual_tile,
               eb1sa1mb_out_annual_tile, eb2sa1mb_out_annual_tile, eb3sa1mb_out_annual_tile,
               eb1sa1mc_out_annual_tile, eb2sa1mc_out_annual_tile, eb3sa1mc_out_annual_tile,
               eb1sa1md_out_annual_tile, eb2sa1md_out_annual_tile, eb3sa1md_out_annual_tile,
               eb1sa1me_out_annual_tile, eb2sa1me_out_annual_tile, eb3sa1me_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning", "BAL"))

ggplot() + 
  geom_point(data=subset(data1, year>=100), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelPAR))) +
  geom_smooth(data=subset(data1, year>=100), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelPAR)),method = "lm") +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of PAR", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea1sa2md_out_annual_tile, ea1sa3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_point(data=subset(data1, year>=300), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelWD))) +
  geom_smooth(data=subset(data1, year>=300), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelWD)),method = "lm") +
  scale_color_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Level of WD", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=4)

data1 <- rbind(ea1sb1ma_out_annual_tile, ea1sb2ma_out_annual_tile, ea1sb3ma_out_annual_tile,
               ea1sb1mb_out_annual_tile, ea1sb2mb_out_annual_tile, ea1sb3mb_out_annual_tile,
               ea1sb1mc_out_annual_tile, ea1sb2mc_out_annual_tile, ea1sb3mc_out_annual_tile,
               ea1sb1md_out_annual_tile, ea1sb2md_out_annual_tile, ea1sb3md_out_annual_tile,
               ea1sb1me_out_annual_tile, ea1sb2me_out_annual_tile, ea1sb3me_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning", "BAL"))

ggplot() + 
  geom_point(data=subset(data1, year>=300), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelRS))) +
  geom_smooth(data=subset(data1, year>=300), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelRS)),method = "lm") +
  scale_color_manual(labels = c("phiRL = 4","phiRL = 6", "phiRL = 8"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Level of RS", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

```

```{r, fig.width = 10, fig.height = 4}

# Plots together

data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea2sa1md_out_annual_tile, ea3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_point(data=subset(data1, year>=100), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  geom_smooth(data=subset(data1, year>=100), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=4)

data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea1sa2md_out_annual_tile, ea1sa3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_point(data=subset(data1, year>=300), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelWD))) +
  geom_smooth(data=subset(data1, year>=300), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelWD)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Level of WD", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=4)

```

#### Distribution of tree sizes

From annual_cohort_output: dbh class 

##### LUE
```{r, fig.width = 6, fig.height = 9}
dataforplot <- rbind(ea1sa1ma_out_annual_cohorts,ea2sa1ma_out_annual_cohorts,ea3sa1ma_out_annual_cohorts)

ggplot(subset(dataforplot,dbhclass!="[0,0.12]")) + geom_bar(aes(fill=as.factor(LevelLUE), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE at WD 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot(subset(dataforplot,ageclass!="[0,10]"&ageclass!="(10,20]")) + geom_bar(aes(fill=as.factor(LevelLUE), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(x = "Age class (yrs)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE at WD 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

data1 <- rbind(ea1sa1ma_out_annual_cohorts, ea2sa1ma_out_annual_cohorts, ea3sa1ma_out_annual_cohorts,
               ea1sa1mb_out_annual_cohorts, ea2sa1mb_out_annual_cohorts, ea3sa1mb_out_annual_cohorts,
               ea1sa1mc_out_annual_cohorts, ea2sa1mc_out_annual_cohorts, ea3sa1mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot(data1) + geom_bar(aes(fill=as.factor(LevelLUE), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

ggplot(data1) + geom_bar(aes(fill=as.factor(LevelLUE), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(x = "Age class (yrs)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    facet_wrap(~ Mortality, ncol=3)

ggplot(subset(data1,dbhclass!="[0,0.12]")) + geom_bar(aes(fill=as.factor(LevelLUE), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

ggplot(subset(data1,ageclass!="[0,10]"&ageclass!="(10,20]"&ageclass!="(20,30]"&ageclass!="(30,40]")) + geom_bar(aes(fill=as.factor(LevelLUE), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(x = "Age class (yrs)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    facet_wrap(~ Mortality, ncol=1)
```

##### PAR
```{r, fig.width = 6, fig.height = 9}
data1 <- rbind(eb1sa1ma_out_annual_cohorts, eb2sa1ma_out_annual_cohorts, eb3sa1ma_out_annual_cohorts,
               eb1sa1mb_out_annual_cohorts, eb2sa1mb_out_annual_cohorts, eb3sa1mb_out_annual_cohorts,
               eb1sa1mc_out_annual_cohorts, eb2sa1mc_out_annual_cohorts, eb3sa1mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot(subset(data1,dbhclass!="[0,0.12]")) + geom_bar(aes(fill=as.factor(LevelPAR), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of PAR", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

ggplot(subset(data1,ageclass!="[0,10]"&ageclass!="(10,20]"&ageclass!="(20,30]"&ageclass!="(30,40]")) + geom_bar(aes(fill=as.factor(LevelPAR), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(x = "Age class (yr)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of PAR", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    facet_wrap(~ Mortality, ncol=1)
```

##### WD
```{r, fig.width = 6, fig.height = 9}
data1 <- rbind(ea1sa1ma_out_annual_cohorts, ea1sa2ma_out_annual_cohorts, ea1sa3ma_out_annual_cohorts,
               ea1sa1mb_out_annual_cohorts, ea1sa2mb_out_annual_cohorts, ea1sa3mb_out_annual_cohorts,
               ea1sa1mc_out_annual_cohorts, ea1sa2mc_out_annual_cohorts, ea1sa3mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot(subset(data1,dbhclass!="[0,0.12]")) + geom_bar(aes(fill=as.factor(LevelWD), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(fill= "Level of WD",x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    facet_wrap(~ Mortality, ncol=1)

ggplot(subset(data1,ageclass!="[0,10]"&ageclass!="(10,20]"&ageclass!="(20,30]"&ageclass!="(30,40]")) + geom_bar(aes(fill=as.factor(LevelWD), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(fill= "Level of WD", x = "Age class (yr)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    facet_wrap(~ Mortality, ncol=1)

```

##### R:S
```{r, fig.width = 6, fig.height = 9}
data1 <- rbind(ea1sb1ma_out_annual_cohorts, ea1sb2ma_out_annual_cohorts, ea1sb3ma_out_annual_cohorts,
               ea1sb1mb_out_annual_cohorts, ea1sb2mb_out_annual_cohorts, ea1sb3mb_out_annual_cohorts,
               ea1sb1mc_out_annual_cohorts, ea1sb2mc_out_annual_cohorts, ea1sb3mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot(subset(data1,dbhclass!="[0,0.12]")) + geom_bar(aes(fill=as.factor(LevelRS), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(fill= "Level of RS",x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_manual(labels = c("phiRL = 4","phiRL = 6", "phiRL = 8"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    facet_wrap(~ Mortality, ncol=1)

ggplot(subset(data1,ageclass!="[0,10]"&ageclass!="(10,20]"&ageclass!="(20,30]"&ageclass!="(30,40]")) + geom_bar(aes(fill=as.factor(LevelRS), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(fill= "Level of RS", x = "Age class (yr)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_manual(labels = c("phiRL = 4","phiRL = 6", "phiRL = 8"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    facet_wrap(~ Mortality, ncol=1)

```

#### Size bin (x, biomass, volume) vs. Growth (y, volume or mass increment per year); data = individual-level

From annual_cohort_output: dbh class NPP_yr

##### LUE
```{r, fig.width = 6, fig.height = 9}
library(dplyr)
library(forcats)
library(ggridges)

# Plot geom_density_ridges

dataBinLUE <- rbind(ea1sa1mc_out_annual_cohorts[,c(28,23,32,33,34,35)], ea2sa1mc_out_annual_cohorts[,c(28,23,32,33,34,35)], ea3sa1mc_out_annual_cohorts[,c(28,23,32,33,34,35)])

ggplot(dataBinLUE) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelLUE)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of LUE", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

data1 <- rbind(ea1sa1ma_out_annual_cohorts, ea2sa1ma_out_annual_cohorts, ea3sa1ma_out_annual_cohorts,
               ea1sa1mb_out_annual_cohorts, ea2sa1mb_out_annual_cohorts, ea3sa1mb_out_annual_cohorts,
               ea1sa1mc_out_annual_cohorts, ea2sa1mc_out_annual_cohorts, ea3sa1mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

data1DBHClass <- data1 %>% group_by(dbhclass,Mortality,LevelLUE) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 

ggplot(data1) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelLUE)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of LUE", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

ggplot() + 
  geom_point(data=data1DBHClass, aes(x=dbhclass, y=NPP_yr_aggr, color=as.factor(LevelLUE))) +
  geom_errorbar(data=data1DBHClass, aes(x=dbhclass, ymin=NPP_yr_aggr-NPP_yr_sd,ymax=NPP_yr_aggr+NPP_yr_sd,color=as.factor(LevelLUE)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE",y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), x = "DBH class (m)") +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

#ggplot(dataBinLUE_cohortsDBHClassJoin_2_1_ma) +  geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#00BA38")+
#  labs(x = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

#ggplot(dataBinLUE_cohortsDBHClassJoin_3_1_ma) +  geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#619CFF")+
#  labs(x = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

data2 <- rbind(dataBinLUE_cohortsDBHClassJoin_2_1_ma, dataBinLUE_cohortsDBHClassJoin_2_1_mb, dataBinLUE_cohortsDBHClassJoin_2_1_mc)
data2$Mortality <- factor(data2$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data2) + geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#00BA38")+
#  labs(x = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data2) + geom_point(aes(dbhclass,RelEnan2_1),color="#00BA38")+
 labs(y = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), x = " DBH class (m)") + 
 theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
 facet_wrap(~ Mortality, ncol=3) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

data3 <- rbind(dataBinLUE_cohortsDBHClassJoin_3_1_ma, dataBinLUE_cohortsDBHClassJoin_3_1_mb, dataBinLUE_cohortsDBHClassJoin_3_1_mc)
data3$Mortality <- factor(data3$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data3) + geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#619CFF")+
#  labs(x = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data3) + geom_point(aes(dbhclass,RelEnan3_1),color="#619CFF")+
  labs(y = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), x = " DBH class (m)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

```

##### PAR
```{r, fig.width = 6, fig.height = 9}

# Plot geom_density_ridges

dataBinPAR <- rbind(eb1sa1mb_out_annual_cohorts[,c(28,23,32,33,34,35)], eb2sa1mb_out_annual_cohorts[,c(28,23,32,33,34,35)], eb3sa1mb_out_annual_cohorts[,c(28,23,32,33,34,35)])

ggplot(dataBinPAR) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelPAR)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of PAR", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

data1 <- rbind(eb1sa1ma_out_annual_cohorts, eb2sa1ma_out_annual_cohorts, eb3sa1ma_out_annual_cohorts,
               eb1sa1mb_out_annual_cohorts, eb2sa1mb_out_annual_cohorts, eb3sa1mb_out_annual_cohorts,
               eb1sa1mc_out_annual_cohorts, eb2sa1mc_out_annual_cohorts, eb3sa1mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

data1DBHClass <- data1 %>% group_by(dbhclass,Mortality,LevelPAR) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 

ggplot(data1) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelPAR)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of PAR", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

ggplot() + 
  geom_point(data=data1DBHClass, aes(x=dbhclass, y=NPP_yr_aggr, color=as.factor(LevelPAR))) +
  geom_errorbar(data=data1DBHClass, aes(x=dbhclass, ymin=NPP_yr_aggr-NPP_yr_sd,ymax=NPP_yr_aggr+NPP_yr_sd,color=as.factor(LevelPAR)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of PAR",y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), x = "DBH class (m)") +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

ggplot(dataBinPAR_cohortsDBHClassJoin_2_1_ma) +  geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#00BA38")+
  labs(x = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinPAR_cohortsDBHClassJoin_3_1_ma) +  geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#619CFF")+
  labs(x = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

data2 <- rbind(dataBinPAR_cohortsDBHClassJoin_2_1_ma, dataBinPAR_cohortsDBHClassJoin_2_1_mb, dataBinPAR_cohortsDBHClassJoin_2_1_mc)
data2$Mortality <- factor(data2$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data2) + geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#00BA38")+
#  labs(x = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data2) + geom_point(aes(dbhclass,RelEnan2_1),color="#00BA38")+
  labs(y = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), x = " DBH class (m)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

data3 <- rbind(dataBinPAR_cohortsDBHClassJoin_3_1_ma, dataBinPAR_cohortsDBHClassJoin_3_1_mb, dataBinPAR_cohortsDBHClassJoin_3_1_mc)
data3$Mortality <- factor(data3$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data3) + geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#619CFF")+
#  labs(x = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data3) + geom_point(aes(dbhclass,RelEnan3_1),color="#619CFF")+
  labs(y = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1])), x = " DBH class (m)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

```

#### Light bin (x, sum of basal area of trees with higher basal area than current one) vs. Growth (y, volume or mass increment per year); data = individual-level

From annual_cohort_output: dbh and NPP_yr

##### LUE
```{r, fig.width = 6, fig.height = 9}

# Plot geom_density_ridges

dataBinLUE <- rbind(ea1sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)], ea2sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)], ea3sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)])

ggplot(dataBinLUE) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelLUE)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of LUE", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

data1 <- rbind(ea1sa1ma_out_annual_cohorts, ea2sa1ma_out_annual_cohorts, ea3sa1ma_out_annual_cohorts,
               ea1sa1mb_out_annual_cohorts, ea2sa1mb_out_annual_cohorts, ea3sa1mb_out_annual_cohorts,
               ea1sa1mc_out_annual_cohorts, ea2sa1mc_out_annual_cohorts, ea3sa1mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot(data1) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelLUE)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of LUE", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

data1highBAClass <- data1 %>% group_by(highBAclass,Mortality,LevelLUE) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
data1highBAClass$Mortality <- factor(data1highBAClass$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot() + 
  geom_point(data=data1highBAClass, aes(x=highBAclass, y=NPP_yr_aggr, color=as.factor(LevelLUE))) +
  geom_errorbar(data=data1highBAClass, aes(x=highBAclass, ymin=NPP_yr_aggr-NPP_yr_sd,ymax=NPP_yr_aggr+NPP_yr_sd,color=as.factor(LevelLUE)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE",y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

data2 <- rbind(dataBinLUE_cohortsHighBAClassJoin_2_1_ma, dataBinLUE_cohortsHighBAClassJoin_2_1_mb, dataBinLUE_cohortsHighBAClassJoin_2_1_mc)
data2$Mortality <- factor(data2$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data2) + geom_density_ridges(aes(RelEnan2_1,highBAclass),alpha = .6, color = "white", fill="#00BA38")+
#  labs(x = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=1)

ggplot(data2) + geom_point(aes(highBAclass,RelEnan2_1),color="#00BA38")+
  labs(y = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

data3 <- rbind(dataBinLUE_cohortsHighBAClassJoin_3_1_ma, dataBinLUE_cohortsHighBAClassJoin_3_1_mb, dataBinLUE_cohortsHighBAClassJoin_3_1_mc)
data3$Mortality <- factor(data3$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data3) + geom_density_ridges(aes(RelEnan3_1,highBAclass),alpha = .6, color = "white", fill="#619CFF")+
#  labs(x = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=1)

ggplot(data3) + geom_point(aes(highBAclass,RelEnan3_1),color="#619CFF")+
  labs(y = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

```

##### PAR
```{r, fig.width = 6, fig.height = 9}

# Plot geom_density_ridges

dataBinPAR <- rbind(eb1sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)], eb2sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)], eb3sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)])

ggplot(dataBinPAR) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelPAR)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of PAR", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

data1 <- rbind(eb1sa1ma_out_annual_cohorts, eb2sa1ma_out_annual_cohorts, eb3sa1ma_out_annual_cohorts,
               eb1sa1mb_out_annual_cohorts, eb2sa1mb_out_annual_cohorts, eb3sa1mb_out_annual_cohorts,
               eb1sa1mc_out_annual_cohorts, eb2sa1mc_out_annual_cohorts, eb3sa1mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot(data1) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelPAR)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of PAR", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

data1highBAClass <- data1 %>% group_by(highBAclass,Mortality,LevelPAR) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
data1highBAClass$Mortality <- factor(data1highBAClass$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot() + 
  geom_point(data=data1highBAClass, aes(x=highBAclass, y=NPP_yr_aggr, color=as.factor(LevelPAR))) +
  geom_errorbar(data=data1highBAClass, aes(x=highBAclass, ymin=NPP_yr_aggr-NPP_yr_sd,ymax=NPP_yr_aggr+NPP_yr_sd,color=as.factor(LevelPAR)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of PAR",y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

data2 <- rbind(dataBinPAR_cohortsHighBAClassJoin_2_1_ma, dataBinPAR_cohortsHighBAClassJoin_2_1_mb, dataBinPAR_cohortsHighBAClassJoin_2_1_mc)
data2$Mortality <- factor(data2$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data2) + geom_density_ridges(aes(RelEnan2_1,highBAclass),alpha = .6, color = "white", fill="#00BA38")+
#  labs(x = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data2) + geom_point(aes(highBAclass,RelEnan2_1),color="#00BA38")+
  labs(y = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

data3 <- rbind(dataBinPAR_cohortsHighBAClassJoin_3_1_ma, dataBinPAR_cohortsHighBAClassJoin_3_1_mb, dataBinPAR_cohortsHighBAClassJoin_3_1_mc)
data3$Mortality <- factor(data3$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data3) + geom_density_ridges(aes(RelEnan3_1,highBAclass),alpha = .6, color = "white", fill="#619CFF")+
#  labs(x = expression(paste(NPP[PAR_1], " / " ,NPP[PAR_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data3) + geom_point(aes(highBAclass,RelEnan3_1),color="#619CFF")+
  labs(y = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1])), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

```

#### B* at maturity

From new annual_tile_output

##### LUE
```{r}

# Changes in LUE with WD level 1
ggplot() + 
  geom_point(data=simul_data$simuls[[2]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[5]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[8]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(3.5,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[2], color="#619CFF")

ggplot() + 
  geom_point(data=simul_data$simuls[[2]][50:1804,], aes(x=QMD, y=Density12, color='Control')) + 
  geom_point(data=simul_data$simuls[[5]][50:1804,], aes(x=QMD, y=Density12, color='+15%')) +
  geom_point(data=simul_data$simuls[[8]][50:1804,], aes(x=QMD, y=Density12, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[2], color="#619CFF")
 
lm1 <- lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,])
summary(lm1)
new1 <- data.frame(QMD = seq(0.1, 1, 0.1))
predictedDensity1 <- predict(lm1, new1)
new1 <- data.frame(QMD = seq(0.1, 1, 0.1),predictedDensity1)

lm2 <- lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,])
summary(lm2)
new2 <- data.frame(QMD = seq(0.1, 1, 0.1))
predictedDensity2 <- predict(lm2, new2)
new2 <- data.frame(QMD = seq(0.1, 1, 0.1),predictedDensity2)

lm3 <- lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,])
summary(lm3)
new3 <- data.frame(QMD = seq(0.1, 1, 0.1))
predictedDensity3 <- predict(lm3, new3)
new3 <- data.frame(QMD = seq(0.1, 1, 0.1),predictedDensity3)

BiomassMaturityLUE1WD1 <- simul_data$simuls[[2]][1300:1804,] %>% summarise(B_star = mean(plantC)) %>% mutate(N_QMD = new1[5,2])
BiomassMaturityLUE2WD1 <- simul_data$simuls[[5]][1300:1804,] %>% summarise(B_star = mean(plantC)) %>% mutate(N_QMD = new2[5,2])
BiomassMaturityLUE3WD1 <- simul_data$simuls[[8]][1300:1804,] %>% summarise(B_star = mean(plantC)) %>% mutate(N_QMD = new3[5,2])

ggplot() + 
  geom_point(data=BiomassMaturityLUE1WD1, aes(x=N_QMD, y=B_star, color='Control')) + 
  geom_point(data=BiomassMaturityLUE2WD1, aes(x=N_QMD, y=B_star, color='+15%')) +
  geom_point(data=BiomassMaturityLUE3WD1, aes(x=N_QMD, y=B_star, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "N at QMD=0.5", y = "B*") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

#### Longevity vs. growth rates

Hypothesis: The negative relationship between longevity vs. growth rates arises from variations between species, but disappears when looking at variations between sites.

Two plots:

- Different species at a given site: x = growth rate, y = longevity (or 1/mortality). Each point is one species (differing by wood density, root:shoot ratio). Add info either by using color ~site (given LUE, growing season length, PAR); or by combining data from multiple sites and normalising growth rates and longevity by site-level mean.
- Same species at different sites (differing by LUE, growing season length, PAR): x = growth rate, y = longevity. Each point is one site (show mean and standard deviations with x and y errorbars)

##### LUE

Todo:

- longevity is maximum age at tile-level, plot mean across multiple years after spinup
- plot change in DBH instead of NPP. Take the oldest cohort, and calculate DBH/age

##### LUE with Age max and dbh for oldest cohort (age max)
##### Same species at different sites (differing by LUE, growing season length, PAR)

```{r, fig.width = 10, fig.height = 4}
# Volume/Age
ea1sa1ma_out_annual_tileMaxAgg <- ea1sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
ea2sa1ma_out_annual_tileMaxAgg <- ea2sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
ea3sa1ma_out_annual_tileMaxAgg <- ea3sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))

ggplot() + 
  geom_point(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='Control')) + geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Control'),width=0)+ 
  geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='Control'),width=0)+
  geom_point(data=ea2sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='+15%')) + 
  geom_errorbar(data=ea2sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='+15%'),width=0)+ geom_errorbar(data=ea2sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='+15%'),width=0)+
geom_point(data=ea3sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='+30%')) + 
  geom_errorbar(data=ea3sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='+30%'),width=0) +
  geom_errorbar(data=ea3sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='+30%'),width=0)+
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0,1.75),breaks = seq(0,1.75,0.25)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

# Facet wrap
data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea2sa1md_out_annual_tile, ea3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

data1MAxAgg <- data1 %>% filter(year>=1300) %>% group_by(Mortality,LevelLUE) %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
 
ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelLUE))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelLUE)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color=as.factor(LevelLUE)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col="Levels of LUE",x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=4)

ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelLUE))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelLUE)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color=as.factor(LevelLUE)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col="Levels of LUE",x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=4)
```

##### Radiation with Age max
##### Same species at different sites (differing by LUE, growing season length, PAR)

```{r, fig.width = 8, fig.height = 4}

eb1sa1ma_out_annual_tileMaxAgg <- eb1sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
eb2sa1ma_out_annual_tileMaxAgg <- eb2sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
eb3sa1ma_out_annual_tileMaxAgg <- eb3sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
# Volume/Age
ggplot() + 
  geom_point(data=eb1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='Control')) + geom_errorbar(data=eb1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Control'),width=0)+ 
  geom_errorbar(data=eb1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='Control'),width=0)+
  geom_point(data=eb2sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='+15%')) + 
  geom_errorbar(data=eb2sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='+15%'),width=0)+ geom_errorbar(data=eb2sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='+15%'),width=0)+
geom_point(data=eb3sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='+30%')) + 
  geom_errorbar(data=eb3sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='+30%'),width=0) +
  geom_errorbar(data=eb3sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='+30%'),width=0)+
  scale_color_manual("Levels of PAR at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0,1.75),breaks = seq(0,1.75,0.25)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

# Facet wrap
data1 <- rbind(eb1sa1ma_out_annual_tile, eb2sa1ma_out_annual_tile, eb3sa1ma_out_annual_tile,
               eb1sa1mb_out_annual_tile, eb2sa1mb_out_annual_tile, eb3sa1mb_out_annual_tile,
               eb1sa1mc_out_annual_tile, eb2sa1mc_out_annual_tile, eb3sa1mc_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

data1MAxAgg <- data1 %>% filter(year>=1300) %>% group_by(Mortality,LevelPAR) %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
 
ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelPAR))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelPAR)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color=as.factor(LevelPAR)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col="Levels of PAR",x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelPAR))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelPAR)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color=as.factor(LevelPAR)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col="Levels of PAR",x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)
```

##### Wood density with Age max 
##### Different species at a given site: Each point is one species (differing by wood density, root:shoot ratio). Add info either by using color ~site (given LUE, growing season length, PAR).

```{r, fig.width = 8, fig.height = 4}

ea1sa1ma_out_annual_tileMaxAgg <- ea1sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
ea1sa2ma_out_annual_tileMaxAgg <- ea1sa2ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
ea1sa3ma_out_annual_tileMaxAgg <- ea1sa3ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
# Volume/Age
ggplot() + 
  geom_point(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='300 kgC m-3')) + geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='300 kgC m-3'),width=0)+ 
  geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='300 kgC m-3'),width=0)+
  geom_point(data=ea1sa2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='600 kgC m-3')) + 
  geom_errorbar(data=ea1sa2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='600 kgC m-3'),width=0)+ geom_errorbar(data=ea1sa2ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='600 kgC m-3'),width=0)+
geom_point(data=ea1sa3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='800 kgC m-3')) + 
  geom_errorbar(data=ea1sa3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='800 kgC m-3'),width=0) +
  geom_errorbar(data=ea1sa3ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='800 kgC m-3'),width=0)+
  scale_color_manual("Levels of WD at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB" ,"#E7B800", "#FC4E07"))+
  labs(x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0,1.75),breaks = seq(0,1.75,0.25)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

# Facet wrap
data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

data1MAxAgg <- data1 %>% filter(year>=1300) %>% group_by(Mortality,LevelWD) %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
 
ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelWD))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelWD)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color=as.factor(LevelWD)),width=0) +
  scale_color_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col="Levels of WD",x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelWD))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelWD)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color=as.factor(LevelWD)),width=0) +
  scale_color_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col="Levels of WD",x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

```

##### Rhoot:Shoot ratio with Age max 
##### Different species at a given site: Each point is one species (differing by wood density, root:shoot ratio). Add info either by using color ~site (given LUE, growing season length, PAR).

```{r, fig.width = 8, fig.height = 4}

ea1sb1ma_out_annual_tileMaxAgg <- ea1sb1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
ea1sb2ma_out_annual_tileMaxAgg <- ea1sb2ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
ea1sb3ma_out_annual_tileMaxAgg <- ea1sb3ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
# Volume/Age
ggplot() + 
  geom_point(data=ea1sb1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='phiRL = 4')) + geom_errorbar(data=ea1sb1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='phiRL = 4'),width=0)+ 
  geom_errorbar(data=ea1sb1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='phiRL = 4'),width=0)+
  geom_point(data=ea1sb2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='phiRL = 6')) + 
  geom_errorbar(data=ea1sb2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='phiRL = 6'),width=0)+ geom_errorbar(data=ea1sb2ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='phiRL = 6'),width=0)+
geom_point(data=ea1sb3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='phiRL = 8')) + 
  geom_errorbar(data=ea1sb3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='phiRL = 8'),width=0) +
  geom_errorbar(data=ea1sb3ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='phiRL = 8'),width=0)+
  scale_color_manual("Levels of R:S at LUE 1", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB" ,"#E7B800", "#FC4E07"))+
  labs(x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0,1.75),breaks = seq(0,1.75,0.25)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

# Facet wrap
data1 <- rbind(ea1sb1ma_out_annual_tile, ea1sb2ma_out_annual_tile, ea1sb3ma_out_annual_tile,
               ea1sb1mb_out_annual_tile, ea1sb2mb_out_annual_tile, ea1sb3mb_out_annual_tile,
               ea1sb1mc_out_annual_tile, ea1sb2mc_out_annual_tile, ea1sb3mc_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

data1MAxAgg <- data1 %>% filter(year>=1300) %>% group_by(Mortality,LevelRS) %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
 
ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelRS))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelRS)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color=as.factor(LevelRS)),width=0) +
  scale_color_manual(labels = c("phiRL = 4", "phiRL = 6", "phiRL = 8"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col="Levels of RS",x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelRS))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelRS)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color=as.factor(LevelRS)),width=0) +
  scale_color_manual(labels = c("phiRL = 4", "phiRL = 6", "phiRL = 8"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col="Levels of RS",x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

```

```{r}
if(!require(devtools)){install.packages(devtools)}
devtools::install_github("stineb/LSD")
library(LSD)

gg <- heatscatter(ea1sa1ma_out_annual_tile$A_Biomass, ea1sa1ma_out_annual_tile$NPP, xlab = "Modelled", ylab = "Observed", ggplot = TRUE)

data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot() + 
  geom_line(data=subset(data1,year>1500), aes(x=A_Biomass, y=NPP, color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=3)+
  scale_color_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend")+
  labs(x =  expression(paste("(A)biomass (Kg C ", m^-2, " ", yr^-1, ") ")), y = expression(paste("(A)NPP (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 


```

