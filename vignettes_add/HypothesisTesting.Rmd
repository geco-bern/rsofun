---
title: "Hypothesis testing"
output:
  html_document: 
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
library(dplyr)
library(rsofun)
library(ggplot2)
```

## Example

### Simulation settings

Manually select some sites from which we're going to use the data for evaluation and calibration.
```{r}
mysites <- c("ORNL")
```

Create a site meta info table that contains all the site-specific information that is used to force site-simulations (e.g. starting year, number of simulations years, elevation, etc.). For FLUXNET2015 data, required meta info is provided by the `rsofun` package (data frame `rsofun::metainfo_Tier1_sites_kgclimate_fluxnet2015`).
```{r}
siteinfo <- data.frame(sitename="ORNL", lon = 0.0, lat = 0.0, elv = 0.0)
```

Now specify the simulation parameters that are identical for all site-scale simulations.
```{r}
params_siml <- list(
      spinup                = TRUE,
      spinupyears           = 1793,
      recycle               = 11, # 9 or 11
      firstyeartrend        = 1998,
      nyeartrend            = 11, #9 or 11
      outputhourly          = FALSE,
      outputdaily           = TRUE,
      do_U_shaped_mortality = FALSE,
      update_annualLAImax   = FALSE,
      do_closedN_run        = TRUE,
      method_photosynth     = "pmodel", # gs_leuning or pmodel
      method_mortality      = "dbh" # cstarvation or growthrate or dbh
      )
```

### Define model parameters

#### Tile-level parameters

```{r}
params_tile <- list(
  soiltype     = 3,    # Sand = 1, LoamySand = 2, SandyLoam = 3, SiltLoam = 4, FrittedClay = 5, Loam = 6, Clay = 7
  FLDCAP       = 0.4,  # soil property: field capacity 
  WILTPT       = 0.05, # soil property: wilting point
  K1           = 2.0,  # turnover rate of fast SOM per year
  K2           = 0.1,  # turnover rate of slow SOM per year
  K_nitrogen   = 0.0,  # mineral Nitrogen turnover rate
  etaN         = 0.0,  # loss rate with runoff
  MLmixRatio   = 0.6,  # the ratio of C and N returned to litters from microbes
  l_fract      = 0.0,  # fraction of the carbon retained after leaf drop
  retransN     = 0.0,  # retranslocation coefficient of Nitrogen
  f_N_add      = 0.02, # re-fill of N for sapwood
  f_initialBSW = 0.005
  #LAImin       = 0.02
  # alpha_FR   =  1.2; gamma_FR = 12.0; dSlowSOM = 2.5 * iSOM + 1.5; rho_N_up0 = 0.1
  )

```

#### Species-level parameters

```{r}
params_species <- tibble(
  lifeform      = c(0,       1,        1,        1,        1,      1,        1,        1,      1,        1,        1),  # 0: grass; 1 Woody
  phenotype     = c(0,       1,        1,        1,        1,      1,        1,        1,      1,        1,        0),  # 0: Deciduous; 1 Evergreen
  pt            = c(1,       0,        0,        0,        0,      0,        0,        0,      0,        0,        0),  # 0: C3; 1: C4
  seedlingsize  = c(0.02,    0.05,     0.05,     0.05,     0.05,   0.05,     0.05,     0.05,   0.05,     0.05,     0.05), # initial size of seedlings
  LMA           = c(0.035,   0.14,     0.14,     0.14,     0.14,   0.14,    0.14,      0.14,   0.14,     0.14,     0.035),
  # Leaf mass per unit area: 0.035, 0.085, 0.135
  phiRL         = c(4.0,     1.0,      2.0,      3.0,      4.0,     5.0,     6.0,      7.0,   8.0,       9.0,      3.0),
  # Root:Shoot ratio:  4.0, 6.0, 8.0
  LNbase        = c(0.8E-3,  0.8E-3,   0.8E-3,   0.8E-3,   0.8E-3, 0.8E-3,   0.8E-3,   0.8E-3, 0.8E-3,   0.8E-3,   0.8E-3),   
  # kgN m-2 leaf, Vmax = 0.03125*LNbase
  laimax        = c(3.0,     3.5,      3.5,      3.5,      3.5,    3.5,      3.5,      3.5,    3.5,      3.5,      3.8),  
  # maximum crown LAI
  LAI_light     = c(3.0,     3.5,      3.5,      3.5,      3.5,    3.5,      3.5,      3.5,    3.5,      3.5,      3.8),  
  # Light-limited crown LAI
  Nfixrate0     = c(0.0,     0.0,      0.0,      0.0,      0.0,    0.0,      0.0,      0.0,    0.0,      0.0,      0.0),  
  # 0.03 kgN kgRootC-1 yr-1
  NfixCost0     = c(12.,     12.,      12.,      12.,      12.,    12.,      12.,      12.,    12.,      12.,      12.),  
  # 12, 24 gC/gN
  phiCSA        = c(1.25E-4, 0.25E-4,  0.25E-4,  0.25E-4,  0.25E-4,0.25E-4,  0.25E-4,  0.25E-4,0.25E-4,  0.25E-4,  0.25E-4),
  mortrate_d_c  = c(0.02,    0.02,     0.02,     0.02,     0.02,   0.02,     0.02,     0.02,   0.02,     0.02,     0.02),    
  # canopy tree mortality rate, year-1
  mortrate_d_u  = c(0.2,     0.08,     0.08,     0.08,     0.08,   0.08,     0.08,     0.08,   0.08,     0.08,     0.08),    
  # understory tree mortality rate, year-1
  maturalage    = c(0.5,     5,        5,        5,        5,      5,        5,        5,      5,        5,        5),
  fNSNmax       = c(5,       5,        5,        5,        5,      5,        5,        5,      5,        5,        5)
  ) %>% 
  bind_rows(., slice(., 1:5))
```

#### Soil parameters

By layers.
```{r}
# adopted from datatypes.mod.f90 l.538
params_soil <- tibble(
  type              = c("Coarse",  "Medium",   "Fine",    "CM",     "CF",     "MF",    "CMF",    "Peat",    "MCM"),
  GMD               = c(0.7, 0.4, 0.3, 0.1, 0.1, 0.07, 0.007, 0.3, 0.3),
  GSD               = c(5.0, 5.3, 7.4, 6.1, 6.1, 14.0, 15.0, 7.4, 7.4),
  vwc_sat           = c(0.380, 0.445, 0.448, 0.412, 0.414, 0.446, 0.424, 0.445, 0.445),
  chb               = c( 3.5,   6.4,  11.0,   4.8,   6.3,   8.4,   6.3,   6.4,   6.4),
  psi_sat_ref       = c(-600., -790., -910., -1580., -1680., -1880., -5980., -790., -790.), # Pa
  k_sat_ref         = c(130.8, 75.1, 53.2, 12.1, 11.1, 12.7, 1.69, 53.2, 53.2),      # mol/(s MPa m)
  alphaSoil         = rep(1.0, 9),
  heat_capacity_dry = c(1.2e6, 1.1e6, 1.1e6, 1.1e6, 1.1e6, 1.1e6, 1.1e6, 1.4e6,   1.0)
  )
```

#### Initial cohort specification

```{r}
init_cohort <- tibble(
 init_cohort_species = c(1,      2,        3,        4,      5,        6,        7,      8,        9,       10),
 init_cohort_nindivs = c(0.02,   0.02,     0.02,     0.02,   0.02,     0.02,     0.02,   0.02,     0.02,    0.02),
 init_cohort_bsw     = c(0.2,    0.2,      0.2,      0.2,    0.2,      0.2,      0.2,    0.2,      0.2,     0.2),
 init_cohort_bHW     = c(0.0,    0.0,      0.0,      0.0,    0.0,      0.0,      0.0,    0.0,      0.0,     0.0),
 init_cohort_nsc     = c(0.5,    0.5,      0.5,      0.5,    0.5,      0.5,      0.5,    0.5,      0.5,     0.5)
)

```

#### Initial soil pools

```{r}
# high N input --> Deciduous
# low  N input --> Evergreen
init_soil <- list(
 init_fast_soil_C    = 0.15,   # kg C m-2    # C/N = 15, 0.75 kg SOM ~ 50 gN
 init_slow_soil_C    = 16.0,   # kg C m-2    # C/N = 40
 init_Nmineral       = 2.5E-3, # kg N m-2
 N_input             = 0.0E-3  # 2.4E-3, # kg N m-2 yr-1, N deposit: 0.8 g N m-2 yr-1
)

```

### Define soil parameters

For now, this is implemented as an illustration. Should be made site-specific.
```{r}
df_soiltexture <- bind_rows(
  top    = tibble(layer = "top",    fsand = 0.4, fclay = 0.3, forg = 0.1, fgravel = 0.1),
  bottom = tibble(layer = "bottom", fsand = 0.4, fclay = 0.3, forg = 0.1, fgravel = 0.1)
)
```

### Get input

Get the input from the nice weird looking file with half-hourly data.

The file has the following variables (units):

 Year  DOY  Hour  T_air          Q_air          Wind_speed      Precip          Pressure        R_global_in      R_longwave_in   CO2
                      K          kg/kg          m/s     kg_H2O/m2/s               pa               W/m2            W/m2            ppm     

```{r}
forcing <- read_delim( paste0(path.package("rsofun"), "/extdata/ORNL_forcing.txt"), col_names = TRUE, delim = "\t") %>% 
  mutate(date = lubridate::ymd_hm( paste0( as.character(YEAR), "-01-01 00:00" ) ) + days(DOY-1) + hours(HOUR) ) %>% 
  mutate(sitename = "ORNL") %>% 
  dplyr::filter(!(mday(date)==29 & month(date)==2))

## convert rain to units per seconds
dt_secs <- lubridate::interval(forcing$date[1], forcing$date[2]) %>% 
  time_length("seconds")
forcing <- forcing %>% 
  mutate(RAIN = RAIN / dt_secs)

```

For P-model runs, aggregate to daily forcing.
```{r}
if (params_siml$method_photosynth == "pmodel" && dt_secs != (60*60*24)){
  forcing <- forcing %>% 
    dplyr::group_by(lubridate::date(date)) %>% 
    summarise_at(vars(1:13), list(~mean(., na.rm = TRUE))) %>% 
    dplyr::select(-1)
}

# Changing values of PAR for running simulations
#forcing <- forcing %>% mutate(PAR = PAR*1.3) # levels = *1, *1.15 and *1.30

```

### Run the model

Run the model for all the sites specified in the first step.
```{r}
out <- run_lm3ppa_f_bysite( "ORNL", 
                            params_siml, 
                            siteinfo, 
                            forcing, # ddf_input
                            params_tile, 
                            params_species, 
                            params_soil, 
                            init_cohort, 
                            init_soil, 
                            makecheck = TRUE)

#save(out, file = "~/rsofun/output/out_lm3ppa_pmodel.RData")
rsofun_out_hourly_tile <- out$output_hourly_tile
rsofun_out_daily_tile <- out$output_daily_tile
rsofun_out_daily_cohorts <- out$output_daily_cohorts
rsofun_out_annual_tile <- out$output_annual_tile
rsofun_out_annual_cohorts <- out$output_annual_cohorts

rsofun_out_annual_tile %>% 
  ggplot() +
  geom_line(aes(x = year, y = GPP)) +
  labs(title = "LM3-PPA with gs leuning photosynthesis at ORNL", subtitle = "rsofun output")

rsofun_out_annual_tile %>% 
  ggplot() +
  geom_line(aes(x = year, y = Rauto)) +
  labs(title = "LM3-PPA with gs leuning photosynthesis at ORNL", subtitle = "rsofun output")

```

```{r}
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(rsofun_out_hourly_tile, "rsofun_out_hourly_tile.csv")
write.csv(rsofun_out_daily_tile,"rsofun_out_daily_tile.csv")
write.csv(rsofun_out_daily_cohorts,"rsofun_out_daily_cohorts.csv")
write.csv(rsofun_out_annual_tile,"rsofun_out_annual_tile.csv")
write.csv(rsofun_out_annual_cohorts,"rsofun_out_annual_cohorts.csv")
```

Run the model for with the p-model photosynthesis.
```{r}
out <- run_lm3ppa_f_bysite( "ORNL", 
                            params_siml, 
                            siteinfo, 
                            forcing, # ddf_input
                            params_tile, 
                            params_species, 
                            params_soil, 
                            init_cohort, 
                            init_soil, 
                            makecheck = TRUE)

#save(out, file = "~/rsofun/output/out_lm3ppa_pmodel.RData")
pmodel_out_hourly_tile <- out$output_hourly_tile
pmodel_out_daily_tile <- out$output_daily_tile
pmodel_out_daily_cohorts <- out$output_daily_cohorts
pmodel_out_annual_tile <- out$output_annual_tile
pmodel_out_annual_cohorts <- out$output_annual_cohorts

pmodel_out_annual_tile %>% 
  ggplot() +
  geom_line(aes(x = year, y = GPP)) +
  labs(title = "LM3-PPA with p-model photosynthesis at ORNL", subtitle = "rsofun output")

pmodel_out_annual_tile %>% 
  ggplot() +
  geom_line(aes(x = year, y = Rauto)) +
  labs(title = "LM3-PPA with p-model photosynthesis at ORNL", subtitle = "rsofun output")

```


Run the model for with the p-model photosynthesis.
```{r}
out <- run_lm3ppa_f_bysite( "ORNL", 
                            params_siml, 
                            siteinfo, 
                            forcing, # ddf_input
                            params_tile, 
                            params_species, 
                            params_soil, 
                            init_cohort, 
                            init_soil, 
                            makecheck = TRUE)

#save(out, file = "~/rsofun/output/out_lm3ppa_pmodel.RData")
pmodel_out_hourly_tile <- out$output_hourly_tile
pmodel_out_daily_tile <- out$output_daily_tile
pmodel_out_daily_cohorts <- out$output_daily_cohorts
pmodel_out_annual_tile <- out$output_annual_tile
pmodel_out_annual_cohorts <- out$output_annual_cohorts

pmodel_out_annual_tile %>% 
  ggplot() +
  geom_line(aes(x = year, y = GPP)) +
  labs(title = "LM3-PPA with p-model photosynthesis at ORNL", subtitle = "rsofun output")

pmodel_out_annual_tile %>% 
  ggplot() +
  geom_line(aes(x = year, y = Rauto)) +
  labs(title = "LM3-PPA with p-model photosynthesis at ORNL", subtitle = "rsofun output")

```

### Run the model

Run the model for all environmental conditions, species and mortality formulations.
```{r}
out <- run_lm3ppa_f_bysite( "ORNL", 
                            params_siml, 
                            siteinfo, 
                            forcing, # ddf_input
                            params_tile, 
                            params_species, 
                            params_soil, 
                            init_cohort, 
                            init_soil, 
                            makecheck = TRUE)

ea1sa1mb_out_hourly_tile <- out$output_hourly_tile
ea1sa1mb_out_daily_tile <- out$output_daily_tile
ea1sa1mb_out_daily_cohorts <- out$output_daily_cohorts
ea1sa1mb_out_annual_tile <- out$output_annual_tile
ea1sa1mb_out_annual_cohorts <- out$output_annual_cohorts

out$output_annual_tile %>% 
  ggplot() +
  geom_line(aes(x = year, y = GPP)) +
  labs(title = "LM3-PPA with p-model photosynthesis at ORNL", subtitle = "rsofun output")

out$output_daily_tile %>% 
  mutate(date = lubridate::ymd(paste0(year, "-01-01")) + lubridate::days(doy-1)) %>% 
  ggplot(aes(x=date, y=GPP)) +
  geom_line() + 
  labs(title = "LM3-PPA with p-model leuning photosynthesis at ORNL", subtitle = "rsofun output")

```

```{r}
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
write.csv(ea1sa1mb_out_hourly_tile, "ea1sa1mb_out_hourly_tile.csv")
write.csv(ea1sa1mb_out_daily_tile,"ea1sa1mb_out_daily_tile.csv")
write.csv(ea1sa1mb_out_daily_cohorts,"ea1sa1mb_out_daily_cohorts.csv")
write.csv(ea1sa1mb_out_annual_tile,"ea1sa1mb_out_annual_tile.csv")
write.csv(ea1sa1mb_out_annual_cohorts,"ea1sa1mb_out_annual_cohorts.csv")
```

```{r}
ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea1sa2ma_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea1sa3ma_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of Leaf Mass Area at LUE 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_classic() 
```

```{r}
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
rsofun_out_hourly_tile <- read.csv("rsofun_out_hourly_tile.csv")
rsofun_out_daily_tile  <- read.csv("rsofun_out_daily_tile.csv")
rsofun_out_daily_cohorts  <- read.csv("rsofun_out_daily_cohorts.csv")
rsofun_out_annual_tile  <- read.csv("rsofun_out_annual_tile.csv")
rsofun_out_annual_cohorts  <- read.csv("rsofun_out_annual_cohorts.csv")
```

```{r}
setwd("/Users/lmarques/rsofun/Simulations_pmodel")
ea1sa1ma_out_hourly_tile <- read.csv("ea1sa1ma_out_hourly_tile.csv")
ea1sa1ma_out_daily_tile  <- read.csv("ea1sa1ma_out_daily_tile.csv")
ea1sa1ma_out_daily_cohorts  <- read.csv("ea1sa1ma_out_daily_cohorts.csv")
ea1sa1ma_out_annual_tile  <- read.csv("ea1sa1ma_out_annual_tile.csv")
ea1sa1ma_out_annual_cohorts  <- read.csv("ea1sa1ma_out_annual_cohorts.csv")

ea1sa2ma_out_hourly_tile <- read.csv("ea1sa2ma_out_hourly_tile.csv")
ea1sa2ma_out_daily_tile  <- read.csv("ea1sa2ma_out_daily_tile.csv")
ea1sa2ma_out_daily_cohorts  <- read.csv("ea1sa2ma_out_daily_cohorts.csv")
ea1sa2ma_out_annual_tile  <- read.csv("ea1sa2ma_out_annual_tile.csv")
ea1sa2ma_out_annual_cohorts  <- read.csv("ea1sa2ma_out_annual_cohorts.csv")

ea1sa3ma_out_hourly_tile <- read.csv("ea1sa3ma_out_hourly_tile.csv")
ea1sa3ma_out_daily_tile  <- read.csv("ea1sa3ma_out_daily_tile.csv")
ea1sa3ma_out_daily_cohorts  <- read.csv("ea1sa3ma_out_daily_cohorts.csv")
ea1sa3ma_out_annual_tile  <- read.csv("ea1sa3ma_out_annual_tile.csv")
ea1sa3ma_out_annual_cohorts  <- read.csv("ea1sa3ma_out_annual_cohorts.csv")

ea2sa1ma_out_hourly_tile <- read.csv("ea2sa1ma_out_hourly_tile.csv")
ea2sa1ma_out_daily_tile  <- read.csv("ea2sa1ma_out_daily_tile.csv")
ea2sa1ma_out_daily_cohorts  <- read.csv("ea2sa1ma_out_daily_cohorts.csv")
ea2sa1ma_out_annual_tile  <- read.csv("ea2sa1ma_out_annual_tile.csv")
ea2sa1ma_out_annual_cohorts  <- read.csv("ea2sa1ma_out_annual_cohorts.csv")

ea2sa2ma_out_hourly_tile <- read.csv("ea2sa2ma_out_hourly_tile.csv")
ea2sa2ma_out_daily_tile  <- read.csv("ea2sa2ma_out_daily_tile.csv")
ea2sa2ma_out_daily_cohorts  <- read.csv("ea2sa2ma_out_daily_cohorts.csv")
ea2sa2ma_out_annual_tile  <- read.csv("ea2sa2ma_out_annual_tile.csv")
ea2sa2ma_out_annual_cohorts  <- read.csv("ea2sa2ma_out_annual_cohorts.csv")

ea2sa3ma_out_hourly_tile <- read.csv("ea2sa3ma_out_hourly_tile.csv")
ea2sa3ma_out_daily_tile  <- read.csv("ea2sa3ma_out_daily_tile.csv")
ea2sa3ma_out_daily_cohorts  <- read.csv("ea2sa3ma_out_daily_cohorts.csv")
ea2sa3ma_out_annual_tile  <- read.csv("ea2sa3ma_out_annual_tile.csv")
ea2sa3ma_out_annual_cohorts  <- read.csv("ea2sa3ma_out_annual_cohorts.csv")

ea3sa1ma_out_hourly_tile <- read.csv("ea3sa1ma_out_hourly_tile.csv")
ea3sa1ma_out_daily_tile  <- read.csv("ea3sa1ma_out_daily_tile.csv")
ea3sa1ma_out_daily_cohorts  <- read.csv("ea3sa1ma_out_daily_cohorts.csv")
ea3sa1ma_out_annual_tile  <- read.csv("ea3sa1ma_out_annual_tile.csv")
ea3sa1ma_out_annual_cohorts  <- read.csv("ea3sa1ma_out_annual_cohorts.csv")

ea3sa2ma_out_hourly_tile <- read.csv("ea3sa2ma_out_hourly_tile.csv")
ea3sa2ma_out_daily_tile  <- read.csv("ea3sa2ma_out_daily_tile.csv")
ea3sa2ma_out_daily_cohorts  <- read.csv("ea3sa2ma_out_daily_cohorts.csv")
ea3sa2ma_out_annual_tile  <- read.csv("ea3sa2ma_out_annual_tile.csv")
ea3sa2ma_out_annual_cohorts  <- read.csv("ea3sa2ma_out_annual_cohorts.csv")

ea3sa3ma_out_hourly_tile <- read.csv("ea3sa3ma_out_hourly_tile.csv")
ea3sa3ma_out_daily_tile  <- read.csv("ea3sa3ma_out_daily_tile.csv")
ea3sa3ma_out_daily_cohorts  <- read.csv("ea3sa3ma_out_daily_cohorts.csv")
ea3sa3ma_out_annual_tile  <- read.csv("ea3sa3ma_out_annual_tile.csv")
ea3sa3ma_out_annual_cohorts  <- read.csv("ea3sa3ma_out_annual_cohorts.csv")

ea1sb2ma_out_hourly_tile <- read.csv("ea1sb2ma_out_hourly_tile.csv")
ea1sb2ma_out_daily_tile  <- read.csv("ea1sb2ma_out_daily_tile.csv")
ea1sb2ma_out_daily_cohorts  <- read.csv("ea1sb2ma_out_daily_cohorts.csv")
ea1sb2ma_out_annual_tile  <- read.csv("ea1sb2ma_out_annual_tile.csv")
ea1sb2ma_out_annual_cohorts  <- read.csv("ea1sb2ma_out_annual_cohorts.csv")

ea1sb3ma_out_hourly_tile <- read.csv("ea1sb3ma_out_hourly_tile.csv")
ea1sb3ma_out_daily_tile  <- read.csv("ea1sb3ma_out_daily_tile.csv")
ea1sb3ma_out_daily_cohorts  <- read.csv("ea1sb3ma_out_daily_cohorts.csv")
ea1sb3ma_out_annual_tile  <- read.csv("ea1sb3ma_out_annual_tile.csv")
ea1sb3ma_out_annual_cohorts  <- read.csv("ea1sb3ma_out_annual_cohorts.csv")

ea2sb2ma_out_hourly_tile <- read.csv("ea2sb2ma_out_hourly_tile.csv")
ea2sb2ma_out_daily_tile  <- read.csv("ea2sb2ma_out_daily_tile.csv")
ea2sb2ma_out_daily_cohorts  <- read.csv("ea2sb2ma_out_daily_cohorts.csv")
ea2sb2ma_out_annual_tile  <- read.csv("ea2sb2ma_out_annual_tile.csv")
ea2sb2ma_out_annual_cohorts  <- read.csv("ea2sb2ma_out_annual_cohorts.csv")

ea2sb3ma_out_hourly_tile <- read.csv("ea2sb3ma_out_hourly_tile.csv")
ea2sb3ma_out_daily_tile  <- read.csv("ea2sb3ma_out_daily_tile.csv")
ea2sb3ma_out_daily_cohorts  <- read.csv("ea2sb3ma_out_daily_cohorts.csv")
ea2sb3ma_out_annual_tile  <- read.csv("ea2sb3ma_out_annual_tile.csv")
ea2sb3ma_out_annual_cohorts  <- read.csv("ea2sb3ma_out_annual_cohorts.csv")

ea3sb2ma_out_hourly_tile <- read.csv("ea3sb2ma_out_hourly_tile.csv")
ea3sb2ma_out_daily_tile  <- read.csv("ea3sb2ma_out_daily_tile.csv")
ea3sb2ma_out_daily_cohorts  <- read.csv("ea3sb2ma_out_daily_cohorts.csv")
ea3sb2ma_out_annual_tile  <- read.csv("ea3sb2ma_out_annual_tile.csv")
ea3sb2ma_out_annual_cohorts  <- read.csv("ea3sb2ma_out_annual_cohorts.csv")

ea3sb3ma_out_hourly_tile <- read.csv("ea3sb3ma_out_hourly_tile.csv")
ea3sb3ma_out_daily_tile  <- read.csv("ea3sb3ma_out_daily_tile.csv")
ea3sb3ma_out_daily_cohorts  <- read.csv("ea3sb3ma_out_daily_cohorts.csv")
ea3sb3ma_out_annual_tile  <- read.csv("ea3sb3ma_out_annual_tile.csv")
ea3sb3ma_out_annual_cohorts  <- read.csv("ea3sb3ma_out_annual_cohorts.csv")

eb2sa1ma_out_hourly_tile <- read.csv("eb2sa1ma_out_hourly_tile.csv")
eb2sa1ma_out_daily_tile  <- read.csv("eb2sa1ma_out_daily_tile.csv")
eb2sa1ma_out_daily_cohorts  <- read.csv("eb2sa1ma_out_daily_cohorts.csv")
eb2sa1ma_out_annual_tile  <- read.csv("eb2sa1ma_out_annual_tile.csv")
eb2sa1ma_out_annual_cohorts  <- read.csv("eb2sa1ma_out_annual_cohorts.csv")

eb2sa2ma_out_hourly_tile <- read.csv("eb2sa2ma_out_hourly_tile.csv")
eb2sa2ma_out_daily_tile  <- read.csv("eb2sa2ma_out_daily_tile.csv")
eb2sa2ma_out_daily_cohorts  <- read.csv("eb2sa2ma_out_daily_cohorts.csv")
eb2sa2ma_out_annual_tile  <- read.csv("eb2sa2ma_out_annual_tile.csv")
eb2sa2ma_out_annual_cohorts  <- read.csv("eb2sa2ma_out_annual_cohorts.csv")

eb2sa3ma_out_hourly_tile <- read.csv("eb2sa3ma_out_hourly_tile.csv")
eb2sa3ma_out_daily_tile  <- read.csv("eb2sa3ma_out_daily_tile.csv")
eb2sa3ma_out_daily_cohorts  <- read.csv("eb2sa3ma_out_daily_cohorts.csv")
eb2sa3ma_out_annual_tile  <- read.csv("eb2sa3ma_out_annual_tile.csv")
eb2sa3ma_out_annual_cohorts  <- read.csv("eb2sa3ma_out_annual_cohorts.csv")

eb3sa1ma_out_hourly_tile <- read.csv("eb3sa1ma_out_hourly_tile.csv")
eb3sa1ma_out_daily_tile  <- read.csv("eb3sa1ma_out_daily_tile.csv")
eb3sa1ma_out_daily_cohorts  <- read.csv("eb3sa1ma_out_daily_cohorts.csv")
eb3sa1ma_out_annual_tile  <- read.csv("eb3sa1ma_out_annual_tile.csv")
eb3sa1ma_out_annual_cohorts  <- read.csv("eb3sa1ma_out_annual_cohorts.csv")

eb3sa2ma_out_hourly_tile <- read.csv("eb3sa2ma_out_hourly_tile.csv")
eb3sa2ma_out_daily_tile  <- read.csv("eb3sa2ma_out_daily_tile.csv")
eb3sa2ma_out_daily_cohorts  <- read.csv("eb3sa2ma_out_daily_cohorts.csv")
eb3sa2ma_out_annual_tile  <- read.csv("eb3sa2ma_out_annual_tile.csv")
eb3sa2ma_out_annual_cohorts  <- read.csv("eb3sa2ma_out_annual_cohorts.csv")

eb3sa3ma_out_hourly_tile <- read.csv("eb3sa3ma_out_hourly_tile.csv")
eb3sa3ma_out_daily_tile  <- read.csv("eb3sa3ma_out_daily_tile.csv")
eb3sa3ma_out_daily_cohorts  <- read.csv("eb3sa3ma_out_daily_cohorts.csv")
eb3sa3ma_out_annual_tile  <- read.csv("eb3sa3ma_out_annual_tile.csv")
eb3sa3ma_out_annual_cohorts  <- read.csv("eb3sa3ma_out_annual_cohorts.csv")

eb2sb2ma_out_hourly_tile <- read.csv("eb2sb2ma_out_hourly_tile.csv")
eb2sb2ma_out_daily_tile  <- read.csv("eb2sb2ma_out_daily_tile.csv")
eb2sb2ma_out_daily_cohorts  <- read.csv("eb2sb2ma_out_daily_cohorts.csv")
eb2sb2ma_out_annual_tile  <- read.csv("eb2sb2ma_out_annual_tile.csv")
eb2sb2ma_out_annual_cohorts  <- read.csv("eb2sb2ma_out_annual_cohorts.csv")

eb2sb3ma_out_hourly_tile <- read.csv("eb2sb3ma_out_hourly_tile.csv")
eb2sb3ma_out_daily_tile  <- read.csv("eb2sb3ma_out_daily_tile.csv")
eb2sb3ma_out_daily_cohorts  <- read.csv("eb2sb3ma_out_daily_cohorts.csv")
eb2sb3ma_out_annual_tile  <- read.csv("eb2sb3ma_out_annual_tile.csv")
eb2sb3ma_out_annual_cohorts  <- read.csv("eb2sb3ma_out_annual_cohorts.csv")

eb3sb2ma_out_hourly_tile <- read.csv("eb3sb2ma_out_hourly_tile.csv")
eb3sb2ma_out_daily_tile  <- read.csv("eb3sb2ma_out_daily_tile.csv")
eb3sb2ma_out_daily_cohorts  <- read.csv("eb3sb2ma_out_daily_cohorts.csv")
eb3sb2ma_out_annual_tile  <- read.csv("eb3sb2ma_out_annual_tile.csv")
eb3sb2ma_out_annual_cohorts  <- read.csv("eb3sb2ma_out_annual_cohorts.csv")

eb3sb3ma_out_hourly_tile <- read.csv("eb3sb3ma_out_hourly_tile.csv")
eb3sb3ma_out_daily_tile  <- read.csv("eb3sb3ma_out_daily_tile.csv")
eb3sb3ma_out_daily_cohorts  <- read.csv("eb3sb3ma_out_daily_cohorts.csv")
eb3sb3ma_out_annual_tile  <- read.csv("eb3sb3ma_out_annual_tile.csv")
eb3sb3ma_out_annual_cohorts  <- read.csv("eb3sb3ma_out_annual_cohorts.csv")

ea1sa1mb_out_hourly_tile <- read.csv("ea1sa1mb_out_hourly_tile.csv")
ea1sa1mb_out_daily_tile  <- read.csv("ea1sa1mb_out_daily_tile.csv")
ea1sa1mb_out_daily_cohorts  <- read.csv("ea1sa1mb_out_daily_cohorts.csv")
ea1sa1mb_out_annual_tile  <- read.csv("ea1sa1mb_out_annual_tile.csv")
ea1sa1mb_out_annual_cohorts  <- read.csv("ea1sa1mb_out_annual_cohorts.csv")

```

Same models for conditions by default
```{r}

ea1sb1ma_out_hourly_tile <- ea1sa1ma_out_hourly_tile
ea1sb1ma_out_daily_tile <- ea1sa1ma_out_daily_tile
ea1sb1ma_out_daily_cohorts <- ea1sa1ma_out_daily_cohorts
ea1sb1ma_out_annual_tile <- ea1sa1ma_out_annual_tile
ea1sb1ma_out_annual_cohorts <- ea1sa1ma_out_annual_cohorts

ea2sb1ma_out_hourly_tile <- ea2sa1ma_out_hourly_tile
ea2sb1ma_out_daily_tile <- ea2sa1ma_out_daily_tile
ea2sb1ma_out_daily_cohorts <- ea2sa1ma_out_daily_cohorts
ea2sb1ma_out_annual_tile <- ea2sa1ma_out_annual_tile
ea2sb1ma_out_annual_cohorts <- ea2sa1ma_out_annual_cohorts

ea3sb1ma_out_hourly_tile <- ea3sa1ma_out_hourly_tile
ea3sb1ma_out_daily_tile <- ea3sa1ma_out_daily_tile
ea3sb1ma_out_daily_cohorts <- ea3sa1ma_out_daily_cohorts
ea3sb1ma_out_annual_tile <- ea3sa1ma_out_annual_tile
ea3sb1ma_out_annual_cohorts <- ea3sa1ma_out_annual_cohorts

eb1sa1ma_out_hourly_tile <- ea1sa1ma_out_hourly_tile
eb1sa1ma_out_daily_tile <- ea1sa1ma_out_daily_tile
eb1sa1ma_out_daily_cohorts <- ea1sa1ma_out_daily_cohorts
eb1sa1ma_out_annual_tile <- ea1sa1ma_out_annual_tile
eb1sa1ma_out_annual_cohorts <- ea1sa1ma_out_annual_cohorts

eb1sb1ma_out_hourly_tile <- ea1sa1ma_out_hourly_tile
eb1sb1ma_out_daily_tile <- ea1sa1ma_out_daily_tile
eb1sb1ma_out_daily_cohorts <- ea1sa1ma_out_daily_cohorts
eb1sb1ma_out_annual_tile <- ea1sa1ma_out_annual_tile
eb1sb1ma_out_annual_cohorts <- ea1sa1ma_out_annual_cohorts

eb1sa2ma_out_hourly_tile <- ea1sa2ma_out_hourly_tile
eb1sa2ma_out_daily_tile <- ea1sa2ma_out_daily_tile
eb1sa2ma_out_daily_cohorts <- ea1sa2ma_out_daily_cohorts
eb1sa2ma_out_annual_tile <- ea1sa2ma_out_annual_tile
eb1sa2ma_out_annual_cohorts <- ea1sa2ma_out_annual_cohorts

eb1sa3ma_out_hourly_tile <- ea1sa3ma_out_hourly_tile
eb1sa3ma_out_daily_tile <- ea1sa3ma_out_daily_tile
eb1sa3ma_out_daily_cohorts <- ea1sa3ma_out_daily_cohorts
eb1sa3ma_out_annual_tile <- ea1sa3ma_out_annual_tile
eb1sa3ma_out_annual_cohorts <- ea1sa3ma_out_annual_cohorts

eb1sb2ma_out_hourly_tile <- ea1sb2ma_out_hourly_tile
eb1sb2ma_out_daily_tile <- ea1sb2ma_out_daily_tile
eb1sb2ma_out_daily_cohorts <- ea1sb2ma_out_daily_cohorts
eb1sb2ma_out_annual_tile <- ea1sb2ma_out_annual_tile
eb1sb2ma_out_annual_cohorts <- ea1sb2ma_out_annual_cohorts

eb1sb3ma_out_hourly_tile <- ea1sb3ma_out_hourly_tile
eb1sb3ma_out_daily_tile <- ea1sb3ma_out_daily_tile
eb1sb3ma_out_daily_cohorts <- ea1sb3ma_out_daily_cohorts
eb1sb3ma_out_annual_tile <- ea1sb3ma_out_annual_tile
eb1sb3ma_out_annual_cohorts <- ea1sb3ma_out_annual_cohorts

eb2sb1ma_out_hourly_tile <- eb2sa1ma_out_hourly_tile
eb2sb1ma_out_daily_tile <- eb2sa1ma_out_daily_tile
eb2sb1ma_out_daily_cohorts <- eb2sa1ma_out_daily_cohorts
eb2sb1ma_out_annual_tile <- eb2sa1ma_out_annual_tile
eb2sb1ma_out_annual_cohorts <- eb2sa1ma_out_annual_cohorts

eb3sb1ma_out_hourly_tile <- eb3sa1ma_out_hourly_tile
eb3sb1ma_out_daily_tile <- eb3sa1ma_out_daily_tile
eb3sb1ma_out_daily_cohorts <- eb3sa1ma_out_daily_cohorts
eb3sb1ma_out_annual_tile <- eb3sa1ma_out_annual_tile
eb3sb1ma_out_annual_cohorts <- eb3sa1ma_out_annual_cohorts

```

### Aggregating cohorts across years and cohorts

```{r}

rsofun_out_annual_cohorts <- rsofun_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE))

ea1sa1ma_out_annual_cohorts <- ea1sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1ma_out_annual_cohorts)[1]))
ea1sa2ma_out_annual_cohorts <- ea1sa2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa2ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(2, dim(ea1sa2ma_out_annual_cohorts)[1]))
ea1sa3ma_out_annual_cohorts <- ea1sa3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa3ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(3, dim(ea1sa3ma_out_annual_cohorts)[1]))
ea2sa1ma_out_annual_cohorts <- ea2sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(2, dim(ea2sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1ma_out_annual_cohorts)[1]))
ea2sa2ma_out_annual_cohorts <- ea2sa2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(2, dim(ea2sa2ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(2, dim(ea2sa2ma_out_annual_cohorts)[1]))
ea2sa3ma_out_annual_cohorts <- ea2sa3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(2, dim(ea2sa3ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(3, dim(ea2sa3ma_out_annual_cohorts)[1]))
ea3sa1ma_out_annual_cohorts <- ea3sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(3, dim(ea3sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1ma_out_annual_cohorts)[1]))
ea3sa2ma_out_annual_cohorts <- ea3sa2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(3, dim(ea3sa2ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(2, dim(ea3sa2ma_out_annual_cohorts)[1]))
ea3sa3ma_out_annual_cohorts <- ea3sa3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(3, dim(ea3sa3ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(3, dim(ea3sa3ma_out_annual_cohorts)[1]))

ea1sb1ma_out_annual_cohorts <- ea1sb1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb1ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(1, dim(ea1sb1ma_out_annual_cohorts)[1]))
ea1sb2ma_out_annual_cohorts <- ea1sb2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb2ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(2, dim(ea1sb2ma_out_annual_cohorts)[1]))
ea1sb3ma_out_annual_cohorts <- ea1sb3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sb3ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(3, dim(ea1sb3ma_out_annual_cohorts)[1]))
ea2sb1ma_out_annual_cohorts <- ea2sb1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>%mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(2, dim(ea2sb1ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(1, dim(ea2sb1ma_out_annual_cohorts)[1]))
ea2sb2ma_out_annual_cohorts <- ea2sb2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>%mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(2, dim(ea2sb2ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(2, dim(ea2sb2ma_out_annual_cohorts)[1]))
ea2sb3ma_out_annual_cohorts <- ea2sb3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(2, dim(ea2sb3ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(3, dim(ea2sb3ma_out_annual_cohorts)[1]))
ea3sb1ma_out_annual_cohorts <- ea3sb1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(3, dim(ea3sb1ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(1, dim(ea3sb1ma_out_annual_cohorts)[1]))
ea3sb2ma_out_annual_cohorts <- ea3sb2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(3, dim(ea3sb2ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(2, dim(ea3sb2ma_out_annual_cohorts)[1]))
ea3sb3ma_out_annual_cohorts <- ea3sb3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(3, dim(ea3sb3ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(3, dim(ea3sb3ma_out_annual_cohorts)[1]))

eb1sa1ma_out_annual_cohorts <- eb1sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(1, dim(eb1sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb1sa1ma_out_annual_cohorts)[1]))
eb1sa2ma_out_annual_cohorts <- eb1sa2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(1, dim(eb1sa2ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(2, dim(eb1sa2ma_out_annual_cohorts)[1]))
eb1sa3ma_out_annual_cohorts <- eb1sa3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(1, dim(eb1sa3ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(3, dim(eb1sa3ma_out_annual_cohorts)[1]))
eb2sa1ma_out_annual_cohorts <- eb2sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(2, dim(eb2sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb2sa1ma_out_annual_cohorts)[1]))
eb2sa2ma_out_annual_cohorts <- eb2sa2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(2, dim(eb2sa2ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(2, dim(eb2sa2ma_out_annual_cohorts)[1]))
eb2sa3ma_out_annual_cohorts <- eb2sa3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(2, dim(eb2sa3ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(3, dim(eb2sa3ma_out_annual_cohorts)[1]))
eb3sa1ma_out_annual_cohorts <- eb3sa1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(3, dim(eb3sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(eb3sa1ma_out_annual_cohorts)[1]))
eb3sa2ma_out_annual_cohorts <- eb3sa2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(3, dim(eb3sa2ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(2, dim(eb3sa2ma_out_annual_cohorts)[1]))
eb3sa3ma_out_annual_cohorts <- eb3sa3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(3, dim(eb3sa3ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(3, dim(eb3sa3ma_out_annual_cohorts)[1]))

eb1sb1ma_out_annual_cohorts <- eb1sb1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2))%>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(1, dim(eb1sb1ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(1, dim(eb1sb1ma_out_annual_cohorts)[1]))
eb1sb2ma_out_annual_cohorts <- eb1sb2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(1, dim(eb1sb2ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(2, dim(eb1sb2ma_out_annual_cohorts)[1]))
eb1sb3ma_out_annual_cohorts <- eb1sb3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(1, dim(eb1sb3ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(3, dim(eb1sb3ma_out_annual_cohorts)[1]))
eb2sb1ma_out_annual_cohorts <- eb2sb1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(2, dim(eb2sb1ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(1, dim(eb2sb1ma_out_annual_cohorts)[1]))
eb2sb2ma_out_annual_cohorts <- eb2sb2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(2, dim(eb2sb2ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(2, dim(eb2sb2ma_out_annual_cohorts)[1]))
eb2sb3ma_out_annual_cohorts <- eb2sb3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(2, dim(eb2sb3ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(3, dim(eb2sb3ma_out_annual_cohorts)[1]))
eb3sb1ma_out_annual_cohorts <- eb3sb1ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(3, dim(eb3sb1ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(1, dim(eb3sb1ma_out_annual_cohorts)[1]))
eb3sb2ma_out_annual_cohorts <- eb3sb2ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(3, dim(eb3sb2ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(2, dim(eb3sb2ma_out_annual_cohorts)[1]))
eb3sb3ma_out_annual_cohorts <- eb3sb3ma_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>%  mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelPAR = rep(3, dim(eb3sb3ma_out_annual_cohorts)[1])) %>% mutate(LevelRS = rep(3, dim(eb3sb3ma_out_annual_cohorts)[1]))

ea1sa1mb_out_annual_cohorts <- ea1sa1mb_out_annual_cohorts %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,10,0.5),include.lowest = TRUE)) %>% mutate(ageclass = cut(age ,breaks = seq(0,500,50),include.lowest = TRUE)) %>% mutate(basalArea = pi*(dbh/2)) %>% group_by(year) %>% mutate(highBA= map_dbl(basalArea,~sum(basalArea[basalArea>=.x]))-basalArea) %>%
  ungroup %>% mutate(highBAclass = cut(highBA ,breaks = seq(0,40,2),include.lowest = TRUE)) %>% mutate(LevelLUE = rep(1, dim(ea1sa1ma_out_annual_cohorts)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1ma_out_annual_cohorts)[1]))

rsofun_out_annual_cohortsMax <- rsofun_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)

ea1sa1ma_out_annual_cohortsMax <- ea1sa1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge) 
ea1sa2ma_out_annual_cohortsMax <- ea1sa2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea1sa3ma_out_annual_cohortsMax <- ea1sa3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea2sa1ma_out_annual_cohortsMax <- ea2sa1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea2sa2ma_out_annual_cohortsMax <- ea2sa2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea2sa3ma_out_annual_cohortsMax <- ea2sa3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea3sa1ma_out_annual_cohortsMax <- ea3sa1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea3sa2ma_out_annual_cohortsMax <- ea3sa2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea3sa3ma_out_annual_cohortsMax <- ea3sa3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)

ea1sb1ma_out_annual_cohortsMax <- ea1sb1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea1sb2ma_out_annual_cohortsMax <- ea1sb2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea1sb3ma_out_annual_cohortsMax <- ea1sb3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea2sb1ma_out_annual_cohortsMax <- ea2sb1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea2sb2ma_out_annual_cohortsMax <- ea2sb2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea2sb3ma_out_annual_cohortsMax <- ea2sb3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea3sb1ma_out_annual_cohortsMax <- ea3sb1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea3sb2ma_out_annual_cohortsMax <- ea3sb2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
ea3sb3ma_out_annual_cohortsMax <- ea3sb3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)

eb1sa1ma_out_annual_cohortsMax <- eb1sa1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb1sa2ma_out_annual_cohortsMax <- eb1sa2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb1sa3ma_out_annual_cohortsMax <- eb1sa3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb2sa1ma_out_annual_cohortsMax <- eb2sa1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb2sa2ma_out_annual_cohortsMax <- eb2sa2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb2sa3ma_out_annual_cohortsMax <- eb2sa3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb3sa1ma_out_annual_cohortsMax <- eb3sa1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb3sa2ma_out_annual_cohortsMax <- eb3sa2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb3sa3ma_out_annual_cohortsMax <- eb3sa3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)

eb1sb1ma_out_annual_cohortsMax <- eb1sb1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb1sb2ma_out_annual_cohortsMax <- eb1sb2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb1sb3ma_out_annual_cohortsMax <- eb1sb3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb2sb1ma_out_annual_cohortsMax <- eb2sb1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb2sb2ma_out_annual_cohortsMax <- eb2sb2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb2sb3ma_out_annual_cohortsMax <- eb2sb3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb3sb1ma_out_annual_cohortsMax <- eb3sb1ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb3sb2ma_out_annual_cohortsMax <- eb3sb2ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)
eb3sb3ma_out_annual_cohortsMax <- eb3sb3ma_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge)

ea1sa1mb_out_annual_cohortsMax <- ea1sa1mb_out_annual_cohorts %>% group_by(year) %>% summarize(maxAge = max(age), DBHmaxAge = dbh[which.max(age)]) %>% mutate(GrowthRate = DBHmaxAge/maxAge) 

rsofun_out_annual_cohortsDBHClass <- rsofun_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

ea1sa1ma_out_annual_cohortsDBHClass <- ea1sa1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea1sa2ma_out_annual_cohortsDBHClass <- ea1sa2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea1sa3ma_out_annual_cohortsDBHClass <- ea1sa3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa1ma_out_annual_cohortsDBHClass <- ea2sa1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa2ma_out_annual_cohortsDBHClass <- ea2sa2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa3ma_out_annual_cohortsDBHClass <- ea2sa3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa1ma_out_annual_cohortsDBHClass <- ea3sa1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa2ma_out_annual_cohortsDBHClass <- ea3sa2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa3ma_out_annual_cohortsDBHClass <- ea3sa3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

ea1sb1ma_out_annual_cohortsDBHClass <- ea1sb1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea1sb2ma_out_annual_cohortsDBHClass <- ea1sb2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea1sb3ma_out_annual_cohortsDBHClass <- ea1sb3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sb1ma_out_annual_cohortsDBHClass <- ea2sb1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sb2ma_out_annual_cohortsDBHClass <- ea2sb2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sb3ma_out_annual_cohortsDBHClass <- ea2sb3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sb1ma_out_annual_cohortsDBHClass <- ea3sb1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sb2ma_out_annual_cohortsDBHClass <- ea3sb2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sb3ma_out_annual_cohortsDBHClass <- ea3sb3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

eb1sa1ma_out_annual_cohortsDBHClass <- eb1sa1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sa2ma_out_annual_cohortsDBHClass <- eb1sa2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sa3ma_out_annual_cohortsDBHClass <- eb1sa3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa1ma_out_annual_cohortsDBHClass <- eb2sa1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa2ma_out_annual_cohortsDBHClass <- eb2sa2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa3ma_out_annual_cohortsDBHClass <- eb2sa3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa1ma_out_annual_cohortsDBHClass <- eb3sa1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa2ma_out_annual_cohortsDBHClass <- eb3sa2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa3ma_out_annual_cohortsDBHClass <- eb3sa3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

eb1sb1ma_out_annual_cohortsDBHClass <- eb1sb1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sb2ma_out_annual_cohortsDBHClass <- eb1sb2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sb3ma_out_annual_cohortsDBHClass <- eb1sb3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sb1ma_out_annual_cohortsDBHClass <- eb2sb1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sb2ma_out_annual_cohortsDBHClass <- eb2sb2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sb3ma_out_annual_cohortsDBHClass <- eb2sb3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sb1ma_out_annual_cohortsDBHClass <- eb3sb1ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sb2ma_out_annual_cohortsDBHClass <- eb3sb2ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sb3ma_out_annual_cohortsDBHClass <- eb3sb3ma_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

ea1sa1mb_out_annual_cohortsDBHClass <- ea1sa1mb_out_annual_cohorts %>% group_by(dbhclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

rsofun_out_annual_cohortsHighBAClass <- rsofun_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

ea1sa1ma_out_annual_cohortsHighBAClass <- ea1sa1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea1sa2ma_out_annual_cohortsHighBAClass <- ea1sa2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea1sa3ma_out_annual_cohortsHighBAClass <- ea1sa3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa1ma_out_annual_cohortsHighBAClass <- ea2sa1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa2ma_out_annual_cohortsHighBAClass <- ea2sa2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sa3ma_out_annual_cohortsHighBAClass <- ea2sa3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa1ma_out_annual_cohortsHighBAClass <- ea3sa1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa2ma_out_annual_cohortsHighBAClass <- ea3sa2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sa3ma_out_annual_cohortsHighBAClass <- ea3sa3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

ea1sb1ma_out_annual_cohortsHighBAClass <- ea1sb1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea1sb2ma_out_annual_cohortsHighBAClass <- ea1sb2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea1sb3ma_out_annual_cohortsHighBAClass <- ea1sb3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sb1ma_out_annual_cohortsHighBAClass <- ea2sb1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sb2ma_out_annual_cohortsHighBAClass <- ea2sb2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea2sb3ma_out_annual_cohortsHighBAClass <- ea2sb3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sb1ma_out_annual_cohortsHighBAClass <- ea3sb1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sb2ma_out_annual_cohortsHighBAClass <- ea3sb2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
ea3sb3ma_out_annual_cohortsHighBAClass <- ea3sb3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

eb1sa1ma_out_annual_cohortsHighBAClass <- eb1sa1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sa2ma_out_annual_cohortsHighBAClass <- eb1sa2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sa3ma_out_annual_cohortsHighBAClass <- eb1sa3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa1ma_out_annual_cohortsHighBAClass <- eb2sa1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa2ma_out_annual_cohortsHighBAClass <- eb2sa2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sa3ma_out_annual_cohortsHighBAClass <- eb2sa3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa1ma_out_annual_cohortsHighBAClass <- eb3sa1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa2ma_out_annual_cohortsHighBAClass <- eb3sa2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sa3ma_out_annual_cohortsHighBAClass <- eb3sa3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

eb1sb1ma_out_annual_cohortsHighBAClass <- eb1sb1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sb2ma_out_annual_cohortsHighBAClass <- eb1sb2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb1sb3ma_out_annual_cohortsHighBAClass <- eb1sb3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sb1ma_out_annual_cohortsHighBAClass <- eb2sb1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sb2ma_out_annual_cohortsHighBAClass <- eb2sb2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb2sb3ma_out_annual_cohortsHighBAClass <- eb2sb3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sb1ma_out_annual_cohortsHighBAClass <- eb3sb1ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sb2ma_out_annual_cohortsHighBAClass <- eb3sb2ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))
eb3sb3ma_out_annual_cohortsHighBAClass <- eb3sb3ma_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

ea1sa1mb_out_annual_cohortsHighBAClass <- ea1sa1mb_out_annual_cohorts %>% group_by(highBAclass,year) %>% summarize(NPP_yr_aggr = mean(NPP_yr))

rsofun_out_annual_cohortsMaxAgg <- tibble(rsofun_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,rsofun_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))

ea1sa1ma_out_annual_cohortsMaxAgg <- tibble(ea1sa1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea1sa1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea1sa2ma_out_annual_cohortsMaxAgg <- tibble(ea1sa2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea1sa2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea1sa3ma_out_annual_cohortsMaxAgg <- tibble(ea1sa3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea1sa3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea2sa1ma_out_annual_cohortsMaxAgg <- tibble(ea2sa1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea2sa1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea2sa2ma_out_annual_cohortsMaxAgg <- tibble(ea2sa2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea2sa2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea2sa3ma_out_annual_cohortsMaxAgg <- tibble(ea2sa3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea2sa3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea3sa1ma_out_annual_cohortsMaxAgg <- tibble(ea3sa1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea3sa1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea3sa2ma_out_annual_cohortsMaxAgg <- tibble(ea3sa2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea3sa2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea3sa3ma_out_annual_cohortsMaxAgg <- tibble(ea3sa3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea3sa3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))

ea1sb1ma_out_annual_cohortsMaxAgg <- tibble(ea1sb1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea1sb1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea1sb2ma_out_annual_cohortsMaxAgg <- tibble(ea1sb2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea1sb2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea1sb3ma_out_annual_cohortsMaxAgg <- tibble(ea1sb3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea1sb3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea2sb1ma_out_annual_cohortsMaxAgg <- tibble(ea2sb1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea2sb1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea2sb2ma_out_annual_cohortsMaxAgg <- tibble(ea2sb2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea2sb2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea2sb3ma_out_annual_cohortsMaxAgg <- tibble(ea2sb3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea2sb3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea3sb1ma_out_annual_cohortsMaxAgg <- tibble(ea3sb1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea3sb1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea3sb2ma_out_annual_cohortsMaxAgg <- tibble(ea3sb2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea3sb2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
ea3sb3ma_out_annual_cohortsMaxAgg <- tibble(ea3sb3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea3sb3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))

eb1sa1ma_out_annual_cohortsMaxAgg <- tibble(eb1sa1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb1sa1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb1sa2ma_out_annual_cohortsMaxAgg <- tibble(eb1sa2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb1sa2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb1sa3ma_out_annual_cohortsMaxAgg <- tibble(eb1sa3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb1sa3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb2sa1ma_out_annual_cohortsMaxAgg <- tibble(eb2sa1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb2sa1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb2sa2ma_out_annual_cohortsMaxAgg <- tibble(eb2sa2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb2sa2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb2sa3ma_out_annual_cohortsMaxAgg <- tibble(eb2sa3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb2sa3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb3sa1ma_out_annual_cohortsMaxAgg <- tibble(eb3sa1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb3sa1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb3sa2ma_out_annual_cohortsMaxAgg <- tibble(eb3sa2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb3sa2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb3sa3ma_out_annual_cohortsMaxAgg <- tibble(eb3sa3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb3sa3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))

eb1sb1ma_out_annual_cohortsMaxAgg <- tibble(eb1sb1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb1sb1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb1sb2ma_out_annual_cohortsMaxAgg <- tibble(eb1sb2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb1sb2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb1sb3ma_out_annual_cohortsMaxAgg <- tibble(eb1sb3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb1sb3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb2sb1ma_out_annual_cohortsMaxAgg <- tibble(eb2sb1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb2sb1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb2sb2ma_out_annual_cohortsMaxAgg <- tibble(eb2sb2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb2sb2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb2sb3ma_out_annual_cohortsMaxAgg <- tibble(eb2sb3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb2sb3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb3sb1ma_out_annual_cohortsMaxAgg <- tibble(eb3sb1ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb3sb1ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb3sb2ma_out_annual_cohortsMaxAgg <- tibble(eb3sb2ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb3sb2ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))
eb3sb3ma_out_annual_cohortsMaxAgg <- tibble(eb3sb3ma_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,eb3sb3ma_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))

ea1sa1mb_out_annual_cohortsMaxAgg <- tibble(ea1sa1mb_out_annual_cohortsMax %>% summarise(maxAge_mean=mean(maxAge,na.rm=T), sdmaxAge=sd(maxAge,na.rm=T)) ,ea1sa1mb_out_annual_cohortsMax %>% summarise(meanGR=mean(GrowthRate,na.rm=T), sdGR=sd(GrowthRate,na.rm=T)))

dataBinLUE_cohortsDBHClassJoin_2_1 <- ea1sa1ma_out_annual_cohortsDBHClass %>% inner_join(ea2sa1ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinLUE_cohortsDBHClassJoin_3_1 <- ea1sa1ma_out_annual_cohortsDBHClass %>% inner_join(ea3sa1ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinPAR_cohortsDBHClassJoin_2_1 <- eb1sa1ma_out_annual_cohortsDBHClass %>% inner_join(eb2sa1ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinPAR_cohortsDBHClassJoin_3_1 <- eb1sa1ma_out_annual_cohortsDBHClass %>% inner_join(eb3sa1ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinWD_cohortsDBHClassJoin_2_1 <- ea1sa1ma_out_annual_cohortsDBHClass %>% inner_join(ea1sa2ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinWD_cohortsDBHClassJoin_3_1 <- ea1sa1ma_out_annual_cohortsDBHClass %>% inner_join(ea1sa3ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinRS_cohortsDBHClassJoin_2_1 <- ea1sb1ma_out_annual_cohortsDBHClass %>% inner_join(ea1sb2ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinRS_cohortsDBHClassJoin_3_1 <- ea1sb1ma_out_annual_cohortsDBHClass %>% inner_join(ea1sb3ma_out_annual_cohortsDBHClass, 
by = c("dbhclass", "year"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)


dataBinLUE_cohortsHighBAClassJoin_2_1 <- ea1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(ea2sa1ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinLUE_cohortsHighBAClassJoin_3_1 <- ea1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(ea3sa1ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinPAR_cohortsHighBAClassJoin_2_1 <- eb1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(eb2sa1ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinPAR_cohortsHighBAClassJoin_3_1 <- eb1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(eb3sa1ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinWD_cohortsHighBAClassJoin_2_1 <- ea1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(ea1sa2ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinWD_cohortsHighBAClassJoin_3_1 <- ea1sa1ma_out_annual_cohortsHighBAClass %>% inner_join(ea1sa3ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinRS_cohortsHighBAClassJoin_2_1 <- ea1sb1ma_out_annual_cohortsHighBAClass %>% inner_join(ea1sb2ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year"))  %>% mutate(RelEnan2_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

dataBinRS_cohortsHighBAClassJoin_3_1 <- ea1sb1ma_out_annual_cohortsHighBAClass %>% inner_join(ea1sb3ma_out_annual_cohortsHighBAClass, 
by = c("highBAclass", "year"))  %>% mutate(RelEnan3_1 = NPP_yr_aggr.y/NPP_yr_aggr.x)

#rsofun_out_annual_cohorts <- rsofun_out_annual_cohorts %>% group_by(cohort) %>% mutate(DeltaWood = ifelse(year>1794, wood-lag(wood), NA)) %>% mutate(Deltadbh = ifelse(year>1794, dbh-lag(dbh), NA)) %>% mutate(Mortality = ifelse(year>1794, lag(density)-density, NA)) %>% mutate(Mortality = ifelse(Mortality<0,0,Mortality)) %>% mutate(Longevity=1/Mortality) %>% mutate(Longevity = ifelse(Longevity=="Inf",NA,Longevity)) %>% mutate(dbhclass = cut(dbh ,breaks = seq(0,3,0.5))) 

#rsofun_out_annual_cohortsSum <- rsofun_out_annual_cohorts[c(2,6:29)] %>% group_by(year) %>% summarise_all(funs(mean, sum),na.rm=T) 

```

### Nesting data from simulations

Collect data into a tidy data frame with simulations in rows, "treatment"  and wrapped data (time series of variables) in columns.
```{r}

simul_data <- tibble(
  type = c(rep("annual_tile",10),rep("annual_cohorts",10),rep("annual_cohorts_Max",10),rep("annual_cohorts_MaxAgg",10),
           rep("annual_tile",9),rep("annual_cohorts",9),rep("annual_cohorts_Max",9),rep("annual_cohorts_MaxAgg",9),
           rep("annual_tile",9),rep("annual_cohorts",9),rep("annual_cohorts_Max",9),rep("annual_cohorts_MaxAgg",9),
           rep("annual_tile",9),rep("annual_cohorts",9),rep("annual_cohorts_Max",9),rep("annual_cohorts_MaxAgg",9)),
  LUE = c(0,1,1,1,2,2,2,3,3,3,0,1,1,1,2,2,2,3,3,3,0,1,1,1,2,2,2,3,3,3,0,1,1,1,2,2,2,3,3,3,
          1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,rep(1,72)),
  GS = c(rep(1,148)),
  PAR = c(rep(1,76),
          1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,
          1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3),
  rho_wood = c(1,1,2,3,1,2,3,1,2,3,1,1,2,3,1,2,3,1,2,3,1,1,2,3,1,2,3,1,2,3,1,1,2,3,1,2,3,1,2,3,rep(1,36),
               1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3, rep(1,36)),
  phiRL = c(rep(1,40),1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,
            rep(1,36),1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3),
  Mortality = c(rep("A",148)),
  simuls = list(
    rsofun_out_annual_tile,
    ea1sa1ma_out_annual_tile,
    ea1sa2ma_out_annual_tile,
    ea1sa3ma_out_annual_tile,
    ea2sa1ma_out_annual_tile,
    ea2sa2ma_out_annual_tile,
    ea2sa3ma_out_annual_tile,
    ea3sa1ma_out_annual_tile,
    ea3sa2ma_out_annual_tile,
    ea3sa3ma_out_annual_tile,
    rsofun_out_annual_cohorts,
    ea1sa1ma_out_annual_cohorts,
    ea1sa2ma_out_annual_cohorts,
    ea1sa3ma_out_annual_cohorts,
    ea2sa1ma_out_annual_cohorts,
    ea2sa2ma_out_annual_cohorts,
    ea2sa3ma_out_annual_cohorts,
    ea3sa1ma_out_annual_cohorts,
    ea3sa2ma_out_annual_cohorts,
    ea3sa3ma_out_annual_cohorts,
    rsofun_out_annual_cohortsMax,
    ea1sa1ma_out_annual_cohortsMax,
    ea1sa2ma_out_annual_cohortsMax,
    ea1sa3ma_out_annual_cohortsMax,
    ea2sa1ma_out_annual_cohortsMax,
    ea2sa2ma_out_annual_cohortsMax,
    ea2sa3ma_out_annual_cohortsMax,
    ea3sa1ma_out_annual_cohortsMax,
    ea3sa2ma_out_annual_cohortsMax,
    ea3sa3ma_out_annual_cohortsMax,
    rsofun_out_annual_cohortsMaxAgg,
    ea1sa1ma_out_annual_cohortsMaxAgg,
    ea1sa2ma_out_annual_cohortsMaxAgg,
    ea1sa3ma_out_annual_cohortsMaxAgg,
    ea2sa1ma_out_annual_cohortsMaxAgg,
    ea2sa2ma_out_annual_cohortsMaxAgg,
    ea2sa3ma_out_annual_cohortsMaxAgg,
    ea3sa1ma_out_annual_cohortsMaxAgg,
    ea3sa2ma_out_annual_cohortsMaxAgg,
    ea3sa3ma_out_annual_cohortsMaxAgg,

    ea1sb1ma_out_annual_tile,
    ea1sb2ma_out_annual_tile,
    ea1sb3ma_out_annual_tile,
    ea2sb1ma_out_annual_tile,
    ea2sb2ma_out_annual_tile,
    ea2sb3ma_out_annual_tile,
    ea3sb1ma_out_annual_tile,
    ea3sb2ma_out_annual_tile,
    ea3sb3ma_out_annual_tile,
    ea1sb1ma_out_annual_cohorts,
    ea1sb2ma_out_annual_cohorts,
    ea1sb3ma_out_annual_cohorts,
    ea2sb1ma_out_annual_cohorts,
    ea2sb2ma_out_annual_cohorts,
    ea2sb3ma_out_annual_cohorts,
    ea3sb1ma_out_annual_cohorts,
    ea3sb2ma_out_annual_cohorts,
    ea3sb3ma_out_annual_cohorts,
    ea1sb1ma_out_annual_cohortsMax,
    ea1sb2ma_out_annual_cohortsMax,
    ea1sb3ma_out_annual_cohortsMax,
    ea2sb1ma_out_annual_cohortsMax,
    ea2sb2ma_out_annual_cohortsMax,
    ea2sb3ma_out_annual_cohortsMax,
    ea3sb1ma_out_annual_cohortsMax,
    ea3sb2ma_out_annual_cohortsMax,
    ea3sb3ma_out_annual_cohortsMax,
    ea1sb1ma_out_annual_cohortsMaxAgg,
    ea1sb2ma_out_annual_cohortsMaxAgg,
    ea1sb3ma_out_annual_cohortsMaxAgg,
    ea2sb1ma_out_annual_cohortsMaxAgg,
    ea2sb2ma_out_annual_cohortsMaxAgg,
    ea2sb3ma_out_annual_cohortsMaxAgg,
    ea3sb1ma_out_annual_cohortsMaxAgg,
    ea3sb2ma_out_annual_cohortsMaxAgg,
    ea3sb3ma_out_annual_cohortsMaxAgg,
    
    eb1sa1ma_out_annual_tile,
    eb1sa2ma_out_annual_tile,
    eb1sa3ma_out_annual_tile,
    eb2sa1ma_out_annual_tile,
    eb2sa2ma_out_annual_tile,
    eb2sa3ma_out_annual_tile,
    eb3sa1ma_out_annual_tile,
    eb3sa2ma_out_annual_tile,
    eb3sa3ma_out_annual_tile,
    eb1sa1ma_out_annual_cohorts,
    eb1sa2ma_out_annual_cohorts,
    eb1sa3ma_out_annual_cohorts,
    eb2sa1ma_out_annual_cohorts,
    eb2sa2ma_out_annual_cohorts,
    eb2sa3ma_out_annual_cohorts,
    eb3sa1ma_out_annual_cohorts,
    eb3sa2ma_out_annual_cohorts,
    eb3sa3ma_out_annual_cohorts,
    eb1sa1ma_out_annual_cohortsMax,
    eb1sa2ma_out_annual_cohortsMax,
    eb1sa3ma_out_annual_cohortsMax,
    eb2sa1ma_out_annual_cohortsMax,
    eb2sa2ma_out_annual_cohortsMax,
    eb2sa3ma_out_annual_cohortsMax,
    eb3sa1ma_out_annual_cohortsMax,
    eb3sa2ma_out_annual_cohortsMax,
    eb3sa3ma_out_annual_cohortsMax,
    eb1sa1ma_out_annual_cohortsMaxAgg,
    eb1sa2ma_out_annual_cohortsMaxAgg,
    eb1sa3ma_out_annual_cohortsMaxAgg,
    eb2sa1ma_out_annual_cohortsMaxAgg,
    eb2sa2ma_out_annual_cohortsMaxAgg,
    eb2sa3ma_out_annual_cohortsMaxAgg,
    eb3sa1ma_out_annual_cohortsMaxAgg,
    eb3sa2ma_out_annual_cohortsMaxAgg,
    eb3sa3ma_out_annual_cohortsMaxAgg,
    
    eb1sb1ma_out_annual_tile,
    eb1sb2ma_out_annual_tile,
    eb1sb3ma_out_annual_tile,
    eb2sb1ma_out_annual_tile,
    eb2sb2ma_out_annual_tile,
    eb2sb3ma_out_annual_tile,
    eb3sb1ma_out_annual_tile,
    eb3sb2ma_out_annual_tile,
    eb3sb3ma_out_annual_tile,
    eb1sb1ma_out_annual_cohorts,
    eb1sb2ma_out_annual_cohorts,
    eb1sb3ma_out_annual_cohorts,
    eb2sb1ma_out_annual_cohorts,
    eb2sb2ma_out_annual_cohorts,
    eb2sb3ma_out_annual_cohorts,
    eb3sb1ma_out_annual_cohorts,
    eb3sb2ma_out_annual_cohorts,
    eb3sb3ma_out_annual_cohorts,
    eb1sb1ma_out_annual_cohortsMax,
    eb1sb2ma_out_annual_cohortsMax,
    eb1sb3ma_out_annual_cohortsMax,
    eb2sb1ma_out_annual_cohortsMax,
    eb2sb2ma_out_annual_cohortsMax,
    eb2sb3ma_out_annual_cohortsMax,
    eb3sb1ma_out_annual_cohortsMax,
    eb3sb2ma_out_annual_cohortsMax,
    eb3sb3ma_out_annual_cohortsMax,
    eb1sb1ma_out_annual_cohortsMaxAgg,
    eb1sb2ma_out_annual_cohortsMaxAgg,
    eb1sb3ma_out_annual_cohortsMaxAgg,
    eb2sb1ma_out_annual_cohortsMaxAgg,
    eb2sb2ma_out_annual_cohortsMaxAgg,
    eb2sb3ma_out_annual_cohortsMaxAgg,
    eb3sb1ma_out_annual_cohortsMaxAgg,
    eb3sb2ma_out_annual_cohortsMaxAgg,
    eb3sb3ma_out_annual_cohortsMaxAgg
  )
)

```

### Exploring relationships and plotting

#### Distribution of tree sizes

From annual_cohort_output: dbh class 

##### LUE
```{r}
library(dplyr)
library(forcats)
library(ggridges)

dataforplot <- rbind(simul_data$simuls[[12]],simul_data$simuls[[15]],simul_data$simuls[[18]])

ggplot(subset(dataforplot,dbhclass!="[0,0.5]")) + geom_bar(aes(fill=as.factor(LevelLUE), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE at WD 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot(subset(dataforplot,ageclass!="[0,50]")) + geom_bar(aes(fill=as.factor(LevelLUE), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE at WD 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

##### PAR
```{r}
library(dplyr)
library(forcats)
library(ggridges)

dataforplot <- rbind(simul_data$simuls[[86]],simul_data$simuls[[89]],simul_data$simuls[[92]])

ggplot(subset(dataforplot,dbhclass!="[0,0.5]")) + geom_bar(aes(fill=as.factor(LevelPAR), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of PAR at WD 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot(subset(dataforplot,ageclass!="[0,50]")) + geom_bar(aes(fill=as.factor(LevelPAR), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of PAR at WD 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

##### WD
```{r}
library(dplyr)
library(forcats)
library(ggridges)

dataforplot <- rbind(simul_data$simuls[[12]],simul_data$simuls[[13]],simul_data$simuls[[14]])

ggplot(subset(dataforplot,dbhclass!="[0,0.5]")) + geom_bar(aes(fill=as.factor(LevelWD), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of WD at LUE 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot(subset(dataforplot,ageclass!="[0,50]")) + geom_bar(aes(fill=as.factor(LevelWD), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of WD at LUE 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

##### RS
```{r}
library(dplyr)
library(forcats)
library(ggridges)

dataforplot <- rbind(simul_data$simuls[[50]],simul_data$simuls[[51]],simul_data$simuls[[52]])

ggplot(subset(dataforplot,dbhclass!="[0,0.5]")) + geom_bar(aes(fill=as.factor(LevelRS), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of R:S at LUE 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot(subset(dataforplot,ageclass!="[0,50]")) + geom_bar(aes(fill=as.factor(LevelRS), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of R:S at LUE 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

#### Stand develop: Stand biomass vs. time

From annual_tile_output: PlanC (Biomass)

##### LUE (mol/s/m2)
```{r}

library(scales)
hue_pal()(3)
show_col(hue_pal()(3))

# Biomass changes in LUE with WD level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[2]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[5]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[8]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Rauto changes in LUE with WD level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[2]], aes(x=year, y=Rauto, color='Control')) + 
  geom_line(data=simul_data$simuls[[5]], aes(x=year, y=Rauto, color='+15%')) +
  geom_line(data=simul_data$simuls[[8]], aes(x=year, y=Rauto, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# GPP changes in LUE with WD level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[2]], aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=simul_data$simuls[[5]], aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=simul_data$simuls[[8]], aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in LUE with WD level 2
ggplot() + 
  geom_line(data=simul_data$simuls[[3]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[6]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[9]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in LUE with WD level 3
ggplot() + 
  geom_line(data=simul_data$simuls[[4]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[7]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[10]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 3", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in LUE with root:shoot level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[41]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[44]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[47]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE at R:S 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in LUE with root:shoot level 2
ggplot() + 
  geom_line(data=simul_data$simuls[[42]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[45]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[48]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE at R:S 2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in LUE with root:shoot level 3
ggplot() + 
  geom_line(data=simul_data$simuls[[43]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[46]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[49]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE at R:S 3", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Additional plot for this: B* vs. initial slope of (B vs. t) 
# Changes in LUE with WD level 1

ggplot() + 
  geom_line(data=simul_data$simuls[[2]][1:150,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[5]][1:150,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[8]][1:150,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot() + 
  geom_line(data=simul_data$simuls[[2]][1300:1804,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[5]][1300:1804,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[8]][1300:1804,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

slope1 <- summary(lm(plantC ~ year, simul_data$simuls[[2]][1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, simul_data$simuls[[2]][1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, simul_data$simuls[[5]][1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, simul_data$simuls[[5]][1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, simul_data$simuls[[8]][1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, simul_data$simuls[[8]][1:150,]))$coefficients[2,2]

mean1 <- simul_data$simuls[[2]][1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- simul_data$simuls[[5]][1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- simul_data$simuls[[8]][1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
dataSlope <- data.frame(level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Additional plot for this: B* vs. initial slope of (B vs. t) 
# Changes in LUE with R:S level 1

ggplot() + 
  geom_line(data=simul_data$simuls[[41]][1:150,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[44]][1:150,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[47]][1:150,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot() + 
  geom_line(data=simul_data$simuls[[41]][1300:1804,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[44]][1300:1804,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[47]][1300:1804,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

slope1 <- summary(lm(plantC ~ year, simul_data$simuls[[41]][1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, simul_data$simuls[[41]][1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, simul_data$simuls[[44]][1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, simul_data$simuls[[44]][1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, simul_data$simuls[[47]][1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, simul_data$simuls[[47]][1:150,]))$coefficients[2,2]

mean1 <- simul_data$simuls[[41]][1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- simul_data$simuls[[44]][1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- simul_data$simuls[[47]][1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","Medium","High"))
dataSlope <- data.frame(level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of LUE at R:S 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")
```

##### Radiation
```{r}

# Biomass changes in Radiation with WD level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[77]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[80]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[83]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of Radiation at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Rauto changes in Radiation with WD level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[77]], aes(x=year, y=Rauto, color='Control')) + 
  geom_line(data=simul_data$simuls[[80]], aes(x=year, y=Rauto, color='+15%')) +
  geom_line(data=simul_data$simuls[[83]], aes(x=year, y=Rauto, color='+30%')) +
  scale_color_manual("Levels of Radiation at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# GPP changes in Radiation with WD level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[77]], aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=simul_data$simuls[[80]], aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=simul_data$simuls[[83]], aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of Radiation at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in Radiation with WD level 2
ggplot() + 
  geom_line(data=simul_data$simuls[[78]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[81]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[84]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of Radiation at WD 2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in Radiation with WD level 3
ggplot() + 
  geom_line(data=simul_data$simuls[[79]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[82]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[85]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of Radiation at WD 3", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in Radiation with root:shoot level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[113]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[116]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[119]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of Radiation at R:S 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in Radiation with root:shoot level 2
ggplot() + 
  geom_line(data=simul_data$simuls[[114]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[117]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[120]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of Radiation at R:S 2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in Radiation with root:shoot level 3
ggplot() + 
  geom_line(data=simul_data$simuls[[115]], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[118]], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[121]], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of Radiation at R:S 3", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Additional plot for this: B* vs. initial slope of (B vs. t) 
# Changes in Radiation with WD level 1

ggplot() + 
  geom_line(data=simul_data$simuls[[77]][1:150,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[80]][1:150,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[83]][1:150,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of Radiation at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot() + 
  geom_line(data=simul_data$simuls[[77]][1300:1804,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[80]][1300:1804,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[83]][1300:1804,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of Radiation at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

slope1 <- summary(lm(plantC ~ year, simul_data$simuls[[77]][1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, simul_data$simuls[[77]][1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, simul_data$simuls[[80]][1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, simul_data$simuls[[80]][1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, simul_data$simuls[[83]][1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, simul_data$simuls[[83]][1:150,]))$coefficients[2,2]

mean1 <- simul_data$simuls[[77]][1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- simul_data$simuls[[80]][1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- simul_data$simuls[[83]][1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
dataSlope <- data.frame(level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of Radiation at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Additional plot for this: B* vs. initial slope of (B vs. t) 
# Changes in Radiation with R:S level 1

ggplot() + 
  geom_line(data=simul_data$simuls[[113]][1:150,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[116]][1:150,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[119]][1:150,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of Radiation at R:S 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot() + 
  geom_line(data=simul_data$simuls[[113]][1300:1804,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=simul_data$simuls[[116]][1300:1804,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=simul_data$simuls[[119]][1300:1804,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of Radiation at R:S 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

slope1 <- summary(lm(plantC ~ year, simul_data$simuls[[113]][1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, simul_data$simuls[[113]][1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, simul_data$simuls[[116]][1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, simul_data$simuls[[116]][1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, simul_data$simuls[[119]][1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, simul_data$simuls[[119]][1:150,]))$coefficients[2,2]

mean1 <- simul_data$simuls[[113]][1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- simul_data$simuls[[116]][1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- simul_data$simuls[[119]][1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
dataSlope <- data.frame(level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of Radiation at R:S 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")
```

##### Wood density
```{r}

# Biomass changes in WD with LUE level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[2]], aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[3]], aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[4]], aes(x=year, y=plantC, color='900 kgC m-3')) +
  scale_color_manual("Levels of Wood density at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Rauto changes in WD with LUE level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[2]], aes(x=year, y=Rauto, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[3]], aes(x=year, y=Rauto, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[4]], aes(x=year, y=Rauto, color='900 kgC m-3')) +
  scale_color_manual("Levels of Wood density at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = "Rauto") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# GPP changes in WD with LUE level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[2]], aes(x=year, y=GPP, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[3]], aes(x=year, y=GPP, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[4]], aes(x=year, y=GPP, color='900 kgC m-3')) +
  scale_color_manual("Levels of Wood density at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in WD with LUE level 2
ggplot() + 
  geom_line(data=simul_data$simuls[[5]], aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[6]], aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[7]], aes(x=year, y=plantC, color='900 kgC m-3')) +
  scale_color_manual("Levels of Wood density at LUE 2", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in WD with LUE level 3
ggplot() + 
  geom_line(data=simul_data$simuls[[8]], aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[9]], aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[10]], aes(x=year, y=plantC, color='900 kgC m-3')) +
  scale_color_manual("Levels of Wood density at LUE 3", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in WD with Rad level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[77]], aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[78]], aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[79]], aes(x=year, y=plantC, color='900 kgC m-3')) +
  scale_color_manual("Levels of Wood density at Rad 1", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in WD with Rad level 2
ggplot() + 
  geom_line(data=simul_data$simuls[[80]], aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[81]], aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[82]], aes(x=year, y=plantC, color='900 kgC m-3')) +
  scale_color_manual("Levels of Wood density at Rad 2", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in WD with Rad level 3
ggplot() + 
  geom_line(data=simul_data$simuls[[83]], aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[84]], aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[85]], aes(x=year, y=plantC, color='900 kgC m-3')) +
  scale_color_manual("Levels of Wood density at Rad 3", breaks = c("300 kgC m-3", "600 kgC m-3", "High"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Additional plot for this: B* vs. initial slope of (B vs. t) 

ggplot() + 
  geom_line(data=simul_data$simuls[[2]][1:150,], aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[3]][1:150,], aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[4]][1:150,], aes(x=year, y=plantC, color='High')) +
  scale_color_manual("Levels of Wood density at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot() + 
  geom_line(data=simul_data$simuls[[2]][1300:1804,], aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[3]][1300:1804,], aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[4]][1300:1804,], aes(x=year, y=plantC, color='900 kgC m-3')) +
  scale_color_manual("Levels of Wood density at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

slope1 <- summary(lm(plantC ~ year, simul_data$simuls[[2]][1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, simul_data$simuls[[2]][1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, simul_data$simuls[[3]][1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, simul_data$simuls[[3]][1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, simul_data$simuls[[4]][1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, simul_data$simuls[[4]][1:150,]))$coefficients[2,2]

mean1 <- simul_data$simuls[[2]][1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- simul_data$simuls[[3]][1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- simul_data$simuls[[4]][1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("300 kgC m-3","600 kgC m-3","900 kgC m-3"))
dataSlope <- data.frame(level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of Wood density at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")
```

##### Root:Shoot ratio
```{r}

# Biomass changes in R:S with LUE level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[41]], aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=simul_data$simuls[[42]], aes(x=year, y=plantC, color='phiRL = 6')) +
  geom_line(data=simul_data$simuls[[43]], aes(x=year, y=plantC, color='phiRL = 8')) +
  scale_color_manual("Levels of Root:Shoot ratio at LUE 1", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Rauto changes in R:S with LUE level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[41]], aes(x=year, y=Rauto, color='phiRL = 4')) + 
  geom_line(data=simul_data$simuls[[42]], aes(x=year, y=Rauto, color='phiRL = 6')) +
  geom_line(data=simul_data$simuls[[43]], aes(x=year, y=Rauto, color='phiRL = 8')) +
  scale_color_manual("Levels of Root:Shoot ratio at LUE 1", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# GPP changes in R:S with LUE level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[41]], aes(x=year, y=GPP, color='phiRL = 4')) + 
  geom_line(data=simul_data$simuls[[42]], aes(x=year, y=GPP, color='phiRL = 6')) +
  geom_line(data=simul_data$simuls[[43]], aes(x=year, y=GPP, color='phiRL = 8')) +
  scale_color_manual("Levels of Root:Shoot ratio at LUE 1", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in R:S with LUE level 2
ggplot() + 
  geom_line(data=simul_data$simuls[[44]], aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=simul_data$simuls[[45]], aes(x=year, y=plantC, color='phiRL = 6')) +
  geom_line(data=simul_data$simuls[[46]], aes(x=year, y=plantC, color='phiRL = 8')) +
  scale_color_manual("Levels of Root:Shoot ratio at LUE 2", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in R:S with LUE level 3
ggplot() + 
  geom_line(data=simul_data$simuls[[47]], aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=simul_data$simuls[[48]], aes(x=year, y=plantC, color='phiRL = 6')) +
  geom_line(data=simul_data$simuls[[49]], aes(x=year, y=plantC, color='phiRL = 8')) +
  scale_color_manual("Levels of Root:Shoot ratio at LUE 3", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in R:S with Rad level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[113]], aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=simul_data$simuls[[114]], aes(x=year, y=plantC, color='phiRL = 6')) +
  geom_line(data=simul_data$simuls[[115]], aes(x=year, y=plantC, color='phiRL = 8')) +
  scale_color_manual("Levels of Root:Shoot ratio at Rad 1", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in R:S with Rad level 2
ggplot() + 
  geom_line(data=simul_data$simuls[[116]], aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=simul_data$simuls[[117]], aes(x=year, y=plantC, color='phiRL = 6')) +
  geom_line(data=simul_data$simuls[[118]], aes(x=year, y=plantC, color='phiRL = 8')) +
  scale_color_manual("Levels of Root:Shoot ratio at Rad 2", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Changes in R:S with Rad level 3
ggplot() + 
  geom_line(data=simul_data$simuls[[119]], aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=simul_data$simuls[[120]], aes(x=year, y=plantC, color='phiRL = 6')) +
  geom_line(data=simul_data$simuls[[121]], aes(x=year, y=plantC, color='phiRL = 8')) +
  scale_color_manual("Levels of Root:Shoot ratio at Rad 3", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Additional plot for this: B* vs. initial slope of (B vs. t) 

ggplot() + 
  geom_line(data=simul_data$simuls[[41]][1:150,], aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=simul_data$simuls[[42]][1:150,], aes(x=year, y=plantC, color='phiRL = 6')) +
  geom_line(data=simul_data$simuls[[43]][1:150,], aes(x=year, y=plantC, color='phiRL = 8')) +
  scale_color_manual("Levels of Root:Shoot ratio at LUE 1", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot() + 
  geom_line(data=simul_data$simuls[[41]][1300:1804,], aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=simul_data$simuls[[42]][1300:1804,], aes(x=year, y=plantC, color='phiRL = 6')) +
  geom_line(data=simul_data$simuls[[43]][1300:1804,], aes(x=year, y=plantC, color='phiRL = 8')) +
  scale_color_manual("Levels of Root:Shoot ratio at LUE 1", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

slope1 <- summary(lm(plantC ~ year, simul_data$simuls[[41]][1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, simul_data$simuls[[41]][1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, simul_data$simuls[[42]][1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, simul_data$simuls[[42]][1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, simul_data$simuls[[43]][1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, simul_data$simuls[[43]][1:150,]))$coefficients[2,2]

mean1 <- simul_data$simuls[[41]][1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- simul_data$simuls[[42]][1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- simul_data$simuls[[43]][1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("phiRL = 4","phiRL = 6","phiRL = 8"))
dataSlope <- data.frame(level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of Root:Shoot ratio at LUE 1", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

##### Stand biomass Plots
```{r}
library(ggpubr)
ggarrange(ggLUE1sa1,ggLUE1sa2,ggLUE1sa3, ncol = 1, nrow = 3, common.legend = T)
```

##### Crown Area Index over time
```{r}
# Changes in LUE with WD level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[2]][1:120,], aes(x=year, y=CAI, color='Control')) + 
  geom_line(data=simul_data$simuls[[5]][1:120,], aes(x=year, y=CAI, color='+15%')) +
  geom_line(data=simul_data$simuls[[8]][1:120,], aes(x=year, y=CAI, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot() + 
  geom_line(data=simul_data$simuls[[2]], aes(x=year, y=CAI, color='Control')) + 
  geom_line(data=simul_data$simuls[[5]], aes(x=year, y=CAI, color='+15%')) +
  geom_line(data=simul_data$simuls[[8]], aes(x=year, y=CAI, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")


# CAI changes in WD with LUE level 1
ggplot() + 
  geom_line(data=simul_data$simuls[[2]], aes(x=year, y=CAI, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[3]], aes(x=year, y=CAI, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[4]], aes(x=year, y=CAI, color='900 kgC m-3')) +
  scale_color_manual("Levels of Wood density at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot() + 
  geom_line(data=simul_data$simuls[[2]][1:120,], aes(x=year, y=CAI, color='300 kgC m-3')) + 
  geom_line(data=simul_data$simuls[[3]][1:120,], aes(x=year, y=CAI, color='600 kgC m-3')) +
  geom_line(data=simul_data$simuls[[4]][1:120,], aes(x=year, y=CAI, color='900 kgC m-3')) +
  scale_color_manual("Levels of Wood density at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Size distribution
ggplot() + 
  geom_point(data=simul_data$simuls[[12]] %>% group_by(dbhclass) %>% summarise(TotalDensity=sum(density)), aes(dbhclass, TotalDensity, color='Low')) + 
  geom_point(data=simul_data$simuls[[13]] %>% group_by(dbhclass) %>% summarise(TotalDensity=sum(density)), aes(dbhclass,TotalDensity,  color='Medium')) +
  geom_point(data=simul_data$simuls[[14]] %>% group_by(dbhclass) %>% summarise(TotalDensity=sum(density)), aes(dbhclass, TotalDensity, color='High')) +
  scale_color_manual("Levels of WD at LUE 1", breaks = c("Low", "Medium", "High"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "DBH class (m)", y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") "))) + 
  theme_classic() 

```

#### Self-thinning relathionships

From new annual_tile_output

##### LUE
```{r}

# Changes in LUE with WD level 1
ggplot() + 
  geom_point(data=simul_data$simuls[[2]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[5]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[8]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(3.5,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[2], color="#619CFF")
 
ggplot() + 
  geom_point(data=simul_data$simuls[[2]][50:1804,], aes(x=QMD, y=Density12, color='Control')) + 
  geom_point(data=simul_data$simuls[[5]][50:1804,], aes(x=QMD, y=Density12, color='+15%')) +
  geom_point(data=simul_data$simuls[[8]][50:1804,], aes(x=QMD, y=Density12, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Quadratic Mean Diameter (m)", y = expression(paste("Density (trees ", ha^-1, ") "))) + 
  theme_classic() 

# Changes in LUE with WD level 2
ggplot() + 
  geom_point(data=simul_data$simuls[[3]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[6]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[9]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE at WD 2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(3.5,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[3]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[3]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[6]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[6]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[9]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[9]][50:1804,]))[2], color="#619CFF")
 
# Changes in LUE with WD level 3
ggplot() + 
  geom_point(data=simul_data$simuls[[4]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[7]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[10]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE at WD 3", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(3.5,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[4]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[4]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[7]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[7]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[10]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[10]][50:1804,]))[2], color="#619CFF")
 
# Changes in LUE with R:S level 1
ggplot() + 
  geom_point(data=simul_data$simuls[[41]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[44]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[47]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE at R:S 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(3.5,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[41]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[41]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[44]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[44]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[47]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[47]][50:1804,]))[2], color="#619CFF")
 
# Changes in LUE with R:S level 2
ggplot() + 
  geom_point(data=simul_data$simuls[[42]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[45]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[48]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE at R:S 2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(3.5,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[42]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[42]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[45]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[45]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[48]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[48]][50:1804,]))[2], color="#619CFF")
 
# Changes in LUE with R:S level 3
ggplot() + 
  geom_point(data=simul_data$simuls[[43]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[46]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[49]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE at R:S 3", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(3.5,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[43]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[43]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[46]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[46]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[49]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[49]][50:1804,]))[2], color="#619CFF")
```

##### PAR
```{r}

# Changes in Radiation with WD level 1
ggplot() + 
  geom_point(data=simul_data$simuls[[77]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[80]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[83]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of Radiation at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(4,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[77]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[77]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[80]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[80]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[83]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[83]][50:1804,]))[2], color="#619CFF") 

ggplot() + 
  geom_point(data=simul_data$simuls[[77]][50:1804,], aes(x=QMD, y=Density12, color='Control')) + 
  geom_point(data=simul_data$simuls[[80]][50:1804,], aes(x=QMD, y=Density12, color='+15%')) +
  geom_point(data=simul_data$simuls[[83]][50:1804,], aes(x=QMD, y=Density12, color='+30%')) +
  scale_color_manual("Levels of Radiation at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Quadratic Mean Diameter (m)", y = expression(paste("Density (trees ", ha^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

# Changes in Radiation with WD level 2
ggplot() + 
  geom_point(data=simul_data$simuls[[78]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[81]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[84]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of Radiation at WD 2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(4.5,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[78]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[78]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[81]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[81]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[84]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[84]][50:1804,]))[2], color="#619CFF")
 

# Changes in Radiation with WD level 3
ggplot() + 
  geom_point(data=simul_data$simuls[[79]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[82]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[85]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of Radiation at WD 3", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  #scale_y_continuous(limits = c(4,6)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[79]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[79]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[82]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[82]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[85]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[85]][50:1804,]))[2], color="#619CFF")
 
# Changes in Radiation with R:S level 1
ggplot() + 
  geom_point(data=simul_data$simuls[[113]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[116]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[119]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of Radiation at R:S 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(4,6)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[113]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[113]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[116]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[116]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[119]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[119]][50:1804,]))[2], color="#619CFF")
 
# Changes in Radiation with WD level 2
ggplot() + 
  geom_point(data=simul_data$simuls[[114]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[117]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[120]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of Radiation at R:S 2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(4,6.3)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[114]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[114]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[117]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[117]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[120]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[120]][50:1804,]))[2], color="#619CFF") 

# Changes in Radiation with WD level 3
ggplot() + 
  geom_point(data=simul_data$simuls[[115]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[118]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[121]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of Radiation at R:S 3", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(4,6)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[115]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[115]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[118]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[118]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[121]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[121]][50:1804,]))[2], color="#619CFF")
```

##### WD
```{r}

# Changes in WD with LUE level 1
ggplot() + 
  geom_point(data=simul_data$simuls[[2]][70:1804,], aes(x=log(QMD), y=log(Density12), color='300 kgC m-3')) + 
  geom_point(data=simul_data$simuls[[3]][70:1804,], aes(x=log(QMD), y=log(Density12), color='600 kgC m-3')) +
  geom_point(data=simul_data$simuls[[4]][70:1804,], aes(x=log(QMD), y=log(Density12), color='900 kgC m-3')) +
  scale_color_manual("Levels of WD at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  scale_y_continuous(limits = c(3.75,8.5)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][70:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][70:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[3]][70:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[3]][70:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[4]][70:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[4]][70:1804,]))[2], color="#FC4E07") 

ggplot() + 
  geom_point(data=simul_data$simuls[[2]][50:1804,], aes(x=QMD, y=Density12, color='300 kgC m-3')) + 
  geom_point(data=simul_data$simuls[[3]][50:1804,], aes(x=QMD, y=Density12, color='600 kgC m-3')) +
  geom_point(data=simul_data$simuls[[4]][50:1804,], aes(x=QMD, y=Density12, color='900 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Quadratic Mean Diameter (m)", y = expression(paste("Density (trees ", ha^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

# Changes in WD with LUE level 2
ggplot() + 
  geom_point(data=simul_data$simuls[[5]][50:1804,], aes(x=log(QMD), y=log(Density12), color='300 kgC m-3')) + 
  geom_point(data=simul_data$simuls[[6]][50:1804,], aes(x=log(QMD), y=log(Density12), color='600 kgC m-3')) +
  geom_point(data=simul_data$simuls[[7]][50:1804,], aes(x=log(QMD), y=log(Density12), color='900 kgC m-3')) +
  scale_color_manual("Levels of WD at LUE 2", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  #scale_y_continuous(limits = c(4.75,5.75)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[6]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[6]][50:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[7]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[7]][50:1804,]))[2], color="#FC4E07") 

# Changes in WD with LUE level 3
ggplot() + 
  geom_point(data=simul_data$simuls[[8]][50:1804,], aes(x=log(QMD), y=log(Density12), color='300 kgC m-3')) + 
  geom_point(data=simul_data$simuls[[9]][50:1804,], aes(x=log(QMD), y=log(Density12), color='600 kgC m-3')) +
  geom_point(data=simul_data$simuls[[10]][50:1804,], aes(x=log(QMD), y=log(Density12), color='900 kgC m-3')) +
  scale_color_manual("Levels of WD at LUE 3", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  #scale_y_continuous(limits = c(4.75,5.75)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[9]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[9]][50:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[10]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[10]][50:1804,]))[2], color="#FC4E07") 

# Changes in WD with Rad level 1
ggplot() + 
  geom_point(data=simul_data$simuls[[77]][50:1804,], aes(x=log(QMD), y=log(Density12), color='300 kgC m-3')) + 
  geom_point(data=simul_data$simuls[[78]][50:1804,], aes(x=log(QMD), y=log(Density12), color='600 kgC m-3')) +
  geom_point(data=simul_data$simuls[[79]][50:1804,], aes(x=log(QMD), y=log(Density12), color='900 kgC m-3')) +
  scale_color_manual("Levels of WD at Rad 1", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  #scale_y_continuous(limits = c(4.75,5.75)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[77]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[77]][50:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[78]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[78]][50:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[79]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[79]][50:1804,]))[2], color="#FC4E07") 

# Changes in WD with Rad level 2
ggplot() + 
  geom_point(data=simul_data$simuls[[80]][50:1804,], aes(x=log(QMD), y=log(Density12), color='300 kgC m-3')) + 
  geom_point(data=simul_data$simuls[[81]][50:1804,], aes(x=log(QMD), y=log(Density12), color='600 kgC m-3')) +
  geom_point(data=simul_data$simuls[[82]][50:1804,], aes(x=log(QMD), y=log(Density12), color='900 kgC m-3')) +
  scale_color_manual("Levels of WD at Rad 2", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  #scale_y_continuous(limits = c(4.75,5.75)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[80]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[80]][50:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[81]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[81]][50:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[82]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[82]][50:1804,]))[2], color="#FC4E07") 

# Changes in WD with Rad level 3
ggplot() + 
  geom_point(data=simul_data$simuls[[83]][50:1804,], aes(x=log(QMD), y=log(Density12), color='300 kgC m-3')) + 
  geom_point(data=simul_data$simuls[[84]][50:1804,], aes(x=log(QMD), y=log(Density12), color='600 kgC m-3')) +
  geom_point(data=simul_data$simuls[[85]][50:1804,], aes(x=log(QMD), y=log(Density12), color='900 kgC m-3')) +
  scale_color_manual("Levels of WD at Rad 3", breaks = c("300 kgC m-3", "600 kgC m-3", "900 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  #scale_y_continuous(limits = c(4.75,5.75)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[83]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[83]][50:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[84]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[84]][50:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[85]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[85]][50:1804,]))[2], color="#FC4E07") 

```

##### Root:Shoot ratio
```{r}
# Changes in R:S with LUE level 1
ggplot() + 
  geom_point(data=simul_data$simuls[[41]][80:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL = 4')) + 
  geom_point(data=simul_data$simuls[[42]][80:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =6')) +
  geom_point(data=simul_data$simuls[[43]][80:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =8')) +
  scale_color_manual("Levels of R:S at LUE 1", breaks = c("phiRL = 4", "phiRL =6", "phiRL =8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  scale_y_continuous(limits = c(4.5,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[41]][80:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[41]][80:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[42]][80:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[42]][80:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[43]][80:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[43]][80:1804,]))[2], color="#FC4E07") 

ggplot() + 
  geom_point(data=simul_data$simuls[[41]][50:1804,], aes(x=QMD, y=Density12, color='phiRL = 4')) + 
  geom_point(data=simul_data$simuls[[42]][50:1804,], aes(x=QMD, y=Density12, color='phiRL =6')) +
  geom_point(data=simul_data$simuls[[43]][50:1804,], aes(x=QMD, y=Density12, color='phiRL =8')) +
  scale_color_manual("Levels of R:S", breaks = c("phiRL = 4", "phiRL =6", "phiRL =8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Quadratic Mean Diameter (m)", y = expression(paste("Density (trees ", ha^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

# Changes in R:S with LUE level 2
ggplot() + 
  geom_point(data=simul_data$simuls[[44]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL = 4')) + 
  geom_point(data=simul_data$simuls[[45]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =6')) +
  geom_point(data=simul_data$simuls[[46]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =8')) +
  scale_color_manual("Levels of R:S at LUE 2", breaks = c("phiRL = 4", "phiRL =6", "phiRL =8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  #scale_y_continuous(limits = c(4.75,5.75)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[44]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[44]][50:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[45]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[45]][50:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[46]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[46]][50:1804,]))[2], color="#FC4E07") 

# Changes in R:S with LUE level 3
ggplot() + 
  geom_point(data=simul_data$simuls[[47]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL = 4')) + 
  geom_point(data=simul_data$simuls[[48]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =6')) +
  geom_point(data=simul_data$simuls[[49]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =8')) +
  scale_color_manual("Levels of R:S at LUE 3", breaks = c("phiRL = 4", "phiRL =6", "phiRL =8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  #scale_y_continuous(limits = c(4.75,5.75)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[47]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[47]][50:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[48]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[48]][50:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[49]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[49]][50:1804,]))[2], color="#FC4E07") 

# Changes in R:S with Rad level 1
ggplot() + 
  geom_point(data=simul_data$simuls[[113]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL = 4')) + 
  geom_point(data=simul_data$simuls[[114]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =6')) +
  geom_point(data=simul_data$simuls[[115]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =8')) +
  scale_color_manual("Levels of R:S at Rad 1", breaks = c("phiRL = 4", "phiRL =6", "phiRL =8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  #scale_y_continuous(limits = c(4.75,5.75)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[113]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[113]][50:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[114]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[114]][50:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[115]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[115]][50:1804,]))[2], color="#FC4E07") 

# Changes in R:S with Rad level 2
ggplot() + 
  geom_point(data=simul_data$simuls[[116]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL = 4')) + 
  geom_point(data=simul_data$simuls[[117]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =6')) +
  geom_point(data=simul_data$simuls[[118]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =8')) +
  scale_color_manual("Levels of R:S at Rad 2", breaks = c("phiRL = 4", "phiRL =6", "phiRL =8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  #scale_y_continuous(limits = c(4.75,5.75)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[116]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[116]][50:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[117]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[117]][50:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[118]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[118]][50:1804,]))[2], color="#FC4E07") 
 
# Changes in R:S with Rad level 3
ggplot() + 
  geom_point(data=simul_data$simuls[[119]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL = 4')) + 
  geom_point(data=simul_data$simuls[[120]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =6')) +
  geom_point(data=simul_data$simuls[[121]][50:1804,], aes(x=log(QMD), y=log(Density12), color='phiRL =8')) +
  scale_color_manual("Levels of R:S at Rad 3", breaks = c("phiRL = 4", "phiRL =6", "phiRL =8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  #scale_y_continuous(limits = c(4.75,5.75)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[119]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[119]][50:1804,]))[2], color="#00AFBB") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[120]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[120]][50:1804,]))[2], color="#E7B800") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[121]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[121]][50:1804,]))[2], color="#FC4E07") 

```

##### Self-thinning Plots
```{r}
library(ggpubr)
ggarrange(ggLUE2,ggGS2,ggPAR2, ncol = 3, nrow = 1, common.legend = T)
ggarrange(ggWD2,ggRSR2,ggVCMAX2, ncol = 3, nrow = 1, common.legend = T)
```

#### Size bin (x, biomass, volume) vs. Growth (y, volume or mass increment per year); data = individual-level

From annual_cohort_output: dbh class NPP_yr

##### LUE
```{r}
library(dplyr)
library(forcats)
library(ggridges)

ggplot() + 
  geom_boxplot(data=simul_data$simuls[[12]], aes(x=dbhclass, y=NPP_yr, color='Control')) + 
  geom_boxplot(data=simul_data$simuls[[15]], aes(x=dbhclass, y=NPP_yr, color='+15%')) +
  geom_boxplot(data=simul_data$simuls[[18]], aes(x=dbhclass, y=NPP_yr, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "DBH class (m)", y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Plot geom_density_ridges

dataBinLUE <- rbind(simul_data$simuls[[12]][,c(28,31,23,32,33)], simul_data$simuls[[15]][,c(28,31,23,32,33)], simul_data$simuls[[18]][,c(28,31,23,32,33)])

ggplot(dataBinLUE) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelLUE)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of LUE at WD 1", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

ggplot(dataBinLUE_cohortsDBHClassJoin_2_1) +  geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#00BA38")+
  labs(x = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinLUE_cohortsDBHClassJoin_2_1) + 
  geom_boxplot(aes(x=dbhclass, y=RelEnan2_1),color="#00BA38") + 
  labs(x = " DBH class (m)", y = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1]))) 

ggplot(dataBinLUE_cohortsDBHClassJoin_3_1) +  geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#619CFF")+
  labs(x = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinLUE_cohortsDBHClassJoin_3_1) + 
  geom_boxplot(aes(x=dbhclass, y=RelEnan3_1),color="#619CFF") + 
  labs(x = " DBH class (m)", y = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1]))) 

```

##### PAR
```{r}

ggplot() + 
  geom_boxplot(data=simul_data$simuls[[86]], aes(x=dbhclass, y=NPP_yr, color='Low')) + 
  geom_boxplot(data=simul_data$simuls[[89]], aes(x=dbhclass, y=NPP_yr, color='Medium')) +
  geom_boxplot(data=simul_data$simuls[[92]], aes(x=dbhclass, y=NPP_yr, color='High')) +
  scale_color_manual("Levels of Radiation at WD 1", breaks = c("Low", "Medium", "High"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "DBH class (m)", y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") "))) + 
  theme_classic() 

# Plot geom_density_ridges

dataBinPAR <- rbind(simul_data$simuls[[86]][,c(28,31,23,32,33)], simul_data$simuls[[89]][,c(28,31,23,32,33)], simul_data$simuls[[92]][,c(28,31,23,32,33)])

ggplot(dataBinPAR) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelPAR)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of PAR at WD 1", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

ggplot(dataBinPAR_cohortsDBHClassJoin_2_1) +  geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#00BA38")+
  labs(x = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinPAR_cohortsDBHClassJoin_2_1) + 
  geom_boxplot(aes(x=dbhclass, y=RelEnan2_1),color="#00BA38") + 
  labs(x = " DBH class (m)", y = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1]))) 

ggplot(dataBinPAR_cohortsDBHClassJoin_3_1) +  geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#619CFF")+
  labs(x = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinPAR_cohortsDBHClassJoin_3_1) + 
  geom_boxplot(aes(x=dbhclass, y=RelEnan3_1),color="#619CFF") + 
  labs(x = " DBH class (m)", y = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1]))) 

```

##### WD
```{r}

ggplot() + 
  geom_boxplot(data=simul_data$simuls[[12]], aes(x=dbhclass, y=NPP_yr, color='Low')) + 
  geom_boxplot(data=simul_data$simuls[[13]], aes(x=dbhclass, y=NPP_yr, color='Medium')) +
  geom_boxplot(data=simul_data$simuls[[14]], aes(x=dbhclass, y=NPP_yr, color='High')) +
  scale_color_manual("Levels of WD at LUE 1", breaks = c("Low", "Medium", "High"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "DBH class (m)", y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") "))) + 
  theme_classic() 

#ggplot() + 
#  geom_density_ridges(data=simul_data$simuls[[12]], aes(NPP_yr,dbhclass, fill='Low'),alpha = .6, color = "white") + 
#  geom_density_ridges(data=simul_data$simuls[[13]], aes(NPP_yr,dbhclass, fill='Medium'),alpha = .6, color = "white") +
#  geom_density_ridges(data=simul_data$simuls[[14]], aes(NPP_yr,dbhclass, fill='High'),alpha = .6,color = "white") +
#  scale_fill_manual(name = "Levels of WD", breaks = c("Low", "Medium", "High"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
#  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
#  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

# Plot geom_density_ridges

dataBinWD <- rbind(simul_data$simuls[[12]][,c(28,31,23,22,32,33)], simul_data$simuls[[13]][,c(28,31,23,22,32,33)], simul_data$simuls[[14]][,c(28,31,23,22,32,33)])

ggplot(dataBinWD) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelWD)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "300 kgC m-3", `2` = "600 kgC m-3", `3` = "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"),
  name = "Levels of WD at LUE 1", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot(dataBinWD) +  geom_density_ridges(aes(GPP_yr,dbhclass,fill = paste(LevelWD)),alpha = .6, color = "white")+
  labs(x = expression(paste("GPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "300 kgC m-3", `2` = "600 kgC m-3", `3` = "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"),
  name = "Levels of WD at LUE 1", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

ggplot(dataBinWD_cohortsDBHClassJoin_2_1) +  geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#E7B800")+
  labs(x = expression(paste(NPP[WD_2], " / " ,NPP[WD_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinWD_cohortsDBHClassJoin_2_1) + 
  geom_boxplot(aes(x=dbhclass, y=RelEnan2_1),color="#E7B800") + 
  labs(x = " DBH class (m)", y = expression(paste(NPP[WD_2], " / " ,NPP[WD_1]))) 

ggplot(dataBinWD_cohortsDBHClassJoin_3_1) +  geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#FC4E07")+
  labs(x = expression(paste(NPP[WD_3], " / " ,NPP[WD_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinWD_cohortsDBHClassJoin_3_1) + 
  geom_boxplot(aes(x=dbhclass, y=RelEnan3_1),color="#FC4E07") + 
  labs(x = " DBH class (m)", y = expression(paste(NPP[WD_3], " / " ,NPP[WD_1]))) 

```

##### R:S Ratio
```{r}

ggplot() + 
  geom_boxplot(data=simul_data$simuls[[50]], aes(x=dbhclass, y=NPP_yr, color='Low')) + 
  geom_boxplot(data=simul_data$simuls[[51]], aes(x=dbhclass, y=NPP_yr, color='Medium')) +
  geom_boxplot(data=simul_data$simuls[[52]], aes(x=dbhclass, y=NPP_yr, color='High')) +
  scale_color_manual("Levels of Rhoot:Shoot ratio at LUE 1", breaks = c("Low", "Medium", "High"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "DBH class (m)", y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") "))) + 
  theme_classic() 

# Plot geom_density_ridges

dataBinRS <- rbind(simul_data$simuls[[50]][,c(28,31,23,32,33)], simul_data$simuls[[51]][,c(28,31,23,32,33)], simul_data$simuls[[52]][,c(28,31,23,32,33)])

ggplot(dataBinRS) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelRS)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "phiRL = 4", `2` = "phiRL = 6", `3` = "phiRL = 8"),values = c("#00AFBB", "#E7B800", "#FC4E07"),
  name = "Levels of RS at LUE 1", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

ggplot(dataBinRS_cohortsDBHClassJoin_2_1) +  geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#E7B800")+
  labs(x = expression(paste(NPP[R:S_2], " / " ,NPP[R:S_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinRS_cohortsDBHClassJoin_2_1) + 
  geom_boxplot(aes(x=dbhclass, y=RelEnan2_1),color="#E7B800") + 
  labs(x = " DBH class (m)", y = expression(paste(NPP[R:S_2], " / " ,NPP[R:S_1]))) 

ggplot(dataBinRS_cohortsDBHClassJoin_3_1) +  geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#FC4E07")+
  labs(x = expression(paste(NPP[R:S_3], " / " ,NPP[R:S_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinRS_cohortsDBHClassJoin_3_1) + 
  geom_boxplot(aes(x=dbhclass, y=RelEnan3_1),color="#FC4E07") + 
  labs(x = " DBH class (m)", y = expression(paste(NPP[R:S_3], " / " ,NPP[R:S_1]))) 

```

##### Size bin plots
```{r}
library(ggpubr)
ggarrange(ggLUE3,ggGS3,ggPAR3, ncol = 3, nrow = 1, common.legend = T)
ggarrange(ggWD3,ggRSR3,ggVCMAX3, ncol = 3, nrow = 1, common.legend = T)
```

#### Light bin (x, sum of basal area of trees with higher basal area than current one) vs. Growth (y, volume or mass increment per year); data = individual-level

From annual_cohort_output: dbh and NPP_yr

##### LUE
```{r}

ggplot() + 
  geom_boxplot(data=simul_data$simuls[[12]], aes(x=highBAclass, y=NPP_yr, color='Low')) + 
  geom_boxplot(data=simul_data$simuls[[15]], aes(x=highBAclass, y=NPP_yr, color='Medium')) +
  geom_boxplot(data=simul_data$simuls[[18]], aes(x=highBAclass, y=NPP_yr, color='High')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Low", "Medium", "High"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Plot geom_density_ridges

dataBinLUE <- rbind(simul_data$simuls[[12]][,c(28,31,23,32,33)], simul_data$simuls[[15]][,c(28,31,23,32,33)], simul_data$simuls[[18]][,c(28,31,23,32,33)])

ggplot(dataBinLUE) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelLUE)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of LUE at WD 1", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

ggplot(dataBinLUE_cohortsHighBAClassJoin_2_1[-68,]) +  geom_density_ridges(aes(RelEnan2_1,highBAclass),alpha = .6, color = "white", fill="#00BA38")+
  labs(x = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinLUE_cohortsHighBAClassJoin_2_1[-68,]) + 
  geom_boxplot(aes(x=highBAclass, y=RelEnan2_1),color="#00BA38") + 
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1]))) 

ggplot(dataBinLUE_cohortsHighBAClassJoin_3_1[-39,]) +  geom_density_ridges(aes(RelEnan3_1,highBAclass),alpha = .6, color = "white", fill="#619CFF")+
  labs(x = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinLUE_cohortsHighBAClassJoin_3_1[-39,]) + 
  geom_boxplot(aes(x=highBAclass, y=RelEnan3_1),color="#619CFF") + 
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1]))) 

```

##### PAR
```{r}

ggplot() + 
  geom_boxplot(data=simul_data$simuls[[86]], aes(x=highBAclass, y=NPP_yr, color='Low')) + 
  geom_boxplot(data=simul_data$simuls[[89]], aes(x=highBAclass, y=NPP_yr, color='Medium')) +
  geom_boxplot(data=simul_data$simuls[[92]], aes(x=highBAclass, y=NPP_yr, color='High')) +
  scale_color_manual("Levels of Radiation at WD 1", breaks = c("Low", "Medium", "High"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") "))) + 
  theme_classic() 

# Plot geom_density_ridges

dataBinPAR <- rbind(simul_data$simuls[[86]][,c(28,31,23,32,33)], simul_data$simuls[[89]][,c(28,31,23,32,33)], simul_data$simuls[[92]][,c(28,31,23,32,33)])

ggplot(dataBinPAR) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelPAR)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of PAR at WD 1", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

ggplot(dataBinPAR_cohortsHighBAClassJoin_2_1) +  geom_density_ridges(aes(RelEnan2_1,highBAclass),alpha = .6, color = "white", fill="#00BA38")+
  labs(x = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinPAR_cohortsHighBAClassJoin_2_1) + 
  geom_boxplot(aes(x=highBAclass, y=RelEnan2_1),color="#00BA38") + 
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1]))) 

ggplot(dataBinPAR_cohortsHighBAClassJoin_3_1[-55,]) +  geom_density_ridges(aes(RelEnan3_1,highBAclass),alpha = .6, color = "white", fill="#619CFF")+
  labs(x = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinPAR_cohortsHighBAClassJoin_3_1[-55,]) + 
  geom_boxplot(aes(x=highBAclass, y=RelEnan3_1),color="#619CFF") + 
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1]))) 

```

##### WD
```{r}

ggplot() + 
  geom_boxplot(data=simul_data$simuls[[12]], aes(x=highBAclass, y=NPP_yr, color='Low')) + 
  geom_boxplot(data=simul_data$simuls[[13]], aes(x=highBAclass, y=NPP_yr, color='Medium')) +
  geom_boxplot(data=simul_data$simuls[[14]], aes(x=highBAclass, y=NPP_yr, color='High')) +
  scale_color_manual("Levels of WD at LUE 1", breaks = c("Low", "Medium", "High"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") "))) + 
  theme_classic() 

# Plot geom_density_ridges

dataBinWD <- rbind(simul_data$simuls[[12]][,c(28,31,23,22,32,33)], simul_data$simuls[[13]][,c(28,31,23,22,32,33)], simul_data$simuls[[14]][,c(28,31,23,22,32,33)])

ggplot(dataBinWD) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelWD)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "300 kgC m-3", `2` = "600 kgC m-3", `3` = "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"),
  name = "Levels of WD at LUE 1", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot(dataBinWD) +  geom_density_ridges(aes(GPP_yr,highBAclass,fill = paste(LevelWD)),alpha = .6, color = "white")+
  labs(x = expression(paste("GPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "300 kgC m-3", `2` = "600 kgC m-3", `3` = "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"),
  name = "Levels of WD at LUE 1", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

ggplot(dataBinWD_cohortsHighBAClassJoin_2_1) +  geom_density_ridges(aes(RelEnan2_1,highBAclass),alpha = .6, color = "white", fill="#E7B800")+
  labs(x = expression(paste(NPP[WD_2], " / " ,NPP[WD_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinWD_cohortsHighBAClassJoin_2_1) + 
  geom_boxplot(aes(x=highBAclass, y=RelEnan2_1),color="#E7B800") + 
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste(NPP[WD_2], " / " ,NPP[WD_1]))) 

ggplot(dataBinWD_cohortsHighBAClassJoin_3_1) +  geom_density_ridges(aes(RelEnan3_1,highBAclass),alpha = .6, color = "white", fill="#FC4E07")+
  labs(x = expression(paste(NPP[WD_3], " / " ,NPP[WD_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinWD_cohortsHighBAClassJoin_3_1) + 
  geom_boxplot(aes(x=highBAclass, y=RelEnan3_1),color="#FC4E07") + 
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste(NPP[WD_3], " / " ,NPP[WD_1]))) 

```

##### R:S
```{r}

ggplot() + 
  geom_boxplot(data=simul_data$simuls[[50]], aes(x=highBAclass, y=NPP_yr, color='Low')) + 
  geom_boxplot(data=simul_data$simuls[[51]], aes(x=highBAclass, y=NPP_yr, color='Medium')) +
  geom_boxplot(data=simul_data$simuls[[52]], aes(x=highBAclass, y=NPP_yr, color='High')) +
  scale_color_manual("Levels of Rhoot:Shoot ratio at LUE 1", breaks = c("Low", "Medium", "High"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") "))) + 
  theme_classic() 

# Plot geom_density_ridges

dataBinRS <- rbind(simul_data$simuls[[50]][,c(28,31,23,32,33)], simul_data$simuls[[51]][,c(28,31,23,32,33)], simul_data$simuls[[52]][,c(28,31,23,32,33)])

ggplot(dataBinRS) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelRS)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "phiRL = 4", `2` = "phiRL = 6", `3` = "phiRL = 8"),values = c("#00AFBB", "#E7B800", "#FC4E07"),
  name = "Levels of RS at LUE 1", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

ggplot(dataBinRS_cohortsHighBAClassJoin_2_1) +  geom_density_ridges(aes(RelEnan2_1,highBAclass),alpha = .6, color = "white", fill="#E7B800")+
  labs(x = expression(paste(NPP[R:S_2], " / " ,NPP[R:S_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinRS_cohortsHighBAClassJoin_2_1) + 
  geom_boxplot(aes(x=highBAclass, y=RelEnan2_1),color="#E7B800") + 
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste(NPP[R:S_2], " / " ,NPP[R:S_1]))) 

ggplot(dataBinRS_cohortsHighBAClassJoin_3_1) +  geom_density_ridges(aes(RelEnan3_1,highBAclass),alpha = .6, color = "white", fill="#FC4E07")+
  labs(x = expression(paste(NPP[R:S_3], " / " ,NPP[R:S_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinRS_cohortsHighBAClassJoin_3_1) + 
  geom_boxplot(aes(x=highBAclass, y=RelEnan3_1),color="#FC4E07") + 
  labs(x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") ")), y = expression(paste(NPP[R:S_3], " / " ,NPP[R:S_1]))) 

```

#### B* at maturity

From new annual_tile_output

##### LUE
```{r}

# Changes in LUE with WD level 1
ggplot() + 
  geom_point(data=simul_data$simuls[[2]][50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=simul_data$simuls[[5]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=simul_data$simuls[[8]][50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(3.5,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[2], color="#619CFF")

ggplot() + 
  geom_point(data=simul_data$simuls[[2]][50:1804,], aes(x=QMD, y=Density12, color='Control')) + 
  geom_point(data=simul_data$simuls[[5]][50:1804,], aes(x=QMD, y=Density12, color='+15%')) +
  geom_point(data=simul_data$simuls[[8]][50:1804,], aes(x=QMD, y=Density12, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[8]][50:1804,]))[2], color="#619CFF")
 

lm1 <- lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,])
summary(lm1)
new1 <- data.frame(QMD = seq(0.1, 1, 0.1))
predictedDensity1 <- predict(lm1, new1)
new1 <- data.frame(QMD = seq(0.1, 1, 0.1),predictedDensity1)

lm2 <- lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[5]][50:1804,])
summary(lm2)
new2 <- data.frame(QMD = seq(0.1, 1, 0.1))
predictedDensity2 <- predict(lm2, new2)
new2 <- data.frame(QMD = seq(0.1, 1, 0.1),predictedDensity2)

lm3 <- lm(log(Density12) ~ log(QMD), data = simul_data$simuls[[2]][50:1804,])
summary(lm3)
new3 <- data.frame(QMD = seq(0.1, 1, 0.1))
predictedDensity3 <- predict(lm3, new3)
new3 <- data.frame(QMD = seq(0.1, 1, 0.1),predictedDensity3)

BiomassMaturityLUE1WD1 <- simul_data$simuls[[2]][1300:1804,] %>% summarise(B_star = mean(plantC)) %>% mutate(N_QMD = new1[5,2])
BiomassMaturityLUE2WD1 <- simul_data$simuls[[5]][1300:1804,] %>% summarise(B_star = mean(plantC)) %>% mutate(N_QMD = new2[5,2])
BiomassMaturityLUE3WD1 <- simul_data$simuls[[8]][1300:1804,] %>% summarise(B_star = mean(plantC)) %>% mutate(N_QMD = new3[5,2])

ggplot() + 
  geom_point(data=BiomassMaturityLUE1WD1, aes(x=N_QMD, y=B_star, color='Control')) + 
  geom_point(data=BiomassMaturityLUE2WD1, aes(x=N_QMD, y=B_star, color='+15%')) +
  geom_point(data=BiomassMaturityLUE3WD1, aes(x=N_QMD, y=B_star, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "N at QMD=0.5", y = "B*") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

#### Longevity vs. growth rates

Hypothesis: The negative relationship between longevity vs. growth rates arises from variations between species, but disappears when looking at variations between sites.

Two plots:

- Different species at a given site: x = growth rate, y = longevity (or 1/mortality). Each point is one species (differing by wood density, root:shoot ratio). Add info either by using color ~site (given LUE, growing season length, PAR); or by combining data from multiple sites and normalising growth rates and longevity by site-level mean.
- Same species at different sites (differing by LUE, growing season length, PAR): x = growth rate, y = longevity. Each point is one site (show mean and standard deviations with x and y errorbars)


##### LUE

Todo:

- longevity is maximum age at tile-level, plot mean across multiple years after spinup
- plot change in DBH instead of NPP. Take the oldest cohort, and calculate DBH/age

##### LUE with Age max and dbh for oldest cohort (age max)
##### Same species at different sites (differing by LUE, growing season length, PAR)

```{r}

ggplot() + 
  geom_point(data=simul_data$simuls[[32]], aes(x=meanGR, y=maxAge_mean, color='Low')) + 
  geom_errorbar(data=simul_data$simuls[[32]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Low'),width=0)+
    geom_errorbar(data=simul_data$simuls[[32]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='Low'),width=0)+
  geom_point(data=simul_data$simuls[[35]], aes(x=meanGR, y=maxAge_mean, color='Medium')) + 
  geom_errorbar(data=simul_data$simuls[[35]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Medium'),width=0) +
  geom_errorbar(data=simul_data$simuls[[35]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='Medium'),width=0)+
geom_point(data=simul_data$simuls[[38]], aes(x=meanGR, y=maxAge_mean, color='High')) + 
  geom_errorbar(data=simul_data$simuls[[38]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='High'),width=0) +
  geom_errorbar(data=simul_data$simuls[[38]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='High'),width=0)+
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Low", "Medium", "High"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ea1sa1ma_out_annual_tile <- ea1sa1ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
ea1sa1ma_out_annual_tileMaxAgg <- ea1sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))

ea2sa1ma_out_annual_tile <- ea2sa1ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
ea2sa1ma_out_annual_tileMaxAgg <- ea2sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))

ea3sa1ma_out_annual_tile <- ea3sa1ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
ea3sa1ma_out_annual_tileMaxAgg <- ea3sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))

# Volume/Age
ggplot() + 
  geom_point(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='Control')) + geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Control'),width=0)+ 
  geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='Control'),width=0)+
  geom_point(data=ea2sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='+15%')) + 
  geom_errorbar(data=ea2sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='+15%'),width=0)+ geom_errorbar(data=ea2sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='+15%'),width=0)+
geom_point(data=ea3sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='+30%')) + 
  geom_errorbar(data=ea3sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='+30%'),width=0) +
  geom_errorbar(data=ea3sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='+30%'),width=0)+
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0,1.75),breaks = seq(0,1.75,0.25)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

# DBH/Age
ggplot() + 
  geom_point(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='Control')) + geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Control'),width=0)+ 
  geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='Control'),width=0)+
  geom_point(data=ea2sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='+15%')) + 
  geom_errorbar(data=ea2sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='+15%'),width=0)+ geom_errorbar(data=ea2sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='+15%'),width=0)+
geom_point(data=ea3sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='+30%')) + 
  geom_errorbar(data=ea3sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='+30%'),width=0) +
  geom_errorbar(data=ea3sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='+30%'),width=0)+
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

##### Radiation with Age max
##### Same species at different sites (differing by LUE, growing season length, PAR)

```{r}

ggplot() + 
  geom_point(data=simul_data$simuls[[104]], aes(x=meanGR, y=maxAge_mean, color='Low')) + 
  geom_errorbar(data=simul_data$simuls[[104]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Low'),width=0)+
    geom_errorbar(data=simul_data$simuls[[104]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='Low'),width=0)+
  geom_point(data=simul_data$simuls[[107]], aes(x=meanGR, y=maxAge_mean, color='Medium')) + 
  geom_errorbar(data=simul_data$simuls[[107]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Medium'),width=0) +
  geom_errorbar(data=simul_data$simuls[[107]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='Medium'),width=0)+
geom_point(data=simul_data$simuls[[110]], aes(x=meanGR, y=maxAge_mean, color='High')) + 
  geom_errorbar(data=simul_data$simuls[[110]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='High'),width=0) +
  geom_errorbar(data=simul_data$simuls[[110]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='High'),width=0)+
  scale_color_manual("Levels of Radiation at WD 1", breaks = c("Low", "Medium", "High"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_classic() 

eb1sa1ma_out_annual_tile <- eb1sa1ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
eb1sa1ma_out_annual_tileMaxAgg <- eb1sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))

eb2sa1ma_out_annual_tile <- eb2sa1ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
eb2sa1ma_out_annual_tileMaxAgg <- eb2sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))

eb3sa1ma_out_annual_tile <- eb3sa1ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
eb3sa1ma_out_annual_tileMaxAgg <- eb3sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
# Volume/Age
ggplot() + 
  geom_point(data=eb1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='Control')) + geom_errorbar(data=eb1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Control'),width=0)+ 
  geom_errorbar(data=eb1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='Control'),width=0)+
  geom_point(data=eb2sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='+15%')) + 
  geom_errorbar(data=eb2sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='+15%'),width=0)+ geom_errorbar(data=eb2sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='+15%'),width=0)+
geom_point(data=eb3sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='+30%')) + 
  geom_errorbar(data=eb3sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='+30%'),width=0) +
  geom_errorbar(data=eb3sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='+30%'),width=0)+
  scale_color_manual("Levels of PAR at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0,1.75),breaks = seq(0,1.75,0.25)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

# DBH/Age
ggplot() + 
  geom_point(data=eb1sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='Control')) + geom_errorbar(data=eb1sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Control'),width=0)+ 
  geom_errorbar(data=eb1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='Control'),width=0)+
  geom_point(data=eb2sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='+15%')) + 
  geom_errorbar(data=eb2sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='+15%'),width=0)+ geom_errorbar(data=eb2sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='+15%'),width=0)+
geom_point(data=eb3sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='+30%')) + 
  geom_errorbar(data=eb3sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='+30%'),width=0) +
  geom_errorbar(data=eb3sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='+30%'),width=0)+
  scale_color_manual("Levels of PAR at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0.002,0.012),breaks = seq(0.002,0.012,0.001)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))


```

##### Wood density with Age max 
##### Different species at a given site: Each point is one species (differing by wood density, root:shoot ratio). Add info either by using color ~site (given LUE, growing season length, PAR).

```{r}

ggplot() + 
  geom_point(data=simul_data$simuls[[32]], aes(x=meanGR, y=maxAge_mean, color='Low')) + 
  geom_errorbar(data=simul_data$simuls[[32]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Low'),width=0)+
    geom_errorbar(data=simul_data$simuls[[32]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='Low'),width=0)+
  geom_point(data=simul_data$simuls[[33]], aes(x=meanGR, y=maxAge_mean, color='Medium')) + 
  geom_errorbar(data=simul_data$simuls[[33]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Medium'),width=0) +
  geom_errorbar(data=simul_data$simuls[[33]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='Medium'),width=0)+
geom_point(data=simul_data$simuls[[34]], aes(x=meanGR, y=maxAge_mean, color='High')) + 
  geom_errorbar(data=simul_data$simuls[[34]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='High'),width=0) +
  geom_errorbar(data=simul_data$simuls[[34]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='High'),width=0)+
  scale_color_manual("Levels of WD at LUE 1", breaks = c("Low", "Medium", "High"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_classic() 

ea1sa1ma_out_annual_tile <- ea1sa1ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
ea1sa1ma_out_annual_tileMaxAgg <- ea1sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))

ea1sa2ma_out_annual_tile <- ea1sa2ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
ea1sa2ma_out_annual_tileMaxAgg <- ea1sa2ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))

ea1sa3ma_out_annual_tile <- ea1sa3ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
ea1sa3ma_out_annual_tileMaxAgg <- ea1sa3ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
# Volume/Age
ggplot() + 
  geom_point(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='300 kgC m-3')) + geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='300 kgC m-3'),width=0)+ 
  geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='300 kgC m-3'),width=0)+
  geom_point(data=ea1sa2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='600 kgC m-3')) + 
  geom_errorbar(data=ea1sa2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='600 kgC m-3'),width=0)+ geom_errorbar(data=ea1sa2ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='600 kgC m-3'),width=0)+
geom_point(data=ea1sa3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='800 kgC m-3')) + 
  geom_errorbar(data=ea1sa3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='800 kgC m-3'),width=0) +
  geom_errorbar(data=ea1sa3ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='800 kgC m-3'),width=0)+
  scale_color_manual("Levels of WD at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB" ,"#E7B800", "#FC4E07"))+
  labs(x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0,1.75),breaks = seq(0,1.75,0.25)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

# DBH/Age
ggplot() + 
  geom_point(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='300 kgC m-3')) + geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='300 kgC m-3'),width=0)+ 
  geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='300 kgC m-3'),width=0)+
  geom_point(data=ea1sa2ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='600 kgC m-3')) + 
  geom_errorbar(data=ea1sa2ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='600 kgC m-3'),width=0)+ geom_errorbar(data=ea1sa2ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='600 kgC m-3'),width=0)+
geom_point(data=ea1sa3ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='800 kgC m-3')) + 
  geom_errorbar(data=ea1sa3ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='800 kgC m-3'),width=0) +
  geom_errorbar(data=ea1sa3ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='800 kgC m-3'),width=0)+
  scale_color_manual("Levels of WD at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0.002,0.012),breaks = seq(0.002,0.012,0.001)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

```

##### Rhoot:Shoot ratio with Age max 
##### Different species at a given site: Each point is one species (differing by wood density, root:shoot ratio). Add info either by using color ~site (given LUE, growing season length, PAR).

```{r}

ggplot() + 
  geom_point(data=simul_data$simuls[[68]], aes(x=meanGR, y=maxAge_mean, color='phiRL = 4')) + 
  geom_errorbar(data=simul_data$simuls[[68]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='phiRL = 4'),width=0)+
    geom_errorbar(data=simul_data$simuls[[68]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='phiRL = 4'),width=0)+
  geom_point(data=simul_data$simuls[[69]], aes(x=meanGR, y=maxAge_mean, color='phiRL = 6')) + 
  geom_errorbar(data=simul_data$simuls[[69]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='phiRL = 6'),width=0) +
  geom_errorbar(data=simul_data$simuls[[69]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='phiRL = 6'),width=0)+
geom_point(data=simul_data$simuls[[70]], aes(x=meanGR, y=maxAge_mean, color='phiRL = 8')) + 
  geom_errorbar(data=simul_data$simuls[[70]], aes(x=meanGR, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='phiRL = 8'),width=0) +
  geom_errorbar(data=simul_data$simuls[[70]], aes(xmin=meanGR-sdGR,xmax= meanGR+sdGR , y=maxAge_mean,color='phiRL = 8'),width=0)+
  scale_color_manual("Levels of RS at LUE 1", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_classic() 

ea1sb1ma_out_annual_tile <- ea1sb1ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
ea1sb1ma_out_annual_tileMaxAgg <- ea1sb1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))

ea1sb2ma_out_annual_tile <- ea1sb2ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
ea1sb2ma_out_annual_tileMaxAgg <- ea1sb2ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))

ea1sb3ma_out_annual_tile <- ea1sb3ma_out_annual_tile %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge)
ea1sb3ma_out_annual_tileMaxAgg <- ea1sb3ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
# Volume/Age
ggplot() + 
  geom_point(data=ea1sb1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='phiRL = 4')) + geom_errorbar(data=ea1sb1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='phiRL = 4'),width=0)+ 
  geom_errorbar(data=ea1sb1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='phiRL = 4'),width=0)+
  geom_point(data=ea1sb2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='phiRL = 6')) + 
  geom_errorbar(data=ea1sb2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='phiRL = 6'),width=0)+ geom_errorbar(data=ea1sb2ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='phiRL = 6'),width=0)+
geom_point(data=ea1sb3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='phiRL = 8')) + 
  geom_errorbar(data=ea1sb3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='phiRL = 8'),width=0) +
  geom_errorbar(data=ea1sb3ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='phiRL = 8'),width=0)+
  scale_color_manual("Levels of R:S at LUE 1", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB" ,"#E7B800", "#FC4E07"))+
  labs(x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0,1.75),breaks = seq(0,1.75,0.25)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

# DBH/Age
ggplot() + 
  geom_point(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='300 kgC m-3')) + geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='300 kgC m-3'),width=0)+ 
  geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='300 kgC m-3'),width=0)+
  geom_point(data=ea1sa2ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='600 kgC m-3')) + 
  geom_errorbar(data=ea1sa2ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='600 kgC m-3'),width=0)+ geom_errorbar(data=ea1sa2ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='600 kgC m-3'),width=0)+
geom_point(data=ea1sa3ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='800 kgC m-3')) + 
  geom_errorbar(data=ea1sa3ma_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='800 kgC m-3'),width=0) +
  geom_errorbar(data=ea1sa3ma_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color='800 kgC m-3'),width=0)+
  scale_color_manual("Levels of WD at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0.002,0.012),breaks = seq(0.002,0.012,0.001)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

```
