% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cost_likelihood_pmodel.R
\name{cost_likelihood_pmodel}
\alias{cost_likelihood_pmodel}
\title{Cost function computing a log-likelihood for calibration of P-model
parameters}
\usage{
cost_likelihood_pmodel(
  par,
  obs,
  drivers,
  par_fixed = NULL,
  parallel = FALSE,
  ncores = 1,
  get_mod_obs = get_mod_obs_pmodel
)
}
\arguments{
\item{par}{A named list for the parameters to be calibrated, including
a subset of model parameters and error terms for each target variable (for
example \code{'gpp_err'}).}

\item{obs}{A nested data.frame of observations, with columns \code{'sitename'}
\code{'targets'}, and \code{'data'} (see \code{\link{pmodel_validation}} to
check its structure). \code{'targets'} indicates the target variable(s) for
which the likelihood is computed, it must be a column name of the
\code{'data'} data.frame and it must have an error term in either \code{'par'}
or \code{'par_fixed'}.}

\item{drivers}{A nested data.frame of driver data. See \code{\link{pmodel_drivers}}
for a description of the data structure.}

\item{par_fixed}{A named list of model parameter values to keep fixed during the
calibration. These should complement the input \code{par} such that all model
parameters are uniquely defined and passed on to \code{\link{runread_pmodel_f}}.}

\item{parallel}{A logical specifying whether simulations are to be parallelised
(sending data from a certain number of sites to each core). Defaults to
\code{FALSE}.}

\item{ncores}{An integer specifying the number of cores used for parallel
computing. Defaults to 2.}

\item{get_mod_obs}{Function running P-model and combining model outputs and
observations (defaults to get_mod_obs_pmodel)}
}
\value{
The log-likelihood of the observed target values, assuming that they
are independent, normally distributed and centered on the predictions
made by the P-model run with standard deviation given as input \code{par} e.g.
\code{gpp_err}.
}
\description{
The cost function performs a P-model run for the input drivers and model parameter
values, and computes the outcome's normal log-likelihood centered at the input
observed values and with standard deviation given as an input parameter
(calibratable).
}
\details{
To run the P-model, all model parameters must be given. The cost
function uses arguments \code{par} and \code{par_fixed} such that, in the
calibration routine, \code{par} can be updated by the optimizer and
\code{par_fixed} are kept unchanged throughout calibration.

If the validation data contains a "date" column (fluxes), the simulated target time series
is compared to the observed values on those same dates (e.g. for GPP).
}
\examples{
# Compute the likelihood for a set of
# model parameter values involved in the
# temperature dependence of kphio
# and example data
cost_likelihood_pmodel(
  par = c(kphio       = 0.05,
    kphio_par_a = -0.01,
    kphio_par_b = 1,
    # error model parameters
    err_gpp     = 2),
  obs = pmodel_validation |> dplyr::filter(sitename == "FR-Pue"),
  drivers = pmodel_drivers |> dplyr::filter(sitename == "FR-Pue"),
  par_fixed = list(
    soilm_thetastar    = 0.6 * 240,  # old setup with soil moisture stress
    soilm_betao        = 0.0,
    beta_unitcostratio = 146.0,
    rd_to_vcmax        = 0.014,      # from Atkin et al. 2015 for C3 herbaceous
    tau_acclim         = 30.0,
    kc_jmax            = 0.41
  )
)
}
